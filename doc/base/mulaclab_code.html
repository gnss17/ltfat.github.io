 
<!DOCTYPE html>
<html lang="en">
<head class="include" file="../../include/header.html">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta NAME="keywords" CONTENT="gabor, wavelets, filterbank, signal processing, matlab,
octave"/>
<title>MULACLAB - Graphical interface for audio processing using frame multipliers</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.5/css/bootstrap-select.min.css">
<link rel="stylesheet" href="../../include/style.css" type="text/css">
<link rel="stylesheet" href="../../include/highlight.css" type="text/css">
</head>

<!-- body must stay hidden until all include parts are loaded -->
<body style="display:none;">
<!-- Wrap the content into responsive container --!>
<div class="container">
<!-- Include main navigation -->
<div class="masthead include" file="../../include/mainnav.html">
</div>
<div class="row">
    <div class="col-md-2" id="codeswitch"><div id="menutitle"><a href="mulaclab.html">View the help</a></div>
</div>
    <div class="col-md-offset-5 col-md-5" id="jumplist">This is where navigation should be.</div>
</div>
<div class="row">
    <div class="col-md-2">
        <div class="include" file='../include/docnav.html'></div>
        <div id="seealso"><p></p></div>
    </div>
    <div class="col-md-10">

        <h1 class="title">MULACLAB - Graphical interface for audio processing using frame multipliers</h1>
<h2>Program code:</h2>
<div class="highlight"><pre><span class="k">function</span><span class="w"> </span>[] <span class="p">=</span><span class="w"> </span><span class="nf">mulaclab</span><span class="p">(</span>file,varargin<span class="p">)</span><span class="w"></span>
<span class="c">%MULACLAB Graphical interface for audio processing using frame multipliers</span>
<span class="c">%   Usage: mulaclab;</span>
<span class="c">% </span>
<span class="c">%   When starting the interface, the user is asked to choose the processed</span>
<span class="c">%   signal, named original signal in the interface.  Possible signals are</span>
<span class="c">%   .wav files and .mat files containing decompositions preliminarily</span>
<span class="c">%   saved using the MULACLAB interface.  The interface only handles</span>
<span class="c">%   monochannel signals. So for a multichannel .wav files, the first channel</span>
<span class="c">%   is used as the original signal.</span>
<span class="c">%</span>
<span class="c">%   After choosing the original signal, the user is presented with the main</span>
<span class="c">%   interface. This interface is divided in two areas: </span>
<span class="c">%</span>
<span class="c">%    The right part of the figure contains the visualizations, which</span>
<span class="c">%     represent the spectrograms of the original and modified signals.</span>
<span class="c">%</span>
<span class="c">%     The &#39;Original signal&#39; visualization is used to display the original</span>
<span class="c">%     signal spectrogram and to graphically define the symbol of the Gabor </span>
<span class="c">%     multiplier that will be applied on this signal. </span>
<span class="c">%</span>
<span class="c">%     The &#39;Overview of original signal&#39; visualization also represents the</span>
<span class="c">%     original signal spectrogram and can be used for fast zooming and moving</span>
<span class="c">%     of the other visualizations. Zooming and moving is controlled by mouse</span>
<span class="c">%     interaction with the white rectangle displayed on this visualization. </span>
<span class="c">%</span>
<span class="c">%     The &#39;Modified signal&#39; visualization is used to display the spectrogram</span>
<span class="c">%     of the modified signal after application of the multiplier.</span>
<span class="c">%</span>
<span class="c">%     It is possible to hide the &#39;Overview of original signal&#39; and &#39;Modified</span>
<span class="c">%     signal&#39; visulizations using the &#39;Visualization&#39; menu.</span>
<span class="c">%</span>
<span class="c">%    The left part of the figure contains panels with tools for user </span>
<span class="c">%     interaction.</span>
<span class="c">%</span>
<span class="c">%     The &#39;Audioplayer&#39; panel contains the controls for audio playback of the</span>
<span class="c">%     original and modified signal.</span>
<span class="c">%</span>
<span class="c">%     The &#39;Visualization&#39; panel contains tools used to adapt the display</span>
<span class="c">%     of the visualizations.</span>
<span class="c">%</span>
<span class="c">%     The &#39;Selection&#39; panel contains tools and information concerning the</span>
<span class="c">%     multilayered selection used to graphically specify the symbol of the </span>
<span class="c">%     multiplier.</span>
<span class="c">% </span>
<span class="c">%   Known Matlab limitations: </span>
<span class="c">%</span>
<span class="c">%    When using Matlab on Linux with multiple screens, there might be a </span>
<span class="c">%     Matlab bug preventing the display of the multiplier symbol. This can be</span>
<span class="c">%     solved by docking the figure.</span>
<span class="c">%</span>
<span class="c">%    When using a Matlab version prior to 7.3 (R2006b), the rectangle</span>
<span class="c">%     displayed on the &#39;Overview of original signal&#39; visualization is not</span>
<span class="c">%     automatically updated when using the zoom and pan tools of the &#39;Zoom&#39; </span>
<span class="c">%     panel. It can be manually updated by re-clicking on the currently</span>
<span class="c">%     selected tool or by changing the current tool.</span>
<span class="c">%</span>
<span class="c">%   The Matlab Image Processing Toolbox is required by the mulaclab function.</span>
<span class="c">%</span>
<span class="c">%   MULACLAB uses the GPC library available from</span>
<span class="c">%   http://www.cs.man.ac.uk/~toby/gpc/. This library is distributed</span>
<span class="c">%   alongside LTFAT, but under different licensing conditions. Please see</span>
<span class="c">%   the ltfat/thirdparty/gpc/GPC-README.pdf file for the exact conditions.</span>
<span class="c">%</span>
<span class="c">%   Url: http://ltfat.github.io/doc/mulaclab.html</span>

<span class="c">% Copyright (C) 2005-2015 Peter L. Soendergaard &lt;peter@sonderport.dk&gt;.</span>
<span class="c">% This file is part of LTFAT version 2.1.1</span>
<span class="c">%</span>
<span class="c">% This program is free software: you can redistribute it and/or modify</span>
<span class="c">% it under the terms of the GNU General Public License as published by</span>
<span class="c">% the Free Software Foundation, either version 3 of the License, or</span>
<span class="c">% (at your option) any later version.</span>
<span class="c">%</span>
<span class="c">% This program is distributed in the hope that it will be useful,</span>
<span class="c">% but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c">% GNU General Public License for more details.</span>
<span class="c">%</span>
<span class="c">% You should have received a copy of the GNU General Public License</span>
<span class="c">% along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="c">%</span>
<span class="c">% questions : do we want to :</span>
<span class="c">% - have the possibility to use Gaussian window? (any window?) - check</span>
<span class="c">% - be able to export the symbol? </span>
<span class="c">% - be able to export the coeff? </span>
<span class="c">% - automatically generate a matlab file applying the corresponding gabor</span>
<span class="c">% mutliplier? something like:</span>
<span class="c">% [s, ...] = waveread(&#39;rightfile.wav&#39;);</span>
<span class="c">% coeff = dgt(f, ...);</span>
<span class="c">% load symbol.mat</span>
<span class="c">% coeff = coeff.*symbol;</span>
<span class="c">% res = idgt(coeff, ...);</span>
<span class="c">%</span>
<span class="c">% Known bugs:</span>
<span class="c">% - visualization bug when the signal is zero everywhere</span>
<span class="c">% - there might be a bug with noise level when using hole filling with</span>
<span class="c">% noise, check what&#39;s happening. I tried to check, but I cannot find</span>
<span class="c">% the bug. Still, something really strange is hapenning, for a given</span>
<span class="c">% selection I will have a level which is too low, when everything works</span>
<span class="c">% nicely with a slightly modified version of the selection.</span>
<span class="c">% - when using undo it seems that parameters of the type of layer are not</span>
<span class="c">% updated</span>
<span class="c">%</span>
<span class="c">% todo:</span>
<span class="c">% - reorder the functions in this file to improve consistency</span>
<span class="c">% - check the interface with matlab r14</span>
<span class="c">% - check the looking of the interface under linux, windows and mac</span>
<span class="c">% - add possibility to see individual atom of the frame (and the dual)</span>
<span class="c">%   (with right clic menu?)</span>
<span class="c">% - possibility to have a nice view (3D?) of the mask</span>
<span class="c">% - possibility to choose the channel and a time selection of wave</span>
<span class="c">% - switch between original and modified when playing</span>
<span class="c">% - add editable keyboard shortcuts for almost everything</span>
<span class="c">% - comment the functions</span>
<span class="c">% - add a simple polygon simplification function (at least for straight </span>
<span class="c">% line with magic wand)</span>
<span class="c">% - for changing mouse pointer, see what can be done using </span>
<span class="c">%   iptPointerManager</span>
<span class="c">% - give possibility to use a Gaussian window</span>
<span class="c">% - see if I change the scale used to display symbol (use dB?)</span>
<span class="c">% - precise problems if public distribution of this file (use of </span>
<span class="c">%   PolygonClip and icons)</span>
<span class="c">% - update information of contextual menu for layers to know what are the</span>
<span class="c">%   currently selected properties</span>
<span class="c">% - see if I put a limit in the number of levels of undo</span>
<span class="c">% - add possibility to modify afterward polygons</span>
<span class="c">%</span>
<span class="c">% Acronym used in the comments:</span>
<span class="c">% PI: possible improvement, used to specify things that could be done to</span>
<span class="c">% improve the current version of mulaclab. In particular, it can be </span>
<span class="c">% efficiency improvements or suitable functionnality addition.</span>
<span class="c">%</span>
<span class="c">% _____________________ Description of shared data ________________________</span>
<span class="c">%</span>
<span class="c">% To share data between the different components of the Graphical User </span>
<span class="c">% Interface (GUI), nested functions are used</span>
<span class="c">% (search for &#39;Sharing Data Among a GUI&#39;s Callbacks&#39; in matlab&#39;s</span>
<span class="c">% documentation for more information about this technique).</span>
<span class="c">% So all the functionnalities of the GUI are implemented using nested</span>
<span class="c">% functions, and to share data, a set of variables are defined at the top </span>
<span class="c">% level of the function (ie in the workspace of the function mulaclab).</span>
<span class="c">%</span>
<span class="c">% Here is a list of these variables with their description:</span>
<span class="c">%</span>
<span class="c">% sig: (struct) data describing the processed signal</span>
<span class="c">%</span>
<span class="c">% - sig.ori: (vector) samples of the original signal</span>
<span class="c">%</span>
<span class="c">% - sig.mod: (vector) samples of the modified signal</span>
<span class="c">%</span>
<span class="c">% - sig.sampFreq: (scalar) sampling frequency of the original and modified</span>
<span class="c">%   signals</span>
<span class="c">%</span>
<span class="c">% - sig.real: (bool) boolean to know if the signal is real (true)</span>
<span class="c">%   or complex (false)</span>
<span class="c">%</span>
<span class="c">% frame: (struct) data describing the frame</span>
<span class="c">%</span>
<span class="c">% - frame.type: (string) type of the frame (currently only Gabor frames are </span>
<span class="c">%   implemented, other frames could be added, like wavelet frames,</span>
<span class="c">%   nonstationnary Gabor frames, nonuniform filterbanks, general frames)</span>
<span class="c">%</span>
<span class="c">% - frame.def: (struct) data defining the frame (fields depend of the</span>
<span class="c">%   frame type)</span>
<span class="c">%</span>
<span class="c">%   For Gabor frames, frame.def fields are:</span>
<span class="c">%   - frame.def.winType: (string) type of window as defined in the firwin</span>
<span class="c">%     function of LTFAT, see parameter &#39;name&#39; in the help of firwin </span>
<span class="c">%     function for details</span>
<span class="c">%</span>
<span class="c">%   - frame.def.winLen: (scalar) window length in number of samples</span>
<span class="c">%</span>
<span class="c">%   - frame.def.hop: (scalar) hop size (ie Gabor frame time shift) in</span>
<span class="c">%     number of samples (parameter &#39;a&#39; of LTFAT dgt function)</span>
<span class="c">%</span>
<span class="c">%   - frame.def.nbFreq: (scalar) number of frequency bins (parameter &#39;M&#39; </span>
<span class="c">%     of LTFAT dgt function)</span>
<span class="c">%</span>
<span class="c">% coeff: (struct) coefficients obtained by decomposition of the signal </span>
<span class="c">% on the frame</span>
<span class="c">%</span>
<span class="c">% - coeff.ori: (matrix, dimension 1: frequency, dimension 2:time) </span>
<span class="c">%   coefficients for the original signal sig.ori</span>
<span class="c">%</span>
<span class="c">% - coeff.mod: (matrix, dimension 1: frequency, dimension 2:time)</span>
<span class="c">%   coefficients for the modified signal sig.mod</span>
<span class="c">%</span>
<span class="c">% - coeff.oriC: (matrix, dimension 1: frequency, dimension 2:time)</span>
<span class="c">%   plotted spectrogram as image in DB</span>
<span class="c">%</span>
<span class="c">% - coeff.info: (struct)</span>
<span class="c">%   additonal data necesary for the reconstruction</span>
<span class="c">%</span>
<span class="c">% sel: (struct) data describing the graphical selection</span>
<span class="c">% The graphical selection contains several layers, each layer containing</span>
<span class="c">% several polygons defining a region of the time-frequency that must be </span>
<span class="c">% modified. These polygons can be drawn freely by the user using the two </span>
<span class="c">% available tools (freehand selection and magic wand).</span>
<span class="c">% sel contains data defining these polygons and layers, and data</span>
<span class="c">% specifying how they should be plotted</span>
<span class="c">%</span>
<span class="c">% - sel.mode: (string) specifies how the next polygon drawn by the user </span>
<span class="c">%   must be combined with the polygons already defined in the currently</span>
<span class="c">%   edited layer</span>
<span class="c">%   possible modes are &#39;union&#39;, &#39;intersection&#39;, &#39;difference&#39;</span>
<span class="c">%</span>
<span class="c">% - sel.curLay: index of the currently edited layer</span>
<span class="c">%</span>
<span class="c">% - sel.lay: (struct) data describing the layers, it&#39;s a vector of struct,</span>
<span class="c">%   and sel.lay(ind) contains data for layer number ind</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.convType: (string) conversion type of the layer, it specifies</span>
<span class="c">%     how the values of the symbol must be computed for the current layer,</span>
<span class="c">%     possible types are:</span>
<span class="c">%</span>
<span class="c">%     &#39;constGain&#39;: apply a constant gain on the whole time-frequency region</span>
<span class="c">%     corresponding to the polygons of the layer</span>
<span class="c">%</span>
<span class="c">%     &#39;smoothBorder&#39;: also apply a gain on the region corresponding to the</span>
<span class="c">%     polygons of the layer, but the gain values are smoothed at the border</span>
<span class="c">%     to go linearly from 1 outside the polygons to the gain value</span>
<span class="c">%     specified for the layer inside the polygons</span>
<span class="c">%</span>
<span class="c">%     &#39;fill&#39;: try to fill the region corresponding to the polygons of the</span>
<span class="c">%     layer according to the neighborhood level, this is done by</span>
<span class="c">%     replacing the absolute value of the coefficient inside the polygons </span>
<span class="c">%     by the interpolated values using the level of the coefficient in a </span>
<span class="c">%     specified neigborhood outside the polygons</span>
<span class="c">%     the phase of the coefficients are left unchanged</span>
<span class="c">%</span>
<span class="c">%     &#39;fillNoise&#39;: same as &#39;fill&#39;, but the coefficients inside the polygons</span>
<span class="c">%     of the layers are replaced by coefficients obtained from a noise and</span>
<span class="c">%     multiplied by the interpolated absolute values</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.param: (struct) parameters for the conversion of the layer,</span>
<span class="c">%     it&#39;s a struct array, sel.lay(indLay).param(indParam) defines the</span>
<span class="c">%     parameter number indParam of the layer number indLay</span>
<span class="c">%     the number of parameters and their nature depends of the convType</span>
<span class="c">%     parameter of the layer according to the following:</span>
<span class="c">%</span>
<span class="c">%     * if convType is &#39;constGain&#39;: only one parameter named &#39;Gain&#39; is </span>
<span class="c">%       defined and it contain the value of the constant gain applied to </span>
<span class="c">%       region corresponding to the polygons of the layer</span>
<span class="c">%</span>
<span class="c">%     * if convType is &#39;smoothBorder&#39;: two parameters named &#39;Gain&#39; and </span>
<span class="c">%       &#39;Border&#39; are defined</span>
<span class="c">%       &#39;Gain&#39; contain the value of the gain applied inside region </span>
<span class="c">%       corresponding to the polygons of the layer away from the border</span>
<span class="c">%       &#39;Border&#39; specify the distance from the border (in number of</span>
<span class="c">%       coeffiicents) in which the gain value is linearly interpolated </span>
<span class="c">%       between 1 and the value given by &#39;Gain&#39;</span>
<span class="c">%</span>
<span class="c">%     * if convType is &#39;fill&#39; or &#39;fillNoise&#39; : two parameters &#39;Height&#39; and</span>
<span class="c">%       &#39;Width&#39; are defined</span>
<span class="c">%       these parameters specifiy the size of the ellipse used to define</span>
<span class="c">%       the size of the neighborhood used the estimate the level around the</span>
<span class="c">%       polygons</span>
<span class="c">%       &#39;Height&#39; is the radius (in number of coefficients) of the ellipse</span>
<span class="c">%       along frequency (y axis), and &#39;Width&#39; is the radius (in number of </span>
<span class="c">%       coefficients) of the ellipse along time (x axis)</span>
<span class="c">%       </span>
<span class="c">%     - sel.lay.param.name: (string) name of the parameter, as displayed </span>
<span class="c">%       in the GUI under the layer list</span>
<span class="c">%</span>
<span class="c">%     - sel.lay.param.val: (scalar) the value of the parameter</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.lineWidth: (scalar) width of the lines representing the </span>
<span class="c">%     polygons of the layer</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.color: (colorspec) color of the lines representing the </span>
<span class="c">%     polygons of the layer</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.marker: (string) marker type of the lines representing the </span>
<span class="c">%     polygons of the layer</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.markerSize: (scalar) marker size of the lines representing </span>
<span class="c">%     the polygons of the layer</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.lineStyle: (string) line style of the lines representing the </span>
<span class="c">%     polygons of the layer</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.poly: (struct) data defining the polygons of the layer, it&#39;s</span>
<span class="c">%     a struct array, sel.lay(indLay).poly(indPoly) defines the</span>
<span class="c">%     polygon number indPoly of the layer number indLay</span>
<span class="c">%</span>
<span class="c">%     - sel.lay.poly.x: (row vector) x-coordinates (ie time-coordinates)</span>
<span class="c">%       of the polygon points</span>
<span class="c">%</span>
<span class="c">%     - sel.lay.poly.y: (row vector) y-coordinates (ie </span>
<span class="c">%       frequency-coordinates) of the polygon points</span>
<span class="c">%</span>
<span class="c">%     - sel.lay.poly.hole: (bool) specifies if the polygon is a hole</span>
<span class="c">%</span>
<span class="c">%     - sel.lay.poly.id: (graphics object handle) handle to the line</span>
<span class="c">%       representing the polygon</span>
<span class="c">%</span>
<span class="c">%   - sel.lay.label: (string) layer label as displayed in the layer list in</span>
<span class="c">%     the GUI</span>
<span class="c">%</span>
<span class="c">%</span>
<span class="c">% visu: (struct) data defining parameters of the visualizations</span>
<span class="c">% visu is a struct array, visu(ind) contains data for the visualization</span>
<span class="c">% number ind.</span>
<span class="c">% The visualizations are the representations plotted on the right part of</span>
<span class="c">% the GUI. They are plotted in the order specified by visu from top to</span>
<span class="c">% bottom, that is to say that visu(1) is plotted on top, visu(2) is plotted</span>
<span class="c">% under visu(1) and so on.</span>
<span class="c">% PI: Currently only three visualizations are available: the spectrogram</span>
<span class="c">% of the original signal (used as the support for graphical definition of </span>
<span class="c">% the multiplier), the spectrogram of the modified signal to observe the </span>
<span class="c">% effect of the multiplier, and an overview spectrogram of the original </span>
<span class="c">% signal for fast navigation in the time-frequency plane.</span>
<span class="c">% But it should be easy to add some new visualizations if needed. To add a</span>
<span class="c">% new visualization, adding an element to vector visu with appropriate </span>
<span class="c">% parameters and implementing the associated updating function should be</span>
<span class="c">% enough. If the possibility to show and hide the new visualization is</span>
<span class="c">% also needed, some handling of it in the menu is also required.</span>
<span class="c">%</span>
<span class="c">% - visu.label: (string) the title appearing on top of the visualization</span>
<span class="c">%</span>
<span class="c">% - visu.height: (scalar) number specifying the height of the</span>
<span class="c">%   visualization. It is a number between 0 and 1 specifying the ratio of</span>
<span class="c">%   the figure height that should be used for each visualisation. To cover</span>
<span class="c">%   the whole figure, values should be chosen so that they sum up to 1 when</span>
<span class="c">%   considering all the visible visualizations</span>
<span class="c">%</span>
<span class="c">% - visu.position: (vector) the position vector of the uipanels containing</span>
<span class="c">%   the visualizations. It is automatically computed by function resize</span>
<span class="c">%   using the values of visu.height.</span>
<span class="c">%</span>
<span class="c">% - visu.updateFcn: (function handle) the handle of the function that must</span>
<span class="c">%   be used to update the plot of the visualization</span>
<span class="c">%</span>
<span class="c">% - visu.dynamic: (scalar) colorscale dynamic of the visualization</span>
<span class="c">%   (positive number in dB)</span>
<span class="c">%</span>
<span class="c">% - visu.visible: (bool) boolean specifying if the visualization is</span>
<span class="c">%   visible and must be plotted (true) or not (false)</span>
<span class="c">%</span>
<span class="c">% - visu.linkX: (bool) boolean specifying if the visualization x axe (time</span>
<span class="c">%   axe) must be linked with the one of the other visualizations</span>
<span class="c">%</span>
<span class="c">% - visu.linkY: (bool) boolean specifying if the visualization y axe </span>
<span class="c">%   (frequency axe) must be linked with the one of the other visualizations</span>
<span class="c">%</span>
<span class="c">% - visu.linkCLim: (bool) boolean specifying if the visualization </span>
<span class="c">%   colorscale limits must be linked with the one of the other </span>
<span class="c">%   visualizations</span>
<span class="c">%</span>
<span class="c">% - visu.uipanelId: (graphics object handle) handle of the uipanel</span>
<span class="c">%   containing the visualization</span>
<span class="c">%</span>
<span class="c">% - visu.axesId: (graphics object handle) handle of the axes of the</span>
<span class="c">%   visualization</span>
<span class="c">%</span>
<span class="c">% gui: (struct) graphical user interface data </span>
<span class="c">% gui contains data used to define properties of certain graphics object</span>
<span class="c">% (in particular their position) and data used to dynamically handle the</span>
<span class="c">% inferface (in particular many graphics object handles)</span>
<span class="c">%</span>
<span class="c">% - gui.mainFigPos: (4x1 vector) position of the main figure using the</span>
<span class="c">%   usual matlab position definition of the form [left bottom width height]</span>
<span class="c">%</span>
<span class="c">% - gui.fontSize: (scalar) font size (in points) for the elements appearing</span>
<span class="c">%   in the panels on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.textHeight: (scalar) height (in number of pixels) for text</span>
<span class="c">%   uicontrol appearing in the panels on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.textWidth: (scalar) width (in number of pixels) for text</span>
<span class="c">%   uicontrol appearing in the panels on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.editWidth: (scalar) width (in number of pixels) for edit</span>
<span class="c">%   uicontrol appearing in the panels on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.buttonBackgroundColor: (colorspec) background color used for</span>
<span class="c">%   uicontrol appearing in the panels on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.buttonWidth: (scalar) width (in number of pixels) for button</span>
<span class="c">%   uicontrol appearing in the panels on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.buttonHeight: (scalar) height (in number of pixels) for button</span>
<span class="c">%   uicontrol appearing in the panels on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.horiDist: (scalar) horizontal distance (in number of pixels) </span>
<span class="c">%   between two elements appearing in the panels on the left part of the </span>
<span class="c">%   interface</span>
<span class="c">%</span>
<span class="c">% - gui.vertDist: (scalar) vertical distance (in number of pixels) </span>
<span class="c">%   between two elements appearing in the panels on the left part of the </span>
<span class="c">%   interface</span>
<span class="c">%</span>
<span class="c">% - gui.margin: (1x2 vector) distance from the border of the panel (in </span>
<span class="c">%   number of pixels) of the element closest to the border of the panel.</span>
<span class="c">%   First element is horizontal distance, second element is vertical</span>
<span class="c">%   distance.</span>
<span class="c">%</span>
<span class="c">% - gui.marginSub: (1x2 vector) same as gui.margin but for elements </span>
<span class="c">%   appearing in sub-panels</span>
<span class="c">%</span>
<span class="c">% - gui.panelWidth: (scalar) width (in number of pixels) of the panels </span>
<span class="c">%   appearing on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.panelHeight: (vector) height (in number of pixels) of the panels </span>
<span class="c">%   appearing on the left part of the interface. These values must be</span>
<span class="c">%   adapted by hand if other parameters such as gui.buttonHeight are </span>
<span class="c">%   changed</span>
<span class="c">%</span>
<span class="c">% - gui.panelTitle: (cell array of strings) title of the panels appearing </span>
<span class="c">%   on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.visuResizeButtonWidth: (scalar) width (in number of pixels) of </span>
<span class="c">%   the draggable resize buttons appearing between two visualizations on </span>
<span class="c">%   the right part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.visuResizeButtonHeight: (scalar) height (in number of pixels) of </span>
<span class="c">%   the draggable resize buttons appearing between two visualizations on </span>
<span class="c">%   the right part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.curTool: (string) currently used graphical tool, can be one of the</span>
<span class="c">%   possible names stored in gui.tool.name, which are:</span>
<span class="c">%   &#39;free&#39; for freehand selection</span>
<span class="c">%   &#39;level&#39; for level selection (ie magic wand)</span>
<span class="c">%   &#39;zoomIn&#39; for zoom in mode</span>
<span class="c">%   &#39;zoomOut&#39; for zoom out mode</span>
<span class="c">%   &#39;pan&#39; for pan mode</span>
<span class="c">%</span>
<span class="c">% - gui.tool: (struct) struct array containing tool data</span>
<span class="c">%   gui.tool(ind) contains data for tool number ind</span>
<span class="c">%</span>
<span class="c">%   - gui.tool.buttonId: (graphics object handle) handle of the tool button</span>
<span class="c">%</span>
<span class="c">%   - gui.tool.name: (string) name of the tool, used to identify the</span>
<span class="c">%     current tool in gui.curTool</span>
<span class="c">%</span>
<span class="c">%   - gui.tool.function (function handle) handle of the function that must</span>
<span class="c">%     be executed to initialize the tool when clicking the corresponding </span>
<span class="c">%     button</span>
<span class="c">%</span>
<span class="c">%   - gui.tool.param: (struct) struct array containing the tool parameters</span>
<span class="c">%     the content of this element depends on the tool and is empty for all</span>
<span class="c">%     the tools except for the levele selection (magick wand), for which </span>
<span class="c">%     one parameter named &#39;Tolerance&#39; is defined</span>
<span class="c">%</span>
<span class="c">%     - gui.tool.param.name: (string) the name of the parameter, as</span>
<span class="c">%     displayed under the tools subpanel</span>
<span class="c">%</span>
<span class="c">%     - gui.tool.param.val: (string) the value of the parameter represented</span>
<span class="c">%       as a string (so a conversion is needed if the parameter is a</span>
<span class="c">%       number)</span>
<span class="c">%</span>
<span class="c">% - gui.symbOpacity: (scalar) opacity value used for plotting of symbol </span>
<span class="c">%   (any value between 0:transparent and 1:opaque)</span>
<span class="c">%</span>
<span class="c">% - gui.showSymb: (bool) boolean specifying if the symbol should be plotted</span>
<span class="c">%   (true) or not (false)</span>
<span class="c">%</span>
<span class="c">% - gui.symbImageId: (graphics object handle) handle of the image used to</span>
<span class="c">%   plot the symbol (the symbol is plotted as a transparent image on top </span>
<span class="c">%   of the image of the spectrogram)</span>
<span class="c">%</span>
<span class="c">% - gui.player: (struct) structure containing the handles associated with</span>
<span class="c">%   the gui of the audioplayer</span>
<span class="c">%</span>
<span class="c">%   - gui.player.buttongroupId: (graphics object handle) handle of the</span>
<span class="c">%     buttongroup used for the selection of the signal played (original or </span>
<span class="c">%     modified) </span>
<span class="c">%</span>
<span class="c">%   - gui.player.buttonOriId: (graphics object handle) handle of the radio</span>
<span class="c">%     button for the selection of original signal</span>
<span class="c">%</span>
<span class="c">%   - gui.player.buttonModId: (graphics object handle) handle of the radio</span>
<span class="c">%     button for the selection of modified signal</span>
<span class="c">%</span>
<span class="c">% - gui.ResizeVisuButtonId: (graphics object handle vector) vector</span>
<span class="c">%   containing the handles of the draggable resize buttons appearing </span>
<span class="c">%   between two visualizations on the right part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.mainFigId: (graphics object handle) handle of the main figure of </span>
<span class="c">%   the interface</span>
<span class="c">%</span>
<span class="c">% - gui.undoMenuId: (graphics object handle) handle of the &#39;Undo&#39; menu</span>
<span class="c">%   element</span>
<span class="c">%</span>
<span class="c">% - gui.redoMenuId: (graphics object handle) handle of the &#39;Redo&#39; menu </span>
<span class="c">%   element</span>
<span class="c">%</span>
<span class="c">% - gui.visuMenu: (struct) structure containing menu handles used to show</span>
<span class="c">%   and hide visualizations</span>
<span class="c">%</span>
<span class="c">%   - gui.visuMenu.showModId: (graphics object handle) handle of the </span>
<span class="c">%   &#39;Show modified signal&#39; menu element</span>
<span class="c">%</span>
<span class="c">%   - gui.visuMenu.showOverviewId: (graphics object handle) handle of the </span>
<span class="c">%   &#39;Show overview of original signal&#39; menu element</span>
<span class="c">%</span>
<span class="c">% - gui.exploreRect: (struct) handle of the graphical objects used to</span>
<span class="c">%   represent the rectangular selection on the overview of original signal</span>
<span class="c">%   visualization</span>
<span class="c">%</span>
<span class="c">%   - gui.exploreRect.patchId: (graphics object handle) handle of the patch</span>
<span class="c">%   used to draw the movable selection rectangle</span>
<span class="c">%</span>
<span class="c">%   - gui.exploreRect.lineId: (graphics object handle) handle of the line</span>
<span class="c">%   used to draw the movable points at the corners of the rectangle</span>
<span class="c">%</span>
<span class="c">% - gui.panelId: : (graphics object handle vector) vector containg the</span>
<span class="c">%   handles of the uipanels drawn on the left part of the interface</span>
<span class="c">%</span>
<span class="c">% - gui.editDynamicId: (graphics object handle) handle of the edit</span>
<span class="c">%   uicontrol used to specify the colorscale dynamic</span>
<span class="c">%</span>
<span class="c">% - gui.layListId: (graphics object handle) handle of the listbox</span>
<span class="c">%   uicontrol used to show the slection layers list</span>
<span class="c">%</span>
<span class="c">% - gui.layPanelId: (graphics object handle) uipanel handle of the &#39;Layers&#39;</span>
<span class="c">%   subpanel</span>
<span class="c">%</span>
<span class="c">% - gui.toolPanelId: (graphics object handle) uipanel handle of the &#39;Tools&#39;</span>
<span class="c">%   subpanel</span>
<span class="c">%    </span>
<span class="c">% link: (struct) data for linking of axes of the different visualization</span>
<span class="c">%</span>
<span class="c">% - link.CLim: (linkprop object) link object used to link the colorscale </span>
<span class="c">%   limits (through the CLim property) of the visualizations having their</span>
<span class="c">%   parameter visu.linkCLim set to true</span>
<span class="c">%</span>
<span class="c">% - link.XLim: (linkprop object) link object used to link the time axe </span>
<span class="c">%   (through the XLim property) of the visualizations having their </span>
<span class="c">%   parameter visu.linkXLim set to true</span>
<span class="c">%</span>
<span class="c">% - link.YLim: (linkprop object) link object used to link the frequency axe </span>
<span class="c">%   (through the YLim property) of the visualizations having their </span>
<span class="c">%   parameter visu.linkYLim set to true</span>
<span class="c">%</span>
<span class="c">% player: (struct) data used for audio playing</span>
<span class="c">% </span>
<span class="c">% - player.ori: (audioplayer object) audioplayer used to play the original</span>
<span class="c">%   signal</span>
<span class="c">%</span>
<span class="c">% - player.mod: (audioplayer object) audioplayer used to play the modified</span>
<span class="c">%   signal</span>
<span class="c">%</span>
<span class="c">% - player.selected: (string) indicate the currently selected audio signal</span>
<span class="c">%   can be &#39;ori&#39; for the original signal, or &#39;mod&#39; for the modified signal</span>
<span class="c">%</span>
<span class="c">% - player.loop: (bool) indicate if the audio signal must be looped (true)</span>
<span class="c">%   or not (false) when playing</span>
<span class="c">%</span>
<span class="c">% - player.position: (scalar) sample position at which the audio playing</span>
<span class="c">%   will start at next pressing of start</span>
<span class="c">%</span>
<span class="c">% - player.forceStop: (bool) indicate to the stop function of the </span>
<span class="c">%   audioplayer that the player must be stopped (needed to be able to stop</span>
<span class="c">%   when looping)</span>
<span class="c">%</span>
<span class="c">% - player.positionPlotId: (graphics object handle vector) contains handles</span>
<span class="c">%   to the moving vertical white lines that are displayed on the </span>
<span class="c">%   visualizations to show the current position when playing</span>
<span class="c">%</span>
<span class="c">% default default data for some variables</span>
<span class="c">% PI: This could be used more systematically to define the default value</span>
<span class="c">% of all the parameters of the interface. It could then be used to</span>
<span class="c">% configure the application by loading variable default from a file during</span>
<span class="c">% initialization, and we could also give the possibility to the user</span>
<span class="c">% to modify these default values</span>
<span class="c">%</span>
<span class="c">% - default.dynamic: (scalar) default value for colorscale dynamic </span>
<span class="c">%   (positive number in dB)</span>
<span class="c">%</span>
<span class="c">% - default.opacity: (scalar) default value for opacity used for plotting</span>
<span class="c">%   of symbol (any value between 0:transparent and 1:opaque)</span>
<span class="c">%</span>
<span class="c">% - default.sel: (struct) default sel variable (see the description of sel)</span>
<span class="c">%</span>
<span class="c">% - default.frame: (struct) default frame variable (see the description of</span>
<span class="c">%   frame)     </span>
<span class="c">%</span>
<span class="c">% undoData: (cell) data for undo functionnality</span>
<span class="c">% Each cell of undoData contain a copy of the sel variable as it was at a</span>
<span class="c">% preceding state</span>
<span class="c">%</span>
<span class="c">% redoData: (cell) data for redo functionnality</span>
<span class="c">% Each cell of redoData contain a copy of the sel variable as it was at a</span>
<span class="c">% preceding state</span>
<span class="c">%</span>
<span class="c">% ___________________ End of description of shared data ___________________</span>
<span class="c">%</span>
<span class="c">% __________________________ Beginning of code ____________________________</span>
<span class="c">%</span>
<span class="c">% define the variables that will be used to share data between</span>
<span class="c">% interface components. They are defined at the top level of the function</span>
<span class="c">% so that they are usable by all the functions used by the interface (as</span>
<span class="c">% these are nested functions).</span>
<span class="n">coeff</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">default</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">frame</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">gui</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">link</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">player</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">redoData</span> <span class="p">=</span> <span class="p">{};</span>
<span class="n">sel</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">sig</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">undoData</span> <span class="p">=</span> <span class="p">{};</span>
<span class="n">visu</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">symbol</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">visucommon</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">export</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">export</span><span class="p">.</span><span class="n">xLim</span> <span class="p">=</span> <span class="mi">800</span><span class="p">;</span>
<span class="n">export</span><span class="p">.</span><span class="n">limitXaxesRes</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
<span class="n">export</span><span class="p">.</span><span class="n">symbol</span> <span class="p">=</span> <span class="p">{};</span>

<span class="c">% Dictionary of structures field names string expansions</span>
<span class="n">mulaclabDict</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;winType&#39;</span><span class="p">,</span><span class="s">&#39;Window type&#39;</span><span class="p">,</span><span class="c">...</span>
                      <span class="s">&#39;nbFreq&#39;</span><span class="p">,</span><span class="s">&#39;Number of frequency bins&#39;</span><span class="p">,</span><span class="c">...</span>
                      <span class="s">&#39;hop&#39;</span><span class="p">,</span><span class="s">&#39;Hop size&#39;</span><span class="p">,</span><span class="c">...</span>
                      <span class="s">&#39;winLen&#39;</span><span class="p">,</span><span class="s">&#39;Window length&#39;</span><span class="p">,</span><span class="c">...</span>
                      <span class="s">&#39;wavelet&#39;</span><span class="p">,</span><span class="s">&#39;Wavelet type&#39;</span><span class="p">,</span><span class="c">...</span>
                      <span class="s">&#39;J&#39;</span><span class="p">,</span><span class="s">&#39;Decomposition depth&#39;</span><span class="p">);</span>
                   
<span class="c">% Cellaray of supported frames                  </span>
<span class="n">supportedFramesIdx</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">supportedFrames</span> <span class="p">=</span> <span class="c">...</span>
<span class="p">{</span><span class="c">...</span>
  <span class="n">struct</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;Gabreal&#39;</span><span class="p">,</span><span class="s">&#39;def&#39;</span><span class="p">,</span><span class="c">...</span>
    <span class="n">struct</span><span class="p">(</span><span class="s">&#39;winType&#39;</span><span class="p">,</span><span class="s">&#39;hann&#39;</span><span class="p">,</span><span class="s">&#39;winLen&#39;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&#39;hop&#39;</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="c">...</span>
           <span class="s">&#39;nbFreq&#39;</span><span class="p">,</span><span class="mi">2048</span><span class="p">)),</span><span class="c">... </span>
  <span class="n">struct</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;erblet&#39;</span><span class="p">,</span><span class="s">&#39;def&#39;</span><span class="p">,</span><span class="c">...</span>
    <span class="n">struct</span><span class="p">(</span><span class="s">&#39;M&#39;</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="s">&#39;downsampling&#39;</span><span class="p">,</span><span class="s">&#39;fractionaluniform&#39;</span><span class="p">)),</span><span class="c">... </span>
  <span class="c">...</span>
  <span class="n">struct</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;cqt&#39;</span><span class="p">,</span><span class="s">&#39;def&#39;</span><span class="p">,</span><span class="c">...</span>
    <span class="n">struct</span><span class="p">(</span><span class="s">&#39;fmin&#39;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s">&#39;fmax&#39;</span><span class="p">,</span><span class="mi">20000</span><span class="p">,</span><span class="s">&#39;bins&#39;</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="s">&#39;downsampling&#39;</span><span class="p">,</span><span class="s">&#39;uniform&#39;</span><span class="p">)),</span><span class="c">... </span>
  <span class="c">...</span>
  <span class="n">struct</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;Gabor&#39;</span><span class="p">,</span><span class="s">&#39;def&#39;</span><span class="p">,</span><span class="c">...</span>
    <span class="n">struct</span><span class="p">(</span><span class="s">&#39;winType&#39;</span><span class="p">,</span><span class="s">&#39;hann&#39;</span><span class="p">,</span><span class="s">&#39;winLen&#39;</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="s">&#39;hop&#39;</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="c">...</span>
           <span class="s">&#39;nbFreq&#39;</span><span class="p">,</span><span class="mi">2048</span><span class="p">)),</span><span class="c">...</span>
<span class="c">%  ...</span>
<span class="c">%   struct(&#39;type&#39;,&#39;DWT&#39;,&#39;def&#39;,...</span>
<span class="c">%     struct(&#39;wavelet&#39;,&#39;sym10&#39;,&#39;J&#39;,8)),...</span>
<span class="c">%   ...</span>
<span class="c">%   struct(&#39;type&#39;,&#39;UDWT&#39;,&#39;def&#39;,...</span>
<span class="c">%     struct(&#39;wavelet&#39;,&#39;sym10&#39;,&#39;J&#39;,8)),...</span>
<span class="c">%   ...</span>
<span class="c">%   struct(&#39;type&#39;,&#39;WFBT&#39;,&#39;def&#39;,...</span>
<span class="c">%     struct(&#39;wavelet&#39;,&#39;sym10&#39;,&#39;J&#39;,7)),... </span>
<span class="c">%   ...</span>
<span class="c">%   struct(&#39;type&#39;,&#39;UWFBT&#39;,&#39;def&#39;,...</span>
<span class="c">%     struct(&#39;wavelet&#39;,&#39;sym10&#39;,&#39;J&#39;,4)),...   </span>
<span class="p">};</span>

<span class="n">iconpath</span><span class="p">=[</span><span class="n">ltfatbasepath</span><span class="p">,</span><span class="s">&#39;mulaclab&#39;</span><span class="p">,</span><span class="n">filesep</span><span class="p">,</span><span class="s">&#39;icons&#39;</span><span class="p">,</span><span class="n">filesep</span><span class="p">];</span>

<span class="c">% initialize the interface</span>
<span class="k">if</span><span class="p">(</span><span class="n">nargin</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span>
   <span class="n">file</span> <span class="p">=</span> <span class="p">[];</span>
<span class="k">end</span>
<span class="n">initialize</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>

<span class="c">% end of main function, from here everything is handled with the callbacks</span>
<span class="c">% using the following nested functions</span>

<span class="c">% __________________________ INITIALIZATION _______________________________</span>
<span class="k">  function</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span>file<span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="c">% check that we have all the toolboxes and functions that we need</span>
    <span class="n">checkToolbox</span><span class="p">;</span>
    
    <span class="c">% Display spash screen</span>
    <span class="n">warningText</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#39;\newline{\color{red}\bf PLEASE NOTE: When using a free-hand selection tool, do not \newline hold down the mouse button, but click on the corner points. }\newline&#39;</span><span class="p">];</span>
    <span class="n">msgboxText</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#39; MulacLab: Matlab GUI to manipulate the short-time Fourier &#39;</span> <span class="c">...</span>
               <span class="s">&#39;transform of a signal \newline using Gabor multipliers. &#39;</span><span class="c">...</span>
              <span class="s">&#39;\newline MulacLab makes use of the GPC Polygon Clipping library &#39;</span> <span class="c">...</span>
               <span class="s">&#39;available from \newline http://www.cs.man.ac.uk/~toby/alan/software/&#39;</span><span class="c">...</span>
             <span class="s">&#39;GPC and mulaclab are free for \newline non-commercial use only. Please see the &#39;</span> <span class="c">...</span>
               <span class="s">&#39;GPC homepage for the exact licensing \newline conditions.&#39;</span><span class="p">];</span>
    
    <span class="n">h</span><span class="p">=</span><span class="n">msgbox</span><span class="p">(</span><span class="n">msgboxText</span><span class="p">,</span><span class="s">&#39;MulacLab licensing&#39;</span><span class="p">,</span><span class="s">&#39;modal&#39;</span><span class="p">);</span>
    <span class="n">posh</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="s">&#39;Position&#39;</span><span class="p">);</span>
    <span class="n">posh</span><span class="p">(</span><span class="k">end</span><span class="p">)</span> <span class="p">=</span> <span class="mi">120</span><span class="p">;</span>
    <span class="n">set</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="s">&#39;Position&#39;</span><span class="p">,</span><span class="n">posh</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">findall</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">),</span> <span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;tex&#39;</span><span class="p">,</span> <span class="s">&#39;string&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">msgboxText</span><span class="p">,</span><span class="n">warningText</span><span class="p">]);</span> 
    <span class="n">uiwait</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">ishandle</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
       <span class="c">% Timeout occured, we close the box automatically.</span>
      <span class="n">close</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
    <span class="k">end</span><span class="p">;</span>
    
    <span class="n">loadFile</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">nargin</span><span class="o">==</span><span class="mi">0</span> <span class="o">||</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
         <span class="c">% get an original signal or decomposition to have something to show</span>
          <span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">,</span> <span class="n">filterIndex</span><span class="p">]</span> <span class="p">=</span> <span class="n">uigetfile</span><span class="p">(</span><span class="s">&#39;*.wav;*.mat&#39;</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;Open original signal or decomposition&#39;</span><span class="p">);</span> 

          <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="c">% the user pressed cancel, we stop here</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="k">end</span>
          <span class="n">loadFile</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">elseif</span><span class="p">(</span><span class="n">ischar</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
          <span class="n">fileName</span> <span class="p">=</span> <span class="n">file</span><span class="p">;</span>
          <span class="n">pathName</span> <span class="p">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
          <span class="n">loadFile</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>     

    <span class="k">if</span> <span class="n">loadFile</span>
      <span class="p">[</span><span class="o">~</span><span class="p">,</span> <span class="o">~</span><span class="p">,</span> <span class="n">ext</span><span class="p">]</span> <span class="p">=</span> <span class="n">fileparts</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
      <span class="k">switch</span> <span class="n">lower</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
        <span class="k">case</span> <span class="s">&#39;.wav&#39;</span>
          <span class="c">% read the orginal signal in a wave file</span>
          <span class="p">[</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">]</span> <span class="p">=</span><span class="c">...</span>
            <span class="n">wavload</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">]);</span>
          <span class="n">sig</span><span class="p">.</span><span class="nb">real</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
        <span class="k">case</span> <span class="s">&#39;.mat&#39;</span>
           <span class="c">% read the original signal decomposition in a mat file</span>
          <span class="n">data</span> <span class="p">=</span> <span class="n">load</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">]);</span>
          <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;frame&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isfield</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;savedSig&#39;</span><span class="p">)</span>
           <span class="n">frame</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
           <span class="n">sig</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">savedSig</span><span class="p">;</span>
          <span class="k">else</span>
           <span class="n">errordlg</span><span class="p">(</span><span class="c">...</span>
             <span class="p">[</span><span class="n">fileName</span> <span class="s">&#39; is not a valid signal decomposition file&#39;</span><span class="p">]);</span>
           <span class="k">return</span><span class="p">;</span>
          <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">elseif</span><span class="p">(</span><span class="n">nargin</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">Fs</span><span class="p">=[];</span>
       <span class="p">[</span><span class="n">flags</span><span class="p">,</span><span class="n">kv</span><span class="p">,</span><span class="n">Fs</span><span class="p">]=</span><span class="n">ltfatarghelper</span><span class="p">({</span><span class="s">&#39;Fs&#39;</span><span class="p">},</span><span class="n">definput</span><span class="p">,</span><span class="n">varargin</span><span class="p">);</span>
       <span class="k">if</span><span class="p">(</span><span class="nb">isempty</span><span class="p">(</span><span class="n">Fs</span><span class="p">))</span>
          <span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: Second parameter: sampling frequency is missing. &#39;</span><span class="p">,</span><span class="n">upper</span><span class="p">(</span><span class="n">mfilename</span><span class="p">));</span>
       <span class="k">end</span>
       
       <span class="k">if</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="nb">find</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
          <span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: Input has to be one channel signal.&#39;</span><span class="p">,</span><span class="n">upper</span><span class="p">(</span><span class="n">mfilename</span><span class="p">));</span>
       <span class="k">end</span>
       <span class="c">%normalize and change to column vector</span>
       <span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">=</span><span class="n">file</span><span class="p">(:)</span><span class="o">/</span><span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">file</span><span class="p">));</span>
       <span class="n">sig</span><span class="p">.</span><span class="nb">real</span><span class="p">=</span><span class="nb">isreal</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
       <span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span> <span class="p">=</span> <span class="n">Fs</span><span class="p">;</span>
       <span class="n">sig</span><span class="p">.</span><span class="n">nbBit</span> <span class="p">=</span> <span class="mi">16</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">errordlg</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;%s: Unrecognized input parameters.&#39;</span><span class="p">,</span><span class="n">upper</span><span class="p">(</span><span class="n">mfilename</span><span class="p">))</span>   <span class="p">);</span>
           <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>

    <span class="k">if</span> <span class="nb">size</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
       <span class="c">% multichannel wave, we keep only the first channel</span>
       <span class="n">sig</span><span class="p">.</span><span class="n">ori</span> <span class="p">=</span> <span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">end</span>
    
    <span class="n">sig</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">;</span>
    <span class="c">% intialize the different parameters of the application</span>
    <span class="n">initializeParameter</span><span class="p">;</span>
    
    <span class="c">% initialize the frame definition and the coefficients</span>
    <span class="n">frame</span> <span class="p">=</span> <span class="n">default</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
    <span class="c">%coeff.ori = calculateCoeff(sig.ori);</span>
    <span class="c">%coeff.mod = coeff.ori;</span>
    
    <span class="c">% intialize audioplayers</span>
    <span class="c">%initializePlayer;</span>
    
    <span class="c">% create main window</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span> <span class="p">=</span> <span class="n">figure</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="s">&#39;MulAcLab&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">mainFigPos</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Toolbar&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Colormap&#39;</span><span class="p">,</span> <span class="n">jet</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;ResizeFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">resize</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;MenuBar&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;WindowStyle&#39;</span><span class="p">,</span> <span class="s">&#39;normal&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Visible&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>

    <span class="c">% create menu of main window</span>
    <span class="n">menuFileId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;File&#39;</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Open original signal&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">openOriSig</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Import original signal decomposition&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">openOriDecompo</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Import selection&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">importSel</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Import symbol&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">importSymbol</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Save modified signal&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">saveModSig</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Separator&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Save original signal decomposition&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">saveOriDecompo</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Save modified signal decomposition&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">saveModDecompo</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Export selection as ...&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">exportSel</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFileId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Export symbol as ...&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">exportSymbol</span><span class="p">);</span>

    <span class="n">menuEditId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Edit&#39;</span><span class="p">);</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">undoMenuId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">menuEditId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Undo&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Accelerator&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;enable&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">undo</span><span class="p">);</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">redoMenuId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">menuEditId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Redo&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Accelerator&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;enable&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">redo</span><span class="p">);</span>

    <span class="n">menuFrameId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Frame&#39;</span><span class="p">);</span>
    <span class="n">menuFrameTypeId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFrameId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Choose frame type&#39;</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">supportedFrames</span><span class="p">)</span>
       <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFrameTypeId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="n">supportedFrames</span><span class="p">{</span><span class="n">ind</span><span class="p">}.</span><span class="n">type</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">changeFrameType</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;UserData&#39;</span><span class="p">,</span><span class="n">ind</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFrameId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Edit frame parameters&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">changeFrameDef</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFrameId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Load frame parameters&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">loadFrameParam</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Separator&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">menuFrameId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Save frame parameters&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">saveFrameParam</span><span class="p">);</span>

    <span class="n">menuVisuId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Visualization&#39;</span><span class="p">);</span>
    <span class="c">% !!! the folowing checked on or off should be set automatically</span>
    <span class="c">% during initialization</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">visuMenu</span><span class="p">.</span><span class="n">showModId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">menuVisuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Show modified signal&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Checked&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">toggleModVisu</span><span class="p">);</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">visuMenu</span><span class="p">.</span><span class="n">showOverviewId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">menuVisuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span><span class="s">&#39;Show overview of original signal&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Checked&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,@</span><span class="n">toggleOverviewVisu</span><span class="p">);</span>
     
    <span class="c">% intialize visualization</span>
    <span class="c">%updateVisu(true);</span>

    <span class="c">% create gui panels</span>
    <span class="n">currentY</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">indPanel</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">panelHeight</span><span class="p">)</span>
      <span class="n">gui</span><span class="p">.</span><span class="n">panelId</span><span class="p">(</span><span class="n">indPanel</span><span class="p">)</span> <span class="p">=</span> <span class="n">uipanel</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">panelTitle</span><span class="p">{</span><span class="n">indPanel</span><span class="p">},</span><span class="c">...</span>
        <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="n">currentY</span> <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span> <span class="n">gui</span><span class="p">.</span><span class="n">panelHeight</span><span class="p">(</span><span class="n">indPanel</span><span class="p">)]);</span>
      <span class="n">currentY</span> <span class="p">=</span> <span class="n">currentY</span> <span class="o">+</span> <span class="n">gui</span><span class="p">.</span><span class="n">panelHeight</span><span class="p">(</span><span class="n">indPanel</span><span class="p">);</span>
    <span class="k">end</span>

    <span class="c">% create audioplayers panel</span>
     <span class="n">drawAudioplayer</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">panelId</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="c">% </span>
<span class="c">% </span>
<span class="c">%     % create visualization tools panel</span>
     <span class="n">drawVisualizationTool</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">panelId</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="c">% </span>
<span class="c">%     % create selection tools panel</span>
     <span class="n">drawSelectionTool</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">panelId</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>

    <span class="c">% activate the current tool</span>
    <span class="c">% changeTool([], [], gui.curTool);</span>


    <span class="n">resetMulaclab</span><span class="p">();</span>
    <span class="n">toggleOverviewVisu</span><span class="p">();</span> <span class="c">% Do not show te overwiev window</span>
    <span class="n">resetSel</span><span class="p">();</span>
    <span class="n">resetSymbol</span><span class="p">();</span>
    
        <span class="c">% end of initialization, show the interface to the user</span>
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;Visible&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">initializeParameter</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="c">% set default values</span>

    <span class="c">% default colorscale dynamic in dB</span>
    <span class="n">default</span><span class="p">.</span><span class="n">dynamic</span> <span class="p">=</span> <span class="mi">60</span><span class="p">;</span>
    
    <span class="c">% default opacity parameter for symbol plotting (from 0:transparent to</span>
    <span class="c">% 1:opaque)</span>
    <span class="n">default</span><span class="p">.</span><span class="n">opacity</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span>
    
    <span class="c">% default selection</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">mode</span> <span class="p">=</span> <span class="s">&#39;union&#39;</span><span class="p">;</span> 
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">convType</span> <span class="p">=</span> <span class="s">&#39;constGain&#39;</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Gain&#39;</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">lineWidth</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="s">&#39;w&#39;</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">marker</span> <span class="p">=</span> <span class="s">&#39;none&#39;</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">markerSize</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">lineStyle</span> <span class="p">=</span> <span class="s">&#39;-&#39;</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">poly</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">.</span><span class="n">label</span> <span class="p">=</span> <span class="s">&#39;Layer&#39;</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">frame</span> <span class="p">=</span> <span class="n">supportedFrames</span><span class="p">{</span><span class="n">supportedFramesIdx</span><span class="p">};</span>
    
    <span class="n">default</span><span class="p">.</span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Selection&#39;</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">val</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">default</span><span class="p">.</span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">invert</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">default</span><span class="p">.</span><span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>

    
    <span class="n">default</span><span class="p">.</span><span class="n">zerotodb</span> <span class="p">=</span> <span class="o">-</span><span class="mi">40</span><span class="p">;</span>
    
    <span class="c">% define parameters for the gui (graphical user interface)</span>

    <span class="n">monitorPos</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;monitorposition&#39;</span><span class="p">);</span>
    <span class="n">monitorPos</span> <span class="p">=</span> <span class="n">monitorPos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">:);</span>
    <span class="n">ratio</span> <span class="p">=</span> <span class="mf">0.75</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">mainFigPos</span> <span class="p">=</span> <span class="nb">round</span><span class="p">([</span><span class="n">monitorPos</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio</span><span class="p">),</span><span class="c">...</span>
      <span class="nb">round</span><span class="p">(</span><span class="n">monitorPos</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">*</span><span class="n">ratio</span><span class="p">)]);</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span> <span class="p">=</span> <span class="mi">9</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span> <span class="o">+</span> <span class="mi">7</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span> <span class="p">=</span> <span class="mi">57</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">editWidth</span> <span class="p">=</span> <span class="mi">28</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.7</span> <span class="mf">0.7</span> <span class="mf">0.7</span><span class="p">];</span> <span class="c">% chosen to fit icons color</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">buttonWidth</span> <span class="p">=</span> <span class="mi">27</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span> <span class="p">=</span> <span class="mi">22</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">horiDist</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">margin</span> <span class="p">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
    <span class="n">nbButtton</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c">% number of buttons on one line</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">nbButtton</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">gui</span><span class="p">.</span><span class="n">horiDist</span> <span class="o">+</span><span class="c">...</span>
      <span class="n">nbButtton</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">buttonWidth</span><span class="p">;</span>

    <span class="n">gui</span><span class="p">.</span><span class="n">panelHeight</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">91</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">panelTitle</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="s">&#39;Audioplayer&#39;</span><span class="p">;</span>

    <span class="n">gui</span><span class="p">.</span><span class="n">panelHeight</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">220</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">panelTitle</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span> <span class="p">=</span> <span class="s">&#39;Visualization&#39;</span><span class="p">;</span>

    <span class="n">gui</span><span class="p">.</span><span class="n">panelHeight</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">=</span> <span class="mi">260</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">panelTitle</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span> <span class="p">=</span> <span class="s">&#39;Selection&#39;</span><span class="p">;</span>

    <span class="n">gui</span><span class="p">.</span><span class="n">visuResizeButtonWidth</span> <span class="p">=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">visuResizeButtonHeight</span> <span class="p">=</span> <span class="mi">15</span><span class="p">;</span>

    <span class="n">gui</span><span class="p">.</span><span class="n">curTool</span> <span class="p">=</span> <span class="s">&#39;freehand&#39;</span><span class="p">;</span>

    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">symbOpacity</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">showSymb</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">symbImageId</span> <span class="p">=</span> <span class="p">[];</span>

    <span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttongroupId</span> <span class="p">=</span> <span class="p">[];</span>
    
    <span class="c">% define parameters for the visualizations</span>

    <span class="c">% !!! height of visu at initilisation must be choosen so that the sum</span>
    <span class="c">% of visible visu is 1</span>
    
    <span class="c">% Main visualization: spectrogram of the original signal</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">label</span> <span class="p">=</span> <span class="s">&#39;originalMain&#39;</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="mf">0.67</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">position</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span> <span class="c">% we can initialise this with wathever</span>
                                     <span class="c">% value as it will be corrrected </span>
                                     <span class="c">% during resize</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">updateFcn</span> <span class="p">=</span> <span class="p">@</span><span class="n">updateVisuOriSpec</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">dynamic</span> <span class="p">=</span> <span class="n">default</span><span class="p">.</span><span class="n">dynamic</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">visible</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span> <span class="c">% Important: the orginalMain visu must always</span>
                            <span class="c">% stay visible</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">linkX</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">linkY</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">linkCLim</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">uipanelId</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">axesId</span> <span class="p">=</span> <span class="p">[];</span>

    <span class="c">% Visualization of the spectrogram of the modified signal</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">label</span> <span class="p">=</span> <span class="s">&#39;modified&#39;</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">position</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">updateFcn</span> <span class="p">=</span> <span class="p">@</span><span class="n">updateVisuModSpec</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">dynamic</span> <span class="p">=</span> <span class="n">default</span><span class="p">.</span><span class="n">dynamic</span><span class="p">;</span> <span class="c">% useless if linkCLim is true</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">visible</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">linkX</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">linkY</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">linkCLim</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">uipanelId</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">axesId</span> <span class="p">=</span> <span class="p">[];</span>

    <span class="c">% Visualization for the overview of the original spectrogram with fast</span>
    <span class="c">% scrolling</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">label</span> <span class="p">=</span> <span class="s">&#39;originalOverview&#39;</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="mf">0.33</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">position</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">updateFcn</span> <span class="p">=</span> <span class="p">@</span><span class="n">updateVisuOriOverview</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">dynamic</span> <span class="p">=</span> <span class="n">default</span><span class="p">.</span><span class="n">dynamic</span><span class="p">;</span> <span class="c">% useless if linkCLim is true</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">visible</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">linkX</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">linkY</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">linkCLim</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">uipanelId</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">visu</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">axesId</span> <span class="p">=</span> <span class="p">[];</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span> <span class="p">=</span> <span class="n">NaN</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">checkToolbox</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span> <span class="n">isoctave</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&#39;This function requires Matlab.&#39;</span><span class="p">);</span>      
    <span class="k">end</span><span class="p">;</span>
    
    <span class="c">% Check that the Image Processing Toolbox is available</span>
    <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">ver</span><span class="p">(</span><span class="s">&#39;images&#39;</span><span class="p">))</span>
        <span class="n">error</span><span class="p">(</span><span class="c">...</span>
          <span class="s">&#39;This function requires the Matlab Image Processing Toolbox.&#39;</span><span class="p">);</span>
    <span class="k">end</span>

    <span class="c">% Check that the function for polygon clipping is available</span>
    <span class="n">temp1</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">temp1</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">temp1</span><span class="p">.</span><span class="n">hole</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">temp2</span> <span class="p">=</span> <span class="n">temp1</span><span class="p">;</span>
    <span class="k">try</span>
      <span class="n">temp</span> <span class="p">=</span> <span class="n">PolygonClip</span><span class="p">(</span><span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">);</span>
    <span class="k">catch</span> 
      <span class="n">error</span><span class="p">([</span><span class="s">&#39;This function requires the function PolygonClip for &#39;</span> <span class="c">...</span>
             <span class="s">&#39;polygon clipping. Please compile using the &quot;ltfatmex&quot; &#39;</span> <span class="c">...</span>
             <span class="s">&#39;command.&#39;</span><span class="p">]);</span>
    <span class="k">end</span>

    <span class="c">% !!! check if some other toolboxes are needed (signal processing?)</span>
  <span class="k">end</span>

<span class="c">% ___________________ COMPUTATIONAL FUNCTIONS _____________________________</span>

<span class="k">  function</span><span class="w"> </span>coef <span class="p">=</span><span class="w"> </span><span class="nf">calculateCoeff</span><span class="p">(</span>f<span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="k">switch</span> <span class="n">lower</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
       <span class="k">case</span> <span class="s">&#39;gabreal&#39;</span>
          <span class="n">win</span> <span class="p">=</span> <span class="n">firwin</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">winType</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">winLen</span><span class="p">);</span>
          <span class="n">coef</span> <span class="p">=</span> <span class="n">dgtreal</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">hop</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">nbFreq</span><span class="p">);</span>
       <span class="k">case</span> <span class="s">&#39;gabor&#39;</span>
          <span class="n">win</span> <span class="p">=</span> <span class="n">firwin</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">winType</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">winLen</span><span class="p">);</span>
          <span class="n">coef</span> <span class="p">=</span> <span class="n">dgt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">hop</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">nbFreq</span><span class="p">);</span>
       <span class="k">case</span> <span class="p">{</span><span class="s">&#39;erblet&#39;</span><span class="p">,</span><span class="s">&#39;cqt&#39;</span><span class="p">}</span>
           <span class="n">coef</span> <span class="p">=</span> <span class="n">filterbank</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">g</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">a</span><span class="p">);</span>
       <span class="k">case</span> <span class="s">&#39;dwt&#39;</span>
          <span class="p">[</span><span class="n">coef</span><span class="p">,</span> <span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">]</span> <span class="p">=</span> <span class="n">fwt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">wavelet</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">J</span><span class="p">);</span>
       <span class="k">case</span> <span class="s">&#39;wfbt&#39;</span>
          <span class="p">[</span><span class="n">coef</span><span class="p">,</span> <span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">]</span> <span class="p">=</span> <span class="n">wfbt</span><span class="p">(</span><span class="n">f</span><span class="p">,{</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">wavelet</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">J</span><span class="p">,</span><span class="s">&#39;full&#39;</span><span class="p">});</span>
       <span class="k">case</span> <span class="s">&#39;uwfbt&#39;</span>
          <span class="p">[</span><span class="n">coef</span><span class="p">,</span> <span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">]</span> <span class="p">=</span> <span class="n">uwfbt</span><span class="p">(</span><span class="n">f</span><span class="p">,{</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">wavelet</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">J</span><span class="p">,</span><span class="s">&#39;full&#39;</span><span class="p">});</span>
       <span class="k">case</span> <span class="s">&#39;udwt&#39;</span>
          <span class="p">[</span><span class="n">coef</span><span class="p">,</span> <span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">]</span> <span class="p">=</span> <span class="n">ufwt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">wavelet</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">J</span><span class="p">);</span>
       <span class="k">otherwise</span>
          <span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: Unrecognized frame type&#39;</span><span class="p">,</span><span class="n">upper</span><span class="p">(</span><span class="n">mfilename</span><span class="p">));</span>
     <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>fhat <span class="p">=</span><span class="w"> </span><span class="nf">recFromCoeff</span><span class="p">(</span>coef<span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="k">switch</span> <span class="n">lower</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
       <span class="k">case</span> <span class="s">&#39;gabreal&#39;</span>
          <span class="n">win</span> <span class="p">=</span> <span class="n">gabdual</span><span class="p">(</span><span class="n">firwin</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">winType</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">winLen</span><span class="p">),</span> <span class="c">...</span>
          <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">hop</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">nbFreq</span><span class="p">);</span>
          <span class="n">fhat</span> <span class="p">=</span> <span class="n">idgtreal</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">hop</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">nbFreq</span><span class="p">,</span> <span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">));</span>
       <span class="k">case</span> <span class="s">&#39;gabor&#39;</span>
          <span class="n">win</span> <span class="p">=</span> <span class="n">gabdual</span><span class="p">(</span><span class="n">firwin</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">winType</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">winLen</span><span class="p">),</span> <span class="c">...</span>
          <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">hop</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">nbFreq</span><span class="p">);</span>
          <span class="n">fhat</span> <span class="p">=</span> <span class="n">idgt</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">hop</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">));</span>
       <span class="k">case</span> <span class="p">{</span><span class="s">&#39;erblet&#39;</span><span class="p">,</span><span class="s">&#39;cqt&#39;</span><span class="p">}</span>
          <span class="n">fhat</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">real</span><span class="p">(</span><span class="n">ifilterbank</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">gdual</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">)));</span>   
       <span class="k">case</span> <span class="s">&#39;dwt&#39;</span>
          <span class="n">fhat</span> <span class="p">=</span> <span class="n">ifwt</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">);</span>
       <span class="k">case</span> <span class="s">&#39;wfbt&#39;</span>
          <span class="n">fhat</span> <span class="p">=</span> <span class="n">iwfbt</span><span class="p">(</span><span class="n">coef</span><span class="p">,{</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">wavelet</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">J</span><span class="p">,</span><span class="s">&#39;full&#39;</span><span class="p">},</span><span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">));</span>
       <span class="k">case</span> <span class="s">&#39;uwfbt&#39;</span>
          <span class="n">fhat</span> <span class="p">=</span> <span class="n">iuwfbt</span><span class="p">(</span><span class="n">coef</span><span class="p">,{</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">wavelet</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">J</span><span class="p">,</span><span class="s">&#39;full&#39;</span><span class="p">});</span>
       <span class="k">case</span> <span class="s">&#39;udwt&#39;</span>
          <span class="n">fhat</span> <span class="p">=</span> <span class="n">iufwt</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">);</span>
       <span class="k">otherwise</span>
          <span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: Unrecognized frame type&#39;</span><span class="p">,</span><span class="n">upper</span><span class="p">(</span><span class="n">mfilename</span><span class="p">));</span> 
     <span class="k">end</span>
    <span class="n">fhat</span> <span class="p">=</span> <span class="nb">real</span><span class="p">(</span><span class="n">fhat</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>C <span class="p">=</span><span class="w"> </span><span class="nf">plotCoeff</span><span class="p">(</span>coef,axesId,key,value<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">switch</span> <span class="n">lower</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
       <span class="k">case</span> <span class="s">&#39;gabreal&#39;</span>
          <span class="n">C</span> <span class="p">=</span> <span class="n">plotdgtreal</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">hop</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">nbFreq</span><span class="p">,</span><span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
       <span class="k">case</span> <span class="s">&#39;gabor&#39;</span>
          <span class="n">C</span> <span class="p">=</span> <span class="n">plotdgt</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">hop</span><span class="p">,</span><span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
       <span class="k">case</span> <span class="p">{</span><span class="s">&#39;erblet&#39;</span><span class="p">,</span><span class="s">&#39;cqt&#39;</span><span class="p">}</span>
          <span class="n">C</span> <span class="p">=</span> <span class="n">plotfilterbank</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">fc</span><span class="p">,</span><span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
       <span class="k">case</span> <span class="p">{</span><span class="s">&#39;dwt&#39;</span><span class="p">,</span><span class="s">&#39;udwt&#39;</span><span class="p">,</span><span class="s">&#39;wfbt&#39;</span><span class="p">,</span><span class="s">&#39;uwfbt&#39;</span><span class="p">,</span><span class="s">&#39;ufwt&#39;</span><span class="p">}</span>
          <span class="n">C</span> <span class="p">=</span> <span class="n">plotwavelets</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">,</span><span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
       <span class="k">otherwise</span>
          <span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: Unrecognized frame type&#39;</span><span class="p">,</span><span class="n">upper</span><span class="p">(</span><span class="n">mfilename</span><span class="p">));</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">export</span><span class="p">.</span><span class="n">limitXaxesRes</span>
        <span class="n">C</span><span class="p">=</span><span class="n">interp1</span><span class="p">(</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">size</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="n">C</span><span class="p">.</span><span class="s">&#39;,linspace(0,1,export.xLim),&#39;</span><span class="n">nearest</span><span class="o">&#39;</span><span class="p">);</span>
        <span class="n">C</span><span class="p">=</span><span class="n">C</span><span class="p">.</span><span class="s">&#39;;</span>
<span class="s">    end</span>
<span class="s">  end</span>

<span class="s">  function mult = convSymbToCoefFormat(symb)</span>
<span class="s">     switch lower(frame.type)</span>
<span class="s">        % Classical gabor coeff format </span>
<span class="s">        case {&#39;</span><span class="n">gabreal</span><span class="o">&#39;</span><span class="p">,</span><span class="s">&#39;gabor&#39;</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">export</span><span class="p">.</span><span class="n">limitXaxesRes</span>
              <span class="n">L</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
              <span class="n">Lplot</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
              <span class="n">mult</span><span class="p">=</span><span class="n">interp1</span><span class="p">(</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Lplot</span><span class="p">),</span><span class="n">symb</span><span class="p">.</span><span class="s">&#39;,linspace(0,1,L),&#39;</span><span class="n">nearest</span><span class="o">&#39;</span><span class="p">);</span>
              <span class="n">mult</span> <span class="p">=</span> <span class="n">mult</span><span class="p">.</span><span class="s">&#39;;</span>
<span class="s">            else</span>
<span class="s">              mult = symb;</span>
<span class="s">           end</span>
<span class="s">           </span>
<span class="s">        % Cell array containing column vectors format</span>
<span class="s">        case {&#39;</span><span class="n">wfbt</span><span class="o">&#39;</span><span class="p">,</span><span class="s">&#39;erblet&#39;</span><span class="p">,</span><span class="s">&#39;cqt&#39;</span><span class="p">}</span>
           <span class="n">M</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">);</span>
           <span class="n">Lplot</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
           <span class="n">Lc</span> <span class="p">=</span> <span class="n">cellfun</span><span class="p">(@(</span><span class="n">cEl</span><span class="p">)</span> <span class="nb">size</span><span class="p">(</span><span class="n">cEl</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">);</span>
           <span class="n">mult</span> <span class="p">=</span> <span class="n">cell</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">));</span>
           <span class="k">for</span> <span class="n">m</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span>
              <span class="n">mult</span><span class="p">{</span><span class="n">m</span><span class="p">}</span> <span class="p">=</span> <span class="n">interp1</span><span class="p">(</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Lplot</span><span class="p">),</span><span class="n">symb</span><span class="p">(</span><span class="n">m</span><span class="p">,:),</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Lc</span><span class="p">(</span><span class="n">m</span><span class="p">)),</span><span class="s">&#39;nearest&#39;</span><span class="p">).</span><span class="s">&#39;;</span>
<span class="s">           end</span>
<span class="s">        % FWT specific coefficient format</span>
<span class="s">        case &#39;</span><span class="n">dwt</span><span class="o">&#39;</span>
           <span class="n">Lc</span> <span class="p">=</span> <span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">Lc</span><span class="p">;</span>
           <span class="n">Lcstart</span> <span class="p">=</span> <span class="n">cumsum</span><span class="p">([</span><span class="mi">1</span><span class="p">;</span><span class="n">Lc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">)]);</span>
           <span class="n">Lcend</span> <span class="p">=</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">Lc</span><span class="p">);</span>
           <span class="n">mult</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="n">Lc</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
           <span class="n">M</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">Lc</span><span class="p">);</span>
           <span class="n">Lplot</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
           <span class="k">for</span> <span class="n">m</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span>
              <span class="n">mult</span><span class="p">(</span><span class="n">Lcstart</span><span class="p">(</span><span class="n">m</span><span class="p">):</span><span class="n">Lcend</span><span class="p">(</span><span class="n">m</span><span class="p">))</span> <span class="p">=</span> <span class="n">interp1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Lplot</span><span class="p">,</span><span class="n">symb</span><span class="p">(</span><span class="n">m</span><span class="p">,:),</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Lplot</span><span class="p">,</span><span class="n">Lc</span><span class="p">(</span><span class="n">m</span><span class="p">)),</span><span class="s">&#39;nearest&#39;</span><span class="p">).</span><span class="s">&#39;;</span>
<span class="s">           end  </span>
<span class="s">        % ufilterbak and all wavelet functions beginning with u</span>
<span class="s">        case {&#39;</span><span class="n">udwt</span><span class="o">&#39;</span><span class="p">,</span><span class="s">&#39;uwfbt&#39;</span><span class="p">}</span>
           <span class="n">M</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
           <span class="n">L</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
           <span class="n">Lplot</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
           <span class="n">mult</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">));</span>
           <span class="k">for</span> <span class="n">m</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span>
              <span class="n">mult</span><span class="p">(:,</span><span class="n">m</span><span class="p">)</span> <span class="p">=</span> <span class="n">interp1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Lplot</span><span class="p">,</span><span class="n">symb</span><span class="p">(</span><span class="n">m</span><span class="p">,:),</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Lplot</span><span class="p">,</span><span class="n">L</span><span class="p">),</span><span class="s">&#39;nearest&#39;</span><span class="p">).</span><span class="s">&#39;;</span>
<span class="s">           end</span>
<span class="s">        otherwise</span>
<span class="s">          error(&#39;</span><span class="c">%s: Unrecognized frame type&#39;,upper(mfilename));</span>
     <span class="k">end</span>

  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>symb <span class="p">=</span><span class="w"> </span><span class="nf">convCoefFormatToSymb</span><span class="p">(</span>mult<span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="k">switch</span> <span class="n">lower</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
        <span class="c">% Classical gabor coeff format </span>
        <span class="k">case</span> <span class="p">{</span><span class="s">&#39;gabreal&#39;</span><span class="p">,</span><span class="s">&#39;gabor&#39;</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">export</span><span class="p">.</span><span class="n">limitXaxesRes</span>
              <span class="n">L</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
              <span class="n">Lmult</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
              <span class="n">symb</span><span class="p">=</span><span class="n">interp1</span><span class="p">(</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Lmult</span><span class="p">),</span><span class="n">mult</span><span class="p">.</span><span class="s">&#39;,linspace(0,1,L),&#39;</span><span class="n">nearest</span><span class="o">&#39;</span><span class="p">);</span>
              <span class="n">symb</span> <span class="p">=</span> <span class="n">symb</span><span class="p">.</span><span class="s">&#39;;</span>
<span class="s">            else</span>
<span class="s">              symb=mult;</span>
<span class="s">           end</span>

<span class="s">        % Cell array containing column vectors format</span>
<span class="s">        case {&#39;</span><span class="n">wfbt</span><span class="o">&#39;</span><span class="p">,</span><span class="s">&#39;erblet&#39;</span><span class="p">,</span><span class="s">&#39;cqt&#39;</span><span class="p">}</span>
           <span class="n">M</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">);</span>
           <span class="n">Lsymb</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
           <span class="n">Lc</span> <span class="p">=</span> <span class="n">cellfun</span><span class="p">(@(</span><span class="n">cEl</span><span class="p">)</span> <span class="nb">size</span><span class="p">(</span><span class="n">cEl</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">mult</span><span class="p">);</span>
           <span class="n">symb</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">));</span>
           <span class="k">for</span> <span class="n">m</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span>
              <span class="n">symb</span><span class="p">(</span><span class="n">m</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">interp1</span><span class="p">(</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Lc</span><span class="p">(</span><span class="n">m</span><span class="p">)),</span><span class="n">mult</span><span class="p">{</span><span class="n">m</span><span class="p">},</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Lsymb</span><span class="p">),</span><span class="s">&#39;nearest&#39;</span><span class="p">);</span>
           <span class="k">end</span>
        <span class="c">% FWT specific coefficient format</span>
        <span class="k">case</span> <span class="s">&#39;dwt&#39;</span>
           <span class="n">Lc</span> <span class="p">=</span> <span class="n">coeff</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">Lc</span><span class="p">;</span>
           <span class="n">Lcstart</span> <span class="p">=</span> <span class="n">cumsum</span><span class="p">([</span><span class="mi">1</span><span class="p">;</span><span class="n">Lc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">)]);</span>
           <span class="n">Lcend</span> <span class="p">=</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">Lc</span><span class="p">);</span>
           <span class="n">symb</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">));</span>
           <span class="c">%mult = zeros(sum(Lc),1);</span>
           <span class="n">M</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">Lc</span><span class="p">);</span>
           <span class="n">Lplot</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
           <span class="k">for</span> <span class="n">m</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span>
             <span class="n">symb</span><span class="p">(</span><span class="n">m</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">interp1</span><span class="p">(</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Lplot</span><span class="p">,</span><span class="n">Lc</span><span class="p">(</span><span class="n">m</span><span class="p">)),</span><span class="n">mult</span><span class="p">(</span><span class="n">Lcstart</span><span class="p">(</span><span class="n">m</span><span class="p">):</span><span class="n">Lcend</span><span class="p">(</span><span class="n">m</span><span class="p">)),</span><span class="mi">1</span><span class="p">:</span><span class="n">Lplot</span><span class="p">,</span><span class="s">&#39;nearest&#39;</span><span class="p">);</span>
           <span class="k">end</span>  
        <span class="c">% ufilterbak and all wavelet functions beginning with u</span>
        <span class="k">case</span> <span class="p">{</span><span class="s">&#39;udwt&#39;</span><span class="p">,</span><span class="s">&#39;uwfbt&#39;</span><span class="p">}</span>
           <span class="n">L</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
           <span class="n">M</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
           <span class="n">Lmult</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
           <span class="n">symb</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">));</span>
           <span class="k">for</span> <span class="n">m</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span>
              <span class="n">symb</span><span class="p">(</span><span class="n">m</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">interp1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Lmult</span><span class="p">,</span><span class="n">mult</span><span class="p">(:,</span><span class="n">m</span><span class="p">),</span><span class="nb">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Lmult</span><span class="p">,</span><span class="n">L</span><span class="p">),</span><span class="s">&#39;nearest&#39;</span><span class="p">);</span>
           <span class="k">end</span>
        <span class="k">otherwise</span>
          <span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: Unrecognized frame type&#39;</span><span class="p">,</span><span class="n">upper</span><span class="p">(</span><span class="n">mfilename</span><span class="p">));</span>
     <span class="k">end</span>

  <span class="k">end</span>


<span class="k">  function</span><span class="w"> </span><span class="nf">precomputeStuff</span><span class="p">()</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="s">&#39;precomp&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isfield</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">,</span><span class="s">&#39;L&#39;</span><span class="p">)</span> <span class="c">...</span>
          <span class="o">&amp;&amp;</span> <span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">L</span> <span class="o">==</span> <span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">)</span>
          <span class="c">% Already done, do nothing.</span>
          <span class="k">return</span><span class="p">;</span>
      <span class="k">end</span>
      <span class="n">frame</span><span class="p">.</span><span class="n">precomp</span> <span class="p">=</span> <span class="n">struct</span><span class="p">();</span>
      <span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">L</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">);</span>      
      
      <span class="k">switch</span> <span class="n">lower</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
          <span class="k">case</span> <span class="s">&#39;erblet&#39;</span>
             <span class="p">[</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">g</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">fc</span><span class="p">]</span> <span class="p">=</span> <span class="c">...</span>
                 <span class="n">erbfilters</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">),</span><span class="s">&#39;M&#39;</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">M</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">downsampling</span><span class="p">);</span>
             <span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">gdual</span> <span class="p">=</span> <span class="c">...</span>
                 <span class="n">filterbankrealdual</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">g</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">));</span>
          <span class="k">case</span> <span class="s">&#39;cqt&#39;</span>
             <span class="p">[</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">g</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">fc</span><span class="p">]</span> <span class="p">=</span> <span class="c">...</span>
                 <span class="n">cqtfilters</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">fmin</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">fmax</span><span class="p">,</span><span class="c">...</span>
                            <span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">bins</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">),</span><span class="n">frame</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">downsampling</span><span class="p">);</span>
             <span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">gdual</span> <span class="p">=</span> <span class="c">...</span>
                 <span class="n">filterbankrealdual</span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">g</span><span class="p">,</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="c">...</span>
                 <span class="n">filterbanklength</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">),</span><span class="n">frame</span><span class="p">.</span><span class="n">precomp</span><span class="p">.</span><span class="n">a</span><span class="p">));</span>
      <span class="k">end</span>
          
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">applyMultiplier</span><span class="p">(</span>c,mult<span class="p">)</span><span class="w"></span>
<span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">isnumeric</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">isnumeric</span><span class="p">(</span><span class="n">mult</span><span class="p">))</span>
        <span class="n">coeff</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">c</span><span class="o">.*</span><span class="n">mult</span><span class="p">;</span>
     <span class="k">elseif</span><span class="p">(</span><span class="n">iscell</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">iscell</span><span class="p">(</span><span class="n">mult</span><span class="p">))</span>
        <span class="n">coeff</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">cellfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="n">x</span><span class="o">.*</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mult</span><span class="p">,</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="n">false</span><span class="p">);</span>
     <span class="k">else</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: Unrecognized frame type&#39;</span><span class="p">,</span><span class="n">upper</span><span class="p">(</span><span class="n">mfilename</span><span class="p">));</span>
     <span class="k">end</span>
     
     <span class="n">sig</span><span class="p">.</span><span class="nb">mod</span>  <span class="p">=</span> <span class="n">recFromCoeff</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="nb">mod</span><span class="p">);</span>    
     <span class="n">updatePlayerMod</span><span class="p">;</span>
     <span class="n">coeff</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">calculateCoeff</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="nb">mod</span><span class="p">);</span>
     <span class="n">modInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;modified&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
     <span class="k">if</span> <span class="o">~</span><span class="n">visu</span><span class="p">(</span><span class="n">modInd</span><span class="p">).</span><span class="n">visible</span>
       <span class="n">toggleModVisu</span><span class="p">;</span>
     <span class="k">end</span>
     <span class="n">updateVisu</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">applySel</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w">    </span>
<span class="w">    </span><span class="c">% convert the selection to get the symbol of the multiplier and apply </span>
    <span class="c">% the multiplier</span>
    <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span><span class="p">).</span><span class="n">val</span><span class="p">)</span>    
      <span class="n">mult</span> <span class="p">=</span> <span class="n">convSymbToCoefFormat</span><span class="p">(</span><span class="n">convSelToSymb</span><span class="p">());</span>
    <span class="k">else</span>
      <span class="n">mult</span> <span class="p">=</span> <span class="n">convSymbToCoefFormat</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span><span class="p">).</span><span class="n">val</span><span class="p">);</span>
    <span class="k">end</span>
     <span class="n">applyMultiplier</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="n">mult</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>symb <span class="p">=</span><span class="w"> </span><span class="nf">convSelToSymb</span><span class="p">()</span><span class="w"></span>
<span class="w">     </span><span class="n">symb</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">));</span>
    
    <span class="k">for</span> <span class="n">indLay</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">)</span>
      <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">mask</span> <span class="p">=</span> <span class="n">convPolyToMask</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">);</span>
        <span class="n">symbCurr</span> <span class="p">=</span> <span class="n">convMaskToSymb</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">indLay</span><span class="p">);</span>
        <span class="n">symb</span> <span class="p">=</span> <span class="n">symb</span><span class="o">.*</span><span class="n">symbCurr</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">warning</span><span class="p">([</span><span class="s">&#39;Selection layer &#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">indLay</span><span class="p">)</span><span class="c">...</span>
          <span class="s">&#39; is currently empty&#39;</span><span class="p">]);</span>
      <span class="k">end</span>
    <span class="k">end</span>

  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>mask <span class="p">=</span><span class="w"> </span><span class="nf">convPolyToMask</span><span class="p">(</span>poly<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">mask</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">));</span> 
    <span class="c">% !!! Note: type of data for the mask might be optmized (bool, uint8?)</span>

    <span class="c">% !!! could be optimized by doing the conversion in smaller boxes </span>
    <span class="c">% around each polygon (not on the whole time-frequency plane)</span>
    <span class="c">% and also working with a smaller mask when signal is real</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
      <span class="n">xvals</span> <span class="p">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">convAxesToIndX</span><span class="p">(</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span><span class="p">));</span>
      <span class="n">yvals</span> <span class="p">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">convAxesToIndY</span><span class="p">(</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span><span class="p">));</span>
      <span class="n">tmpmask</span> <span class="p">=</span> <span class="n">poly2mask</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
      
      
      <span class="k">if</span> <span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">hole</span>
        <span class="n">mask</span> <span class="p">=</span> <span class="n">mask</span> <span class="o">-</span> <span class="n">tmpmask</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="n">mask</span> <span class="p">=</span> <span class="n">mask</span> <span class="o">+</span> <span class="n">tmpmask</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c">% !!! modifiy this: don&#39;t do the symetrisation on the mask, but on the</span>
    <span class="c">% symbol to insure that the results is real</span>
<span class="c">%     if sig.real</span>
<span class="c">%       temp = ceil(size(mask, 1)/2);</span>
<span class="c">%       mask(end:-1:end-temp+2,:) = mask(2:temp,:);</span>
<span class="c">%     end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>symb <span class="p">=</span><span class="w"> </span><span class="nf">convMaskToSymb</span><span class="p">(</span>mask, indLay<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% !!! precise that a case should be added here when creating new</span>
    <span class="c">% selection type</span>
    <span class="k">switch</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">convType</span>
      <span class="k">case</span> <span class="s">&#39;constGain&#39;</span>
        <span class="n">gain</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span><span class="p">;</span>
        <span class="n">symb</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">));</span>
        <span class="n">symb</span> <span class="p">=</span> <span class="n">symb</span> <span class="o">+</span> <span class="p">(</span><span class="n">gain</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">mask</span><span class="p">;</span>
      <span class="k">case</span> <span class="s">&#39;smoothBorder&#39;</span>
        <span class="n">gain</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span><span class="p">;</span>
        <span class="n">threshold</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">val</span><span class="p">;</span>
        <span class="c">% bwdist returns single</span>
        <span class="n">symb</span> <span class="p">=</span> <span class="n">double</span><span class="p">(</span><span class="n">bwdist</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">));</span>
        <span class="n">symb</span><span class="p">(</span><span class="n">symb</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="p">=</span> <span class="n">threshold</span><span class="p">;</span>
        <span class="n">symb</span> <span class="p">=</span> <span class="n">symb</span> <span class="o">*</span> <span class="p">(</span><span class="n">gain</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">threshold</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">case</span> <span class="s">&#39;fill&#39;</span>
        <span class="c">% !!! first filling test, just interpolating in 3D the modulus</span>
        
    
        <span class="c">% estimation of the level in the neighbourhood of the selection</span>
        
        <span class="n">timeRadius</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span><span class="p">;</span>
        <span class="n">freqRadius</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">val</span><span class="p">;</span>
        
        <span class="c">% find the points that are just next to the selection</span>
        <span class="n">neighbour</span> <span class="p">=</span> <span class="n">imdilate</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">strel</span><span class="p">(</span><span class="s">&#39;square&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="n">mask</span><span class="p">;</span>
        
        <span class="c">% for these points, compute mean level in a specified neighbourhood</span>
        <span class="c">% (but not taking into account the values of the transform inside </span>
        <span class="c">% the selection)</span>
        
        <span class="c">% create the matrix defining the neighbourhood</span>
        <span class="n">mat</span> <span class="p">=</span> <span class="n">computeEllipse</span><span class="p">(</span><span class="n">freqRadius</span><span class="p">,</span> <span class="n">timeRadius</span><span class="p">);</span> 
        <span class="c">% !!! this could be a more general filter if we want</span>
        <span class="c">%mat  = mat./norm(mat);</span>
        <span class="c">%temp1 = roifilt2(mat, abs(coeff.ori).^2 .* (1-mask), neighbour);</span>
        <span class="n">temp1</span> <span class="p">=</span> <span class="n">roifilt2</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mf">10.</span>^<span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span> <span class="o">.*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">mask</span><span class="p">),</span> <span class="n">neighbour</span><span class="p">);</span>
        <span class="n">temp2</span> <span class="p">=</span> <span class="n">roifilt2</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">mask</span><span class="p">,</span> <span class="n">neighbour</span><span class="p">);</span>
        
        <span class="c">% !!! specifiy in comment that we have to do this to take into</span>
        <span class="c">% account the hole</span>
        
        <span class="p">[</span><span class="n">ind1Neigh</span><span class="p">,</span> <span class="n">ind2Neigh</span><span class="p">]</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">neighbour</span><span class="p">);</span>

        <span class="n">valNeigh</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">temp1</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">temp1</span><span class="p">),</span> <span class="n">ind1Neigh</span><span class="p">,</span><span class="c">...</span>
          <span class="n">ind2Neigh</span><span class="p">))</span><span class="o">./</span><span class="n">temp2</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">temp2</span><span class="p">),</span> <span class="n">ind1Neigh</span><span class="p">,</span> <span class="n">ind2Neigh</span><span class="p">)));</span>

        <span class="p">[</span><span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">]</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">mask</span><span class="p">);</span>

        <span class="k">try</span> 
          <span class="n">valInterp</span> <span class="p">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">ind1Neigh</span><span class="p">,</span> <span class="n">ind2Neigh</span><span class="p">,</span> <span class="n">valNeigh</span><span class="p">,</span><span class="c">...</span>
            <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">,</span> <span class="s">&#39;linear&#39;</span><span class="p">);</span>
        <span class="k">catch</span>
          <span class="c">% sometime griddata fail, and adding this option seem to solve</span>
          <span class="c">% the problem, but I don&#39;t really know what I&#39;m doing here !!!</span>
          <span class="n">valInterp</span> <span class="p">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">ind1Neigh</span><span class="p">,</span> <span class="n">ind2Neigh</span><span class="p">,</span> <span class="n">valNeigh</span><span class="p">,</span><span class="c">...</span>
            <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">,</span> <span class="s">&#39;linear&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;QJ&#39;</span><span class="p">});</span>
        <span class="k">end</span>

        <span class="n">symb</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">));</span>
        <span class="c">% !!! there will be division by zero problem in the following</span>
        <span class="c">% solve this problem</span>
        <span class="n">symb</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">symb</span><span class="p">),</span> <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">))</span> <span class="p">=</span> <span class="n">valInterp</span> <span class="o">./</span><span class="c">...</span>
          <span class="nb">abs</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">),</span> <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">)));</span>

        <span class="c">% !!! temporary modif: should be removed when modification are done</span>
        <span class="c">% so that symetrisation is done on symbol and not mask when signal</span>
        <span class="c">% is real</span>
<span class="c">%         if sig.real</span>
<span class="c">%           temp = ceil(size(symb, 1)/2);</span>
<span class="c">%           symb(end:-1:end-temp+2,:) = conj(symb(2:temp,:));</span>
<span class="c">%         end</span>
      <span class="k">case</span> <span class="s">&#39;fillNoise&#39;</span>
        <span class="c">% other hole filling test, using coefficients taken from a noise</span>
        <span class="c">% estimation of the level in the neighbourhood of the selection</span>
        
        <span class="n">timeRadius</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span><span class="p">;</span>
        <span class="n">freqRadius</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">val</span><span class="p">;</span>
        
        <span class="c">% find the points that are just next to the selection</span>
        <span class="n">neighbour</span> <span class="p">=</span> <span class="n">imdilate</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">strel</span><span class="p">(</span><span class="s">&#39;square&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="n">mask</span><span class="p">;</span>
        
        <span class="c">% for these points, compute mean level in a specified neighbourhood</span>
        <span class="c">% (but not taking into account the values of the transform inside </span>
        <span class="c">% the selection)</span>
        
        <span class="c">% create the matrix defining the neighbourhood</span>
        <span class="n">mat</span> <span class="p">=</span> <span class="n">computeEllipse</span><span class="p">(</span><span class="n">freqRadius</span><span class="p">,</span> <span class="n">timeRadius</span><span class="p">);</span>
        <span class="c">% !!! this could be a more general filter if we want</span>
        
        <span class="n">temp1</span> <span class="p">=</span> <span class="n">roifilt2</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mf">10.</span>^<span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">.*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">mask</span><span class="p">),</span> <span class="n">neighbour</span><span class="p">);</span>
        <span class="n">temp2</span> <span class="p">=</span> <span class="n">roifilt2</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">mask</span><span class="p">,</span> <span class="n">neighbour</span><span class="p">);</span>
        
        <span class="c">% !!! specifiy in comment that we have to do this to take into</span>
        <span class="c">% account the hole</span>
        
        <span class="p">[</span><span class="n">ind1Neigh</span><span class="p">,</span> <span class="n">ind2Neigh</span><span class="p">]</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">neighbour</span><span class="p">);</span>

        <span class="n">valNeigh</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">temp1</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">temp1</span><span class="p">),</span> <span class="n">ind1Neigh</span><span class="p">,</span><span class="c">...</span>
          <span class="n">ind2Neigh</span><span class="p">))</span><span class="o">./</span><span class="n">temp2</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">temp2</span><span class="p">),</span> <span class="n">ind1Neigh</span><span class="p">,</span> <span class="n">ind2Neigh</span><span class="p">)));</span>

        <span class="p">[</span><span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">]</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">mask</span><span class="p">);</span>

        <span class="k">try</span> 
          <span class="n">valInterp</span> <span class="p">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">ind1Neigh</span><span class="p">,</span> <span class="n">ind2Neigh</span><span class="p">,</span> <span class="n">valNeigh</span><span class="p">,</span> <span class="c">...</span>
            <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">,</span> <span class="s">&#39;linear&#39;</span><span class="p">);</span>
        <span class="k">catch</span>
          <span class="c">% sometime griddata fail, and adding this option seem to solve</span>
          <span class="c">% the problem, but I don&#39;t really know what I&#39;m doing here !!!</span>
          <span class="n">valInterp</span> <span class="p">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">ind1Neigh</span><span class="p">,</span> <span class="n">ind2Neigh</span><span class="p">,</span> <span class="n">valNeigh</span><span class="p">,</span><span class="c">...</span>
            <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">,</span> <span class="s">&#39;linear&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;QJ&#39;</span><span class="p">});</span>
          
          <span class="c">% !!! remove this</span>
          <span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Problem with griddata&#39;</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="n">symb</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">));</span>

        <span class="c">% compute the transform of a noise</span>
        <span class="c">% !!! should be done in a nicer way with an external function </span>
        <span class="c">% so that it works with any kind of frame</span>
        <span class="c">%noiseLen = (max(ind2Mask) - min(ind2Mask) + 1) * ( numel(sig.ori)/size(coeff.oriC,2)) ;</span>
        <span class="n">noise</span> <span class="p">=</span> <span class="nb">rand</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span>

        <span class="c">% win = firwin(frame.def.winType, frame.def.winLen); </span>
        <span class="c">% coeffNoise = frame.funcAna(noise, win, frame.def.hop, frame.def.nbFreq);</span>
        <span class="n">coeffNoise</span> <span class="p">=</span> <span class="n">calculateCoeff</span><span class="p">(</span><span class="n">noise</span><span class="p">);</span>
        <span class="c">% !!! test figure(100); imagesc(20*log10(abs(coeffNoise)))</span>
        
        <span class="c">% !!! there will be division by zero problem in the following</span>
        <span class="c">% solve this problem</span>
        
        <span class="c">% !!! old version</span>
<span class="c">%         symb(sub2ind(size(symb), ind1Mask, ind2Mask)) = valInterp .*...</span>
<span class="c">%           coeffNoise(sub2ind(size(coeffNoise), ind1Mask,...</span>
<span class="c">%           ind2Mask-min(ind2Mask)+1)) ./...</span>
<span class="c">%           coeff.ori(sub2ind(size(coeff.ori), ind1Mask, ind2Mask)) ./...</span>
<span class="c">%           abs(coeffNoise(sub2ind(size(coeffNoise), ind1Mask,...</span>
<span class="c">%           ind2Mask-min(ind2Mask)+1)));</span>



        <span class="c">% !!! here all the interpolations and mean are done directly on the</span>
        <span class="c">% absolute value of the  coefficients, it could be more meaningfull</span>
        <span class="c">% to work with the sqaure of the modulus due to its possible</span>
        <span class="c">% intepretation a energy ditribution</span>
        <span class="n">coeffNoiseSymb</span> <span class="p">=</span> <span class="n">convCoefFormatToSymb</span><span class="p">(</span><span class="n">coeffNoise</span><span class="p">);</span>
        <span class="n">meanLevelNoise</span> <span class="p">=</span> <span class="n">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coeffNoiseSymb</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeffNoiseSymb</span><span class="p">),</span> <span class="c">...</span>
          <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="o">-</span><span class="n">min</span><span class="p">(</span><span class="n">ind2Mask</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span> <span class="o">/</span> <span class="nb">length</span><span class="p">(</span><span class="n">ind1Mask</span><span class="p">);</span>
        
        <span class="c">% !!! tests</span>
        
        
<span class="c">%         symb(sub2ind(size(symb), ind1Mask, ind2Mask)) = valInterp .*...</span>
<span class="c">%           coeffNoise(sub2ind(size(coeffNoise), ind1Mask,...</span>
<span class="c">%           ind2Mask-min(ind2Mask)+1)) ./...</span>
<span class="c">%           (coeff.ori(sub2ind(size(coeff.ori), ind1Mask, ind2Mask)) *...</span>
<span class="c">%           meanLevelNoise);</span>

        <span class="n">symb</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">symb</span><span class="p">),</span> <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">))</span> <span class="p">=</span> <span class="n">valInterp</span> <span class="o">.*</span><span class="c">...</span>
          <span class="n">coeffNoiseSymb</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeffNoiseSymb</span><span class="p">),</span> <span class="n">ind1Mask</span><span class="p">,</span><span class="c">...</span>
          <span class="n">ind2Mask</span><span class="o">-</span><span class="n">min</span><span class="p">(</span><span class="n">ind2Mask</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">./</span><span class="c">...</span>
          <span class="p">(</span><span class="n">coeffNoiseSymb</span><span class="p">(</span><span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeffNoiseSymb</span><span class="p">),</span> <span class="n">ind1Mask</span><span class="p">,</span> <span class="n">ind2Mask</span><span class="p">))</span> <span class="o">*</span><span class="c">...</span>
          <span class="n">meanLevelNoise</span><span class="p">);</span>

<span class="c">%         meanLevelOri = sum(abs(coeff.ori(sub2ind(size(coeff.ori), ...</span>
<span class="c">%           ind1Mask, ind2Mask)))) / length(ind1Mask);</span>
<span class="c">% </span>
<span class="c">%         symb(sub2ind(size(symb), ind1Mask, ind2Mask)) = ...</span>
<span class="c">%           meanLevelOri*coeffNoise(sub2ind(size(coeffNoise), ind1Mask,...</span>
<span class="c">%           ind2Mask-min(ind2Mask)+1+ 5)) ./...</span>
<span class="c">%           (coeff.ori(sub2ind(size(coeff.ori), ind1Mask, ind2Mask))*meanLevelNoise);</span>

        <span class="c">% !!! temporary modif: should be removed when modification are done</span>
        <span class="c">% so that symetrisation is done on symbol and not mask when signal </span>
        <span class="c">% is real</span>
<span class="c">%         if sig.real</span>
<span class="c">%           temp = ceil(size(symb, 1)/2);</span>
<span class="c">%           symb(end:-1:end-temp+2,:) = conj(symb(2:temp,:));</span>
<span class="c">%         end</span>
        
    <span class="k">end</span> <span class="c">% of switch</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>xData <span class="p">=</span><span class="w"> </span><span class="nf">convIndToAxesX</span><span class="p">(</span>ind<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% convert scale from image index to scale used by axes along X axe</span>
    <span class="c">% xData = (ind-1) * (frame.def.hop / sig.sampFreq);</span>
    <span class="n">hop</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">)</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">xData</span> <span class="p">=</span> <span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">hop</span> <span class="o">/</span> <span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>ind <span class="p">=</span><span class="w"> </span><span class="nf">convAxesToIndX</span><span class="p">(</span>xData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% !!! there is no round (on purpose), should be added if we really want</span>
    <span class="c">% an integer index</span>
    <span class="c">% convert scale from scale used by axes to image index along X axe</span>
    <span class="c">% ind = xData * (sig.sampFreq / frame.def.hop) + 1;</span>
    <span class="n">hop</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">)</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">ind</span> <span class="p">=</span> <span class="n">xData</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span> <span class="o">/</span> <span class="n">hop</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>yData <span class="p">=</span><span class="w"> </span><span class="nf">convIndToAxesY</span><span class="p">(</span>ind<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% convert scale from image index to scale used by axes along Y axe</span>
    <span class="c">% yData = (ind-1) * (sig.sampFreq / frame.def.nbFreq);</span>
    <span class="n">Ylim</span> <span class="p">=</span> <span class="n">visucommon</span><span class="p">.</span><span class="n">oriYlim</span><span class="p">;</span>
    <span class="n">yData</span> <span class="p">=</span> <span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">Ylim</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">Ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span> <span class="o">+</span><span class="n">Ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>ind <span class="p">=</span><span class="w"> </span><span class="nf">convAxesToIndY</span><span class="p">(</span>yData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% !!! there is no round (on purpose), should be added if we really want</span>
    <span class="c">% an integer index</span>
    <span class="c">% convert scale from scale used by axes to image index along Y axe</span>
    <span class="n">Ylim</span> <span class="p">=</span> <span class="n">visucommon</span><span class="p">.</span><span class="n">oriYlim</span><span class="p">;</span>
    <span class="n">ind</span> <span class="p">=</span> <span class="p">(</span><span class="n">yData</span><span class="o">-</span><span class="n">Ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ylim</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">Ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>ellipse <span class="p">=</span><span class="nf">computeEllipse</span><span class="p">(</span>dim1Radius, dim2Radius<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">ellipse</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dim1Radius</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">dim2Radius</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">ellipse</span><span class="p">(</span><span class="n">dim1Radius</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">ellipse</span><span class="p">(:,</span> <span class="n">dim2Radius</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">ind1</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">dim1Radius</span><span class="o">-</span><span class="mi">1</span>
      <span class="k">for</span> <span class="n">ind2</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">dim2Radius</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">ind1</span><span class="o">/</span><span class="n">dim1Radius</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">ind2</span><span class="o">/</span><span class="n">dim2Radius</span><span class="p">)</span>^<span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span><span class="p">=</span> <span class="mi">1</span>
          <span class="n">ellipse</span><span class="p">(</span><span class="n">dim1Radius</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">ind1</span><span class="p">,</span> <span class="n">dim2Radius</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">ellipse</span><span class="p">(</span><span class="n">dim1Radius</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">ind1</span><span class="p">,</span> <span class="n">dim2Radius</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">ellipse</span><span class="p">(</span><span class="n">dim1Radius</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">ind1</span><span class="p">,</span> <span class="n">dim2Radius</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">ellipse</span><span class="p">(</span><span class="n">dim1Radius</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">ind1</span><span class="p">,</span> <span class="n">dim2Radius</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="c">% _____________________ GENERAL FUNCTIONS FOR UI __________________________</span>

<span class="k">  function</span><span class="w"> </span>matlabVersion <span class="p">=</span><span class="w"> </span><span class="nf">getMatlabVersion</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">matlabVersion</span> <span class="p">=</span> <span class="n">ver</span><span class="p">(</span><span class="s">&#39;Matlab&#39;</span><span class="p">);</span>
    <span class="n">matlabVersion</span> <span class="p">=</span> <span class="n">matlabVersion</span><span class="p">.</span><span class="n">Version</span><span class="p">;</span>
    <span class="c">% the version number is sometime of the form X.X.X, so it cannot be</span>
    <span class="c">% easily converted into a number, so we need to modify it so that it </span>
    <span class="c">% is more usable for comparison</span>
    <span class="n">temp</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">matlabVersion</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">);</span>
    <span class="n">temp</span> <span class="p">=</span> <span class="n">temp</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">);</span>
    <span class="k">for</span>  <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c">% we remove the extra points &#39;.&#39; in the string</span>
      <span class="n">matlabVersion</span> <span class="p">=</span> <span class="n">matlabVersion</span><span class="p">([</span><span class="mi">1</span><span class="p">:</span><span class="n">temp</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">temp</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">]);</span>
    <span class="k">end</span>
    <span class="n">matlabVersion</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">matlabVersion</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">resetMulaclab</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">initializePlayer</span><span class="p">;</span>
    <span class="c">% Precompute stuff</span>
    <span class="n">precomputeStuff</span><span class="p">();</span>
    
    
    <span class="n">coeff</span><span class="p">.</span><span class="n">ori</span> <span class="p">=</span> <span class="n">calculateCoeff</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">);</span>
    <span class="n">sig</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">;</span>
    <span class="n">coeff</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">;</span>
    <span class="n">resetSel</span><span class="p">();</span>
    <span class="n">undoData</span> <span class="p">=</span> <span class="p">{};</span>
    <span class="n">modInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;modified&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">modInd</span><span class="p">).</span><span class="n">visible</span>
       <span class="n">toggleModVisu</span><span class="p">();</span>
    <span class="k">end</span>
    <span class="n">updateVisu</span><span class="p">(</span><span class="n">true</span><span class="p">);</span> <span class="c">% update visualization with reset of axes limits</span>
    
    <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">visucommon</span><span class="p">.</span><span class="n">oriYlim</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;Ylim&#39;</span><span class="p">);</span>
    
    <span class="c">% activate the current tool</span>
    <span class="n">changeTool</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">gui</span><span class="p">.</span><span class="n">curTool</span><span class="p">);</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">openOriSig</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w">   </span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">,</span> <span class="n">filterIndex</span><span class="p">]</span> <span class="p">=</span> <span class="n">uigetfile</span><span class="p">(</span><span class="s">&#39;*.wav&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Open original signal&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="p">[</span><span class="n">newSig</span><span class="p">,</span> <span class="n">sampFreq</span><span class="p">]</span> <span class="p">=</span> <span class="n">wavload</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">]);</span>
    <span class="k">if</span> <span class="nb">size</span><span class="p">(</span><span class="n">newSig</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="c">% multichannel wave, we keep only the first channel</span>
      <span class="n">newSig</span> <span class="p">=</span> <span class="n">newSig</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span> <span class="p">=</span> <span class="n">sampFreq</span><span class="p">;</span>
    <span class="n">sig</span><span class="p">.</span><span class="n">ori</span> <span class="p">=</span> <span class="n">newSig</span><span class="p">;</span>
    <span class="n">sig</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">newSig</span><span class="p">;</span>
    <span class="n">sig</span><span class="p">.</span><span class="nb">real</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    
    <span class="n">resetMulaclab</span><span class="p">();</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">saveModSig</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uiputfile</span><span class="p">(</span><span class="s">&#39;*.wav&#39;</span><span class="p">,</span> <span class="s">&#39;Save modified signal&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">wavsave</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">,[</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">]);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">openOriDecompo</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uigetfile</span><span class="p">(</span><span class="s">&#39;*.mat&#39;</span><span class="p">,</span> <span class="s">&#39;Load frame parameters&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">data</span> <span class="p">=</span> <span class="n">load</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">]);</span>
    <span class="k">if</span> <span class="o">~</span><span class="p">(</span><span class="n">isfield</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;frame&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isfield</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;savedSig&#39;</span><span class="p">))</span>
      <span class="n">errordlg</span><span class="p">([</span><span class="n">fileName</span> <span class="s">&#39; is not a valid signal decomposition file&#39;</span><span class="p">]);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="n">frame</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
    <span class="n">sig</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">savedSig</span><span class="p">;</span>
    <span class="n">sig</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">;</span>
    
    <span class="n">resetMulaclab</span><span class="p">();</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">saveOriDecompo</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uiputfile</span><span class="p">(</span><span class="s">&#39;*.mat&#39;</span><span class="p">,</span> <span class="s">&#39;Export selection&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">savedSig</span> <span class="p">=</span> <span class="n">sig</span><span class="p">;</span>
    <span class="n">rmfield</span><span class="p">(</span><span class="n">savedSig</span><span class="p">,</span> <span class="s">&#39;mod&#39;</span><span class="p">);</span>
    <span class="n">save</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">],</span> <span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;savedSig&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">saveModDecompo</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uiputfile</span><span class="p">(</span><span class="s">&#39;*.mat&#39;</span><span class="p">,</span> <span class="s">&#39;Export selection&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">savedSig</span> <span class="p">=</span> <span class="n">sig</span><span class="p">;</span>
    <span class="n">savedSig</span><span class="p">.</span><span class="n">ori</span> <span class="p">=</span> <span class="n">savedSig</span><span class="p">.</span><span class="nb">mod</span><span class="p">;</span>
    <span class="n">rmfield</span><span class="p">(</span><span class="n">savedSig</span><span class="p">,</span> <span class="s">&#39;mod&#39;</span><span class="p">);</span>
    <span class="n">save</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">],</span> <span class="s">&#39;frame&#39;</span><span class="p">,</span> <span class="s">&#39;savedSig&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">exportSel</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uiputfile</span><span class="p">(</span><span class="s">&#39;*.mat&#39;</span><span class="p">,</span> <span class="s">&#39;Export selection&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">save</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">],</span> <span class="s">&#39;sel&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">exportSymbol</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uiputfile</span><span class="p">(</span><span class="s">&#39;*.png&#39;</span><span class="p">,</span> <span class="s">&#39;Export symbol as...&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">cm</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span><span class="s">&#39;Colormap&#39;</span><span class="p">);</span>
    <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">Clim</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CLim&#39;</span><span class="p">);</span>
    <span class="n">oriIdx</span> <span class="p">=</span> <span class="nb">round</span><span class="p">((</span><span class="nb">flipud</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">)</span><span class="o">-</span><span class="n">Clim</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">Clim</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">Clim</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">oriExt</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">([</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">),</span><span class="mi">3</span><span class="p">]);</span>
    <span class="n">oriExt</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">oriIdx</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">));</span>
    <span class="n">oriExt</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">oriIdx</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">));</span>
    <span class="n">oriExt</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">)</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">oriIdx</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">));</span>
    
<span class="c">% exporting imported symbols is not supported (does not make sence)   </span>
<span class="c">%     symb = symbol.data(symbol.curSymb).val;</span>
<span class="c">%     if(isempty(symb))</span>
<span class="c">%        absSymb = flipud(abs(convSelToSymb()));</span>
<span class="c">%     else</span>
<span class="c">%        absSymb = flipud(abs(symb)); </span>
<span class="c">%     end</span>

    <span class="n">absSymb</span> <span class="p">=</span> <span class="nb">flipud</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">convSelToSymb</span><span class="p">()));</span>
    <span class="n">imwrite</span><span class="p">(</span><span class="n">oriExt</span><span class="p">,[</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">],</span><span class="s">&#39;png&#39;</span><span class="p">,</span><span class="s">&#39;Alpha&#39;</span><span class="p">,</span><span class="n">absSymb</span><span class="p">,</span><span class="s">&#39;bitdepth&#39;</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">importSel</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uigetfile</span><span class="p">(</span><span class="s">&#39;*.mat&#39;</span><span class="p">,</span> <span class="s">&#39;Import selection&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">data</span> <span class="p">=</span> <span class="n">load</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">]);</span>
    <span class="k">if</span> <span class="o">~</span><span class="n">isfield</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;sel&#39;</span><span class="p">)</span>
      <span class="n">errordlg</span><span class="p">([</span><span class="n">fileName</span> <span class="s">&#39; is not a valid signal selection file&#39;</span><span class="p">]);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="c">% as the saved selection might have been created using a longer signal,</span>
    <span class="c">% or a signal with a higher sampling frequency, it could be wider that</span>
    <span class="c">% the part of the time-frequency plane corresponding to the signal. </span>
    <span class="c">% We need to force the selection to stay in the right region</span>
    <span class="n">fullPoly</span> <span class="p">=</span> <span class="n">fullSigPoly</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">)</span>
      <span class="c">% intersection of the polygon with a polygon covering the whole</span>
      <span class="c">% signal</span>
      <span class="n">data</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">poly</span> <span class="p">=</span> <span class="n">PolygonClip</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">poly</span><span class="p">,</span><span class="c">...</span>
        <span class="n">fullPoly</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">end</span>
    
    <span class="n">delSel</span><span class="p">;</span>
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">+</span><span class="nb">length</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">))</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">;</span>
    <span class="n">updateLayerList</span><span class="p">;</span>
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">changeSelLay</span><span class="p">;</span>
    <span class="n">drawAllSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k"> function</span><span class="w"> </span><span class="nf">importSymbol</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uigetfile</span><span class="p">(</span><span class="s">&#39;*.png&#39;</span><span class="p">,</span> <span class="s">&#39;Import symbol&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="p">[</span><span class="nb">imag</span><span class="p">,</span> <span class="o">~</span><span class="p">,</span> <span class="n">alpha</span><span class="p">]</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span> <span class="n">pathName</span><span class="p">,</span><span class="n">fileName</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="nb">imag</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">errordlg</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;%s does not contain alpha channel.&#39;</span><span class="p">,</span><span class="n">fileName</span><span class="p">));</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="k">end</span>
      <span class="n">mask</span> <span class="p">=</span> <span class="n">double</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">double</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">alpha</span><span class="p">(:)));</span>
    <span class="k">else</span>
      <span class="n">mask</span> <span class="p">=</span> <span class="n">double</span><span class="p">(</span><span class="nb">imag</span><span class="p">)</span><span class="o">/</span><span class="n">double</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="nb">imag</span><span class="p">(:)));</span>
    <span class="k">end</span>

    <span class="k">if</span> <span class="n">any</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">)</span><span class="o">~=</span><span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
      <span class="n">errordlg</span><span class="p">([</span><span class="n">fileName</span> <span class="s">&#39; is not a valid symbol image. The dimensions are different.&#39;</span><span class="p">]);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="c">%limit</span>
    <span class="n">mmss</span> <span class="p">=</span> <span class="mi">10</span>^<span class="p">(</span><span class="n">default</span><span class="p">.</span><span class="n">zerotodb</span><span class="o">/</span><span class="mi">20</span><span class="p">);</span>
    <span class="n">mask</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">&lt;</span><span class="n">mmss</span><span class="p">)</span> <span class="p">=</span> <span class="n">mmss</span><span class="p">;</span>

    <span class="n">addSymbolListItem</span><span class="p">(</span><span class="nb">flipud</span><span class="p">(</span><span class="n">mask</span><span class="p">));</span>
    <span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">symbListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span><span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span><span class="p">);</span>
    <span class="n">updateSymbolList</span><span class="p">();</span>
    <span class="n">handleSymb</span><span class="p">();</span>
  <span class="k">end</span>

  <span class="c">% Menu callback function. When frame parameters are changed.</span>
<span class="k">  function</span><span class="w"> </span><span class="nf">changeFrameDef</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">newFrame</span> <span class="p">=</span> <span class="n">changeFrameDialog</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">newFrame</span><span class="p">)</span>
      <span class="n">frame</span> <span class="p">=</span> <span class="n">newFrame</span><span class="p">;</span>
      <span class="n">resetMulaclab</span><span class="p">();</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c">% When frame type is changed</span>
<span class="k">  function</span><span class="w"> </span><span class="nf">changeFrameType</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">resetSymbol</span><span class="p">();</span> 
     
    <span class="n">supportedFramesIdx</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span><span class="s">&#39;UserData&#39;</span><span class="p">);</span> 
    <span class="n">newFrame</span> <span class="p">=</span> <span class="n">supportedFrames</span><span class="p">{</span><span class="n">supportedFramesIdx</span><span class="p">};</span>
    <span class="c">%newFrame = changeGaborFrameDialog(frame);</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">newFrame</span><span class="p">)</span>
      <span class="n">frame</span> <span class="p">=</span> <span class="n">newFrame</span><span class="p">;</span>
      <span class="n">resetMulaclab</span><span class="p">();</span> 
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>newFrame <span class="p">=</span><span class="w"> </span><span class="nf">changeFrameDialog</span><span class="p">(</span>oldFrame<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">newFrame</span> <span class="p">=</span> <span class="p">[];</span>
    
    <span class="n">margin</span> <span class="p">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">];</span>
    <span class="n">textSize</span> <span class="p">=</span> <span class="p">[</span><span class="mi">170</span><span class="p">,</span> <span class="mi">20</span><span class="p">];</span>
    <span class="n">editSize</span> <span class="p">=</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">20</span><span class="p">];</span>
    <span class="n">spaceSize</span> <span class="p">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">];</span>
    
    <span class="n">nbParam</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">(</span><span class="n">oldFrame</span><span class="p">.</span><span class="n">def</span><span class="p">));</span>
    <span class="n">dialogPosition</span> <span class="p">=</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="c">...</span>
      <span class="mi">2</span><span class="o">*</span><span class="n">margin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">textSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">editSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">spaceSize</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="c">...</span>
      <span class="mi">2</span><span class="o">*</span><span class="n">margin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">nbParam</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">textSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">nbParam</span><span class="o">*</span><span class="n">spaceSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span>
    
    <span class="n">dialogId</span> <span class="p">=</span> <span class="n">dialog</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">oldFrame</span><span class="p">.</span><span class="n">type</span><span class="p">,</span><span class="s">&#39; frame parameters&#39;</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">dialogPosition</span><span class="p">);</span>
    
    <span class="n">buttonWidth</span> <span class="p">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="n">buttonX</span> <span class="p">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">dialogPosition</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span><span class="c">...</span>
      <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">buttonWidth</span> <span class="o">+</span> <span class="n">spaceSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
    
    <span class="n">buttonOkId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">dialogId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;pushbutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;OK&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">callbackOk</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">buttonX</span><span class="p">,</span> <span class="n">margin</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">buttonWidth</span><span class="p">,</span> <span class="n">textSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)]);</span>
    
    
    <span class="n">buttonCancelId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">dialogId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;pushbutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;Cancel&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">callbackCancel</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">buttonX</span><span class="o">+</span><span class="n">buttonWidth</span><span class="o">+</span><span class="n">spaceSize</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">margin</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="c">...</span>
        <span class="n">buttonWidth</span><span class="p">,</span> <span class="n">textSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)]);</span>
     
    <span class="n">oldFramedef</span> <span class="p">=</span> <span class="n">oldFrame</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
    <span class="n">fieldNames</span> <span class="p">=</span> <span class="n">fieldnames</span><span class="p">(</span><span class="n">oldFramedef</span><span class="p">);</span>
    <span class="n">fieldNames</span> <span class="p">=</span> <span class="n">fieldNames</span><span class="p">(</span><span class="k">end</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">objIds</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">fieldNames</span><span class="p">));</span>
    
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">fieldNames</span><span class="p">)</span>
       <span class="n">posText</span> <span class="p">=</span> <span class="p">[</span><span class="n">margin</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ind</span><span class="o">*</span><span class="p">(</span><span class="n">spaceSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">textSize</span><span class="p">(</span><span class="mi">2</span><span class="p">))],</span> <span class="n">textSize</span><span class="p">];</span>
       <span class="n">posEdit</span> <span class="p">=</span> <span class="p">[</span><span class="n">margin</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="c">...</span>
          <span class="n">ind</span><span class="o">*</span><span class="p">(</span><span class="n">spaceSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">textSize</span><span class="p">(</span><span class="mi">2</span><span class="p">))]</span><span class="o">+</span><span class="p">[</span><span class="n">textSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">spaceSize</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span><span class="c">...</span>
          <span class="n">editSize</span><span class="p">];</span>
       
       <span class="n">propLabel</span> <span class="p">=</span> <span class="n">fieldNames</span><span class="p">{</span><span class="n">ind</span><span class="p">};</span>
       <span class="k">if</span><span class="p">(</span><span class="n">exist</span><span class="p">(</span><span class="s">&#39;mulaclabDict&#39;</span><span class="p">,</span><span class="s">&#39;var&#39;</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="n">isfield</span><span class="p">(</span><span class="n">mulaclabDict</span><span class="p">,</span><span class="n">propLabel</span><span class="p">))</span>
          <span class="n">propLabel</span> <span class="p">=</span> <span class="n">getfield</span><span class="p">(</span><span class="n">mulaclabDict</span><span class="p">,</span><span class="n">propLabel</span><span class="p">);</span>
       <span class="k">end</span>
          
        <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
       <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">dialogId</span><span class="p">,</span><span class="c">...</span>
       <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">,</span><span class="c">...</span>
       <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">propLabel</span><span class="p">,</span><span class="c">...</span>
       <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">posText</span><span class="p">);</span>
   
      <span class="n">strVal</span> <span class="p">=</span> <span class="n">getfield</span><span class="p">(</span><span class="n">oldFramedef</span><span class="p">,</span><span class="n">fieldNames</span><span class="p">{</span><span class="n">ind</span><span class="p">});</span>
      <span class="k">if</span><span class="p">(</span><span class="n">isnumeric</span><span class="p">(</span><span class="n">strVal</span><span class="p">))</span>
         <span class="n">strVal</span> <span class="p">=</span> <span class="n">num2str</span><span class="p">(</span><span class="n">strVal</span><span class="p">);</span>
      <span class="k">end</span>
       <span class="n">objIds</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
       <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">dialogId</span><span class="p">,</span><span class="c">...</span>
       <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;edit&#39;</span><span class="p">,</span><span class="c">...</span>
       <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">strVal</span><span class="p">,</span><span class="c">...</span>
       <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">posEdit</span><span class="p">);</span>
    <span class="k">end</span>
        
    <span class="n">uiwait</span><span class="p">(</span><span class="n">dialogId</span><span class="p">);</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">callbackOk</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">newFrame</span> <span class="p">=</span> <span class="n">oldFrame</span><span class="p">;</span>
      <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">newFrame</span><span class="p">,</span><span class="s">&#39;precomp&#39;</span><span class="p">)</span>
          <span class="n">newFrame</span> <span class="p">=</span> <span class="n">rmfield</span><span class="p">(</span><span class="n">newFrame</span><span class="p">,</span><span class="s">&#39;precomp&#39;</span><span class="p">);</span>
      <span class="k">end</span>
      
      <span class="k">for</span> <span class="n">ind2</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">fieldNames</span><span class="p">)</span>
         <span class="n">val</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">objIds</span><span class="p">(</span><span class="n">ind2</span><span class="p">),</span><span class="s">&#39;string&#39;</span><span class="p">);</span>
          <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">errordlg</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;%s parameter is invalid.&#39;</span><span class="p">,</span><span class="n">fieldNames</span><span class="p">{</span><span class="n">ind2</span><span class="p">}));</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="k">end</span>
          <span class="k">if</span><span class="p">(</span><span class="n">isnumeric</span><span class="p">(</span><span class="n">getfield</span><span class="p">(</span><span class="n">oldFramedef</span><span class="p">,</span><span class="n">fieldNames</span><span class="p">{</span><span class="n">ind2</span><span class="p">})))</span>
             <span class="n">newFrame</span><span class="p">.</span><span class="n">def</span> <span class="p">=</span> <span class="n">setfield</span><span class="p">(</span><span class="n">newFrame</span><span class="p">.</span><span class="n">def</span><span class="p">,</span><span class="n">fieldNames</span><span class="p">{</span><span class="n">ind2</span><span class="p">},</span><span class="nb">round</span><span class="p">(</span><span class="n">str2num</span><span class="p">(</span><span class="n">val</span><span class="p">)));</span>
          <span class="k">else</span>
             <span class="n">newFrame</span><span class="p">.</span><span class="n">def</span> <span class="p">=</span> <span class="n">setfield</span><span class="p">(</span><span class="n">newFrame</span><span class="p">.</span><span class="n">def</span><span class="p">,</span><span class="n">fieldNames</span><span class="p">{</span><span class="n">ind2</span><span class="p">},</span><span class="n">val</span><span class="p">);</span>
          <span class="k">end</span>
      <span class="k">end</span>
      <span class="n">close</span><span class="p">(</span><span class="n">dialogId</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">callbackCancel</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">newFrame</span> <span class="p">=</span> <span class="p">[];</span>
      <span class="n">close</span><span class="p">(</span><span class="n">dialogId</span><span class="p">);</span>
    <span class="k">end</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">loadFrameParam</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uigetfile</span><span class="p">(</span><span class="s">&#39;*.mat&#39;</span><span class="p">,</span> <span class="s">&#39;Load frame parameters&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">data</span> <span class="p">=</span> <span class="n">load</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">]);</span>
    <span class="k">if</span> <span class="o">~</span><span class="n">isfield</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;frame&#39;</span><span class="p">)</span>
      <span class="n">errordlg</span><span class="p">([</span><span class="n">fileName</span> <span class="s">&#39; is not a valid signal frame file&#39;</span><span class="p">]);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">frame</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
    <span class="n">coeff</span><span class="p">.</span><span class="n">ori</span> <span class="p">=</span> <span class="n">calculateCoeff</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">);</span>
    <span class="n">coeff</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">calculateCoeff</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="nb">mod</span><span class="p">);</span>
    <span class="n">updateVisu</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">saveFrameParam</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">fileName</span><span class="p">,</span> <span class="n">pathName</span><span class="p">]</span> <span class="p">=</span> <span class="n">uiputfile</span><span class="p">(</span><span class="s">&#39;*.mat&#39;</span><span class="p">,</span> <span class="s">&#39;Save frame parameters&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c">% user pressed cancel, stop here</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">save</span><span class="p">([</span><span class="n">pathName</span><span class="p">,</span> <span class="n">fileName</span><span class="p">],</span> <span class="s">&#39;frame&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>pos <span class="p">=</span><span class="w"> </span><span class="nf">buttonPos</span><span class="p">(</span>indHori, indVert, shift<span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="c">% compute the position of a button (useful to align buttons)</span>
    <span class="c">% indHori: horizontal index of the button for which we want the </span>
    <span class="c">% position (first element with index 1 on the left)</span>
    <span class="c">% indVert: vertical index of the button for which we want the </span>
    <span class="c">% position (first element with index 1 at the bottom)</span>
    
    <span class="n">pos</span> <span class="p">=</span> <span class="p">[</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">indHori</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">buttonWidth</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">horiDist</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="c">...</span>
      <span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">indVert</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="c">...</span>
      <span class="n">gui</span><span class="p">.</span><span class="n">buttonWidth</span><span class="p">,</span><span class="c">...</span>
      <span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span><span class="p">];</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>subSize <span class="p">=</span><span class="w"> </span><span class="nf">subpanelSize</span><span class="p">(</span>nbRow<span class="p">)</span><span class="w">     </span>
<span class="w">    </span><span class="n">subSize</span> <span class="p">=</span> <span class="p">[(</span><span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span><span class="c">...</span>
      <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">nbRow</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span> <span class="o">+</span><span class="c">...</span>
      <span class="p">(</span><span class="n">nbRow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span> <span class="o">+</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span> <span class="o">-</span><span class="mi">4</span><span class="p">)];</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>[nbFreq] <span class="p">=</span><span class="w"> </span><span class="nf">nbPlottedFreq</span><span class="p">()</span><span class="w"></span>
<span class="w">     </span><span class="n">nbFreq</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c">%     if sig.real</span>
<span class="c">%       nbFreq = floor(size(coeff.ori, 1)/2)+1;</span>
<span class="c">%     else</span>
<span class="c">%       nbFreq = size(coeff.ori, 1);</span>
<span class="c">%     end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>[] <span class="p">=</span><span class="w"> </span><span class="nf">resize</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">figPos</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;Position&#39;</span><span class="p">);</span>
    <span class="n">xVisu</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span> <span class="o">/</span> <span class="n">figPos</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="c">% we need the follwing test to avoid a bug during creation</span>
    <span class="k">if</span> <span class="nb">isinf</span><span class="p">(</span><span class="n">xVisu</span><span class="p">)</span> <span class="o">||</span> <span class="nb">isnan</span><span class="p">(</span><span class="n">xVisu</span><span class="p">)</span> 
      <span class="n">xVisu</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="n">widthVisu</span> <span class="p">=</span> <span class="p">(</span><span class="n">figPos</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span><span class="p">)</span> <span class="o">/</span> <span class="n">figPos</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="c">% we need the follwing test to avoid a bug during creation</span>
    <span class="k">if</span> <span class="o">~</span><span class="p">(</span><span class="n">widthVisu</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">widthVisu</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="n">curY</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
        <span class="n">curY</span> <span class="p">=</span> <span class="n">curY</span> <span class="o">-</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">height</span><span class="p">;</span>
        <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">position</span> <span class="p">=</span> <span class="p">[</span><span class="n">xVisu</span> <span class="n">curY</span> <span class="n">widthVisu</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">height</span><span class="p">];</span>
        <span class="n">set</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">uipanelId</span><span class="p">,</span> <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">position</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="n">ishandle</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
          <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="s">&#39;Position&#39;</span><span class="p">,</span><span class="c">...</span>
            <span class="p">[</span><span class="n">figPos</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">gui</span><span class="p">.</span><span class="n">visuResizeButtonWidth</span><span class="p">,</span><span class="c">...</span>
              <span class="nb">round</span><span class="p">(</span><span class="n">curY</span><span class="o">*</span><span class="n">figPos</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="n">gui</span><span class="p">.</span><span class="n">visuResizeButtonHeight</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="c">...</span>
              <span class="n">gui</span><span class="p">.</span><span class="n">visuResizeButtonWidth</span><span class="p">,</span> <span class="c">...</span>
              <span class="n">gui</span><span class="p">.</span><span class="n">visuResizeButtonHeight</span><span class="p">]);</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">updateUndoData</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">undoData</span><span class="p">{</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">sel</span><span class="p">;</span>
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">undoMenuId</span><span class="p">,</span> <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
    <span class="n">redoData</span> <span class="p">=</span> <span class="p">{};</span>
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">redoMenuId</span><span class="p">,</span> <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">undo</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% PI: Currently the implementation of undo/redo is very rudimentary. </span>
    <span class="c">% Only undo/redo of actions modifying the polygons of the selection sel</span>
    <span class="c">% are taken into account. For example, zoom actions, or change of layer </span>
    <span class="c">% parameters (type of conversion, color of line, ...) are not taken </span>
    <span class="c">% into account. A more general handling could be implemented.</span>
    <span class="c">% The memory consumption for undo could also be improved. Currently for</span>
    <span class="c">% each action modifying the polygons, the whole old variable sel is</span>
    <span class="c">% stored in a cell of undoData. It&#39;s generally contains more</span>
    <span class="c">% information than stricly needed to undo as only one layer is modified</span>
    <span class="c">% at a time. If improved efficiency is needed, it could be taken into</span>
    <span class="c">% account to save minimally needed information. The number of undo</span>
    <span class="c">% levels is currently unlimited, this could be also changed if needed</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">undoData</span><span class="p">)</span>
      <span class="n">delSel</span><span class="p">;</span>
      <span class="n">redoData</span><span class="p">{</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">sel</span><span class="p">;</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">redoMenuId</span><span class="p">,</span> <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
      <span class="n">sel</span> <span class="p">=</span> <span class="n">undoData</span><span class="p">{</span><span class="k">end</span><span class="p">};</span>
      <span class="n">undoData</span> <span class="p">=</span> <span class="n">undoData</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">undoData</span><span class="p">)</span>
        <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">undoMenuId</span><span class="p">,</span> <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
      <span class="k">end</span>
      <span class="n">drawAllSel</span><span class="p">;</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">);</span>
      <span class="n">updateLayerList</span><span class="p">;</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">redo</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% PI: see the PI for undo function</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">redoData</span><span class="p">)</span>
      <span class="n">delSel</span><span class="p">;</span>
      <span class="n">undoData</span><span class="p">{</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">sel</span><span class="p">;</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">undoMenuId</span><span class="p">,</span> <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
      <span class="n">sel</span> <span class="p">=</span> <span class="n">redoData</span><span class="p">{</span><span class="k">end</span><span class="p">};</span>
      <span class="n">redoData</span> <span class="p">=</span> <span class="n">redoData</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">redoData</span><span class="p">)</span>
        <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">redoMenuId</span><span class="p">,</span> <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
      <span class="k">end</span>
      <span class="n">drawAllSel</span><span class="p">;</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">);</span>
      <span class="n">updateLayerList</span><span class="p">;</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="c">% ______________________ VISUALIZATION FUNCTIONS __________________________</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">updateVisu</span><span class="p">(</span>resetVisu, changeCLim<span class="p">)</span><span class="w"></span>
<span class="w">   </span>
<span class="w">    </span><span class="k">if</span> <span class="n">nargin</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="n">resetVisu</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
      <span class="n">changeCLim</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="n">delete</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">symbImageId</span><span class="p">);</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">symbImageId</span> <span class="p">=</span> <span class="p">[];</span>
    
    <span class="c">% keep the properties of the axes if we&#39;re not resetting the</span>
    <span class="c">% visualization</span>
    <span class="n">axesProp</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
    <span class="k">if</span> <span class="o">~</span><span class="n">resetVisu</span>
      <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">)</span>
          <span class="n">axesProp</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">xLim</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;XLim&#39;</span><span class="p">);</span>
          <span class="n">axesProp</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">yLim</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;YLim&#39;</span><span class="p">);</span>
          <span class="n">axesProp</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">cLim</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;CLim&#39;</span><span class="p">);</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="c">% update the visualization of the signal</span>
    <span class="n">linkXId</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">linkYId</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">linkCLimId</span><span class="p">=[];</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">)</span>
      <span class="n">delete</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">uipanelId</span><span class="p">);</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">uipanelId</span> <span class="p">=</span> <span class="p">[];</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span> <span class="p">=</span> <span class="p">[];</span>
      <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
        <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">uipanelId</span> <span class="p">=</span> <span class="n">uipanel</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="c">...</span>
          <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;normalized&#39;</span><span class="p">,</span> <span class="c">...</span>
          <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">position</span><span class="p">);</span>
 
        <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">linkX</span>
          <span class="n">linkXId</span> <span class="p">=</span> <span class="p">[</span><span class="n">linkXId</span> <span class="n">ind</span><span class="p">];</span>
        <span class="k">end</span>
        <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">linkY</span>
          <span class="n">linkYId</span> <span class="p">=</span> <span class="p">[</span><span class="n">linkYId</span> <span class="n">ind</span><span class="p">];</span>
        <span class="k">end</span>
        <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">linkCLim</span>
          <span class="n">linkCLimId</span> <span class="p">=</span> <span class="p">[</span><span class="n">linkCLimId</span> <span class="n">ind</span><span class="p">];</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">updateOneVisu</span><span class="p">(</span>ind<span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
           <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">updateFcn</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">));</span>

           <span class="c">% plot for the visualisation of play position during playback</span>
           <span class="n">lim</span> <span class="p">=</span> <span class="n">axis</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">);</span>
           <span class="c">% xPos = convIndToAxesX((player.position-1) / frame.def.hop);</span>
            <span class="n">hop</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">)</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
            <span class="n">xPos</span> <span class="p">=</span> <span class="n">convIndToAxesX</span><span class="p">((</span><span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">hop</span><span class="p">);</span>
           <span class="n">hold</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
           <span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="p">[</span><span class="n">xPos</span> <span class="n">xPos</span><span class="p">],</span><span class="c">...</span>
             <span class="n">lim</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">);</span> <span class="c">% !!! give possibility to change color ?</span>
           <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="s">&#39;Visible&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span> <span class="s">&#39;LineWidth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
           <span class="n">hold</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>

           <span class="c">% the following insures the possibility to zoom out</span>
           <span class="c">% completely even if we are already zoomed in</span>
           <span class="n">axes</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">);</span>
           <span class="n">zoom</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;reset&#39;</span><span class="p">);</span>
        <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">updateOneVisu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="nb">length</span><span class="p">(</span><span class="n">linkCLimId</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="n">link</span><span class="p">.</span><span class="n">CLim</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CLim&#39;</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="n">range</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">);</span>
    <span class="n">range</span><span class="p">(</span><span class="n">oriInd</span><span class="p">)</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="n">range</span>
       <span class="n">updateOneVisu</span><span class="p">(</span><span class="n">ind</span><span class="p">);</span>
    <span class="k">end</span>
     
    <span class="k">if</span> <span class="nb">length</span><span class="p">(</span><span class="n">linkXId</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="n">link</span><span class="p">.</span><span class="n">XLim</span> <span class="p">=</span> <span class="n">linkprop</span><span class="p">(</span><span class="n">arrayfun</span><span class="p">(@(</span><span class="n">vEl</span><span class="p">)</span> <span class="n">vEl</span><span class="p">.</span><span class="n">axesId</span><span class="p">,</span><span class="n">visu</span><span class="p">(</span><span class="n">linkXId</span><span class="p">)),</span><span class="s">&#39;XLim&#39;</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="nb">length</span><span class="p">(</span><span class="n">linkYId</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="n">link</span><span class="p">.</span><span class="n">YLim</span> <span class="p">=</span> <span class="n">linkprop</span><span class="p">(</span><span class="n">arrayfun</span><span class="p">(@(</span><span class="n">vEl</span><span class="p">)</span> <span class="n">vEl</span><span class="p">.</span><span class="n">axesId</span><span class="p">,</span><span class="n">visu</span><span class="p">(</span><span class="n">linkYId</span><span class="p">)),</span><span class="s">&#39;YLim&#39;</span><span class="p">);</span>
    <span class="k">end</span>
    
    
    <span class="k">if</span> <span class="o">~</span><span class="n">resetVisu</span>
      <span class="c">% we go in reverse order to update axes limits so that</span>
      <span class="c">% all the linked axes come back to the limits of the original</span>
      <span class="c">% spectrogram, even if some new linked axes are added</span>
      <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
          <span class="k">try</span>
            <span class="n">set</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;XLim&#39;</span><span class="p">,</span> <span class="n">axesProp</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">xLim</span><span class="p">);</span>
          <span class="k">end</span>
          <span class="k">try</span>
            <span class="n">set</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;YLim&#39;</span><span class="p">,</span> <span class="n">axesProp</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">yLim</span><span class="p">);</span>
          <span class="k">end</span>
          <span class="k">if</span> <span class="o">~</span><span class="n">changeCLim</span>
            <span class="k">try</span>
              <span class="n">set</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;CLim&#39;</span><span class="p">,</span> <span class="n">axesProp</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">cLim</span><span class="p">);</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="n">drawAllSel</span><span class="p">;</span>
    
    <span class="n">overviewInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalOverview&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">overviewInd</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">overviewInd</span><span class="p">).</span><span class="n">visible</span>
        <span class="n">exploreOverview</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">overviewInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">);</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">if</span> <span class="o">~</span><span class="n">resetVisu</span>
      <span class="c">% restore the current tool</span>
      <span class="n">changeTool</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">gui</span><span class="p">.</span><span class="n">curTool</span><span class="p">);</span>
    <span class="k">end</span>
    
    <span class="n">drawResizeVisuButton</span><span class="p">;</span>
    <span class="n">resize</span><span class="p">;</span>    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>[axesId,C] <span class="p">=</span><span class="w"> </span><span class="nf">updateVisuCommon</span><span class="p">(</span>coef,lim,visuData<span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">axesId</span> <span class="p">=</span> <span class="n">axes</span><span class="p">(</span><span class="s">&#39;Parent&#39;</span><span class="p">,</span><span class="n">visuData</span><span class="p">.</span><span class="n">uipanelId</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span>
       <span class="n">C</span> <span class="p">=</span> <span class="n">plotCoeff</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;clim&#39;</span><span class="p">,</span><span class="n">link</span><span class="p">.</span><span class="n">CLim</span><span class="p">);</span>
    <span class="k">else</span>
       <span class="n">C</span> <span class="p">=</span> <span class="n">plotCoeff</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;dynrange&#39;</span><span class="p">,</span><span class="n">visuData</span><span class="p">.</span><span class="n">dynamic</span><span class="p">);</span>
    <span class="k">end</span>   
    <span class="n">colorbar</span> <span class="n">off</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>[axesId] <span class="p">=</span><span class="w"> </span><span class="nf">updateVisuOriSpec</span><span class="p">(</span>visuData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">axesId</span><span class="p">,</span> <span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">]</span> <span class="p">=</span> <span class="n">updateVisuCommon</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span><span class="n">false</span><span class="p">,</span><span class="n">visuData</span><span class="p">);</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Original signal&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>[axesId] <span class="p">=</span><span class="w"> </span><span class="nf">updateVisuModSpec</span><span class="p">(</span>visuData<span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">[</span><span class="n">axesId</span><span class="p">,</span> <span class="n">coeff</span><span class="p">.</span><span class="n">modC</span><span class="p">]</span> <span class="p">=</span> <span class="n">updateVisuCommon</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span><span class="n">visuData</span><span class="p">.</span><span class="n">linkCLim</span><span class="p">,</span><span class="n">visuData</span><span class="p">);</span> 
<span class="c">%     if(visuData.linkCLim &amp;&amp; ~strcmpi(&#39;originalOverview&#39;, {visu.label}))</span>
<span class="c">%        plotCoeff(coeff.mod,axesId,&#39;clim&#39;,link.CLim);</span>
<span class="c">%     else</span>
<span class="c">%        plotCoeff(coeff.mod,axesId,&#39;dynrange&#39;,visuData.dynamic);</span>
<span class="c">%     end</span>
    <span class="c">%plotCoeff(coeff.mod,axesId,visuData.dynamic);</span>
    <span class="c">% update the spectrogram of the original signal</span>
<span class="c">%     spec = abs(coeff.mod(1:nbPlottedFreq,:)).^2; % spectrogram coefficients</span>
<span class="c">%     maxSpec = max(spec(:));</span>
<span class="c">%     imagesc(...</span>
<span class="c">%       convIndToAxesX([1,size(spec,2)]),...</span>
<span class="c">%       convIndToAxesY([1,size(spec,1)]),...</span>
<span class="c">%       10*log10(spec+eps),...</span>
<span class="c">%       &#39;Parent&#39;, axesId, ...</span>
<span class="c">%       10*log10(maxSpec)+[-visuData.dynamic 0]);</span>
<span class="c">%     axis(axesId, &#39;xy&#39;);</span>
<span class="c">%     xlabel(&#39;Time (s)&#39;);</span>
<span class="c">%     ylabel(&#39;Frequency (Hz)&#39;);</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Modified signal&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>[axesId] <span class="p">=</span><span class="w"> </span><span class="nf">updateVisuOriOverview</span><span class="p">(</span>visuData<span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">axesId</span> <span class="p">=</span> <span class="n">updateVisuCommon</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span><span class="n">visuData</span><span class="p">.</span><span class="n">linkCLim</span><span class="p">,</span><span class="n">visuData</span><span class="p">);</span> 
   <span class="c">%axesId = updateVisuOriSpec(visuData);  </span>
   <span class="c">% axesId = axes(&#39;parent&#39;,visuData.uipanelId);</span>
   <span class="c">% plotCoeff(coeff.ori,axesId,visuData.dynamic);</span>
    <span class="c">% update the spectrogram of the original signal</span>
<span class="c">%     spec = abs(coeff.ori(1:nbPlottedFreq,:)).^2; %  spectrogram coefficients</span>
<span class="c">%     maxSpec = max(spec(:));</span>
<span class="c">%     imageId = imagesc(...</span>
<span class="c">%       convIndToAxesX([1,size(spec,2)]),...</span>
<span class="c">%       convIndToAxesY([1,size(spec,1)]),...</span>
<span class="c">%       10*log10(spec+eps),...</span>
<span class="c">%       &#39;Parent&#39;, axesId, ...</span>
<span class="c">%       10*log10(maxSpec)+[-visuData.dynamic 0]);</span>
<span class="c">%     axis(axesId, &#39;xy&#39;);</span>
<span class="c">%     xlabel(&#39;Time (s)&#39;);</span>
<span class="c">%     ylabel(&#39;Frequency (Hz)&#39;);</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Overview of original signal&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawResizeVisuButton</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">ishandle</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
        <span class="n">delete</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span><span class="p">(</span><span class="n">ind</span><span class="p">));</span>
      <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="n">nbVisibleVisu</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="nb">find</span><span class="p">([</span><span class="n">visu</span><span class="p">.</span><span class="n">visible</span><span class="p">]));</span>
    <span class="n">nbButton</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span> <span class="p">=</span> <span class="n">NaN</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">nbVisibleVisu</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="n">resizeButtonIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;resizebutton.png&#39;</span><span class="p">]);</span>
      <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
            <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;pushbutton&#39;</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Resize visualization&#39;</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">resizeButtonIcon</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;buttonDownFcn&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">resizeVisu</span><span class="p">,</span> <span class="n">ind</span><span class="p">});</span>
          <span class="n">nbButton</span> <span class="p">=</span> <span class="n">nbButton</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">if</span> <span class="n">nbButton</span> <span class="o">==</span> <span class="n">nbVisibleVisu</span><span class="o">-</span><span class="mi">1</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">resizeVisu</span><span class="p">(</span>objId, eventData, indVisu<span class="p">)</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">initPos</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
    
    <span class="n">backupButtonMotionFcn</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">);</span>
    <span class="n">backupButtonUpFcn</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">);</span>
    
    <span class="n">figPos</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;Position&#39;</span><span class="p">);</span>
    
    <span class="n">buttonPos</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">ResizeVisuButtonId</span><span class="p">(</span><span class="n">indVisu</span><span class="p">),</span> <span class="s">&#39;Position&#39;</span><span class="p">);</span>
    
    <span class="c">% find the index of the visible visualization next to the one with </span>
    <span class="c">% index indVisu</span>
    <span class="n">indNextVisu</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="n">indVisu</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">visu</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
        <span class="n">indNextVisu</span> <span class="p">=</span> <span class="n">ind</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="n">initHeight</span> <span class="p">=</span> <span class="p">[</span><span class="n">visu</span><span class="p">(</span><span class="n">indVisu</span><span class="p">).</span><span class="n">height</span><span class="p">,</span> <span class="n">visu</span><span class="p">(</span><span class="n">indNextVisu</span><span class="p">).</span><span class="n">height</span><span class="p">];</span>
    
    <span class="c">% As the zoom and pan mode of matlab doesn&#39;t allow to change the</span>
    <span class="c">% WindowButtonUpFcn, I temporarly change the tool</span>
    <span class="n">curTool</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">curTool</span><span class="p">;</span>
    <span class="n">changeTool</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="n">eventData</span><span class="p">,</span> <span class="s">&#39;freehand&#39;</span><span class="p">);</span>
    
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">resizeVisuButtonMotionFcn</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">resizeVisuButtonUpFcn</span><span class="p">);</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">resizeVisuButtonMotionFcn</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">pos</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      <span class="n">shift</span> <span class="p">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">initPos</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">figPos</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">initHeight</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">initHeight</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span>
        <span class="n">visu</span><span class="p">(</span><span class="n">indVisu</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="n">initHeight</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">shift</span><span class="p">;</span>
        <span class="n">visu</span><span class="p">(</span><span class="n">indNextVisu</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="n">initHeight</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">shift</span><span class="p">;</span>
      <span class="k">end</span>
      <span class="n">resize</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">resizeVisuButtonUpFcn</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,</span> <span class="n">backupButtonMotionFcn</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,</span> <span class="n">backupButtonUpFcn</span><span class="p">);</span>
      <span class="c">% restore the tool</span>
      <span class="n">changeTool</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="n">eventData</span><span class="p">,</span> <span class="n">curTool</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">toggleModVisu</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">modInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;modified&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">modInd</span><span class="p">).</span><span class="n">visible</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">modInd</span><span class="p">).</span><span class="n">visible</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">visuMenu</span><span class="p">.</span><span class="n">showModId</span><span class="p">,</span> <span class="s">&#39;Checked&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="o">+</span> <span class="n">visu</span><span class="p">(</span><span class="n">modInd</span><span class="p">).</span><span class="n">height</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">modInd</span><span class="p">).</span><span class="n">visible</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">visuMenu</span><span class="p">.</span><span class="n">showModId</span><span class="p">,</span> <span class="s">&#39;Checked&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">modInd</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">updateVisu</span><span class="p">;</span>
    <span class="n">resize</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">toggleOverviewVisu</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">overviewInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalOverview&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">overviewInd</span><span class="p">).</span><span class="n">visible</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">overviewInd</span><span class="p">).</span><span class="n">visible</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">visuMenu</span><span class="p">.</span><span class="n">showOverviewId</span><span class="p">,</span> <span class="s">&#39;Checked&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="o">+</span> <span class="n">visu</span><span class="p">(</span><span class="n">overviewInd</span><span class="p">).</span><span class="n">height</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">overviewInd</span><span class="p">).</span><span class="n">visible</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">visuMenu</span><span class="p">.</span><span class="n">showOverviewId</span><span class="p">,</span> <span class="s">&#39;Checked&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">overviewInd</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span>
      <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">height</span> <span class="o">*</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">updateVisu</span><span class="p">;</span>
    <span class="n">resize</span><span class="p">;</span>
  <span class="k">end</span>



<span class="c">% ______________________ AUDIOPLAYER FUNCTIONS ____________________________</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">initializePlayer</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">ori</span> <span class="p">=</span> <span class="n">audioplayer</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">);</span>
    <span class="n">player</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">audioplayer</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">);</span>
    
    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="s">&#39;StartFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">playerStartFcn</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="s">&#39;StopFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">playerStopFcnOri</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="s">&#39;TimerFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">updatePlayPosition</span><span class="p">);</span>

    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="s">&#39;StartFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">playerStartFcn</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="s">&#39;StopFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">playerStopFcnMod</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="s">&#39;TimerFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">updatePlayPosition</span><span class="p">);</span>

    <span class="n">player</span><span class="p">.</span><span class="n">selected</span> <span class="p">=</span> <span class="s">&#39;ori&#39;</span><span class="p">;</span>
    <span class="n">player</span><span class="p">.</span><span class="n">loop</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    <span class="n">player</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">player</span><span class="p">.</span><span class="n">forceStop</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="n">ishandle</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttongroupId</span><span class="p">)</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttongroupId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;SelectedObject&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttonOriId</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>


<span class="k">  function</span><span class="w"> </span><span class="nf">drawAudioplayer</span><span class="p">(</span>uipanelId<span class="p">)</span><span class="w">    </span>
<span class="w">    </span><span class="n">subPanelHeight</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span><span class="c">...</span>
      <span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttongroupId</span> <span class="p">=</span> <span class="n">uibuttongroup</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="s">&#39;Signal&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="n">subPanelHeight</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;SelectionChangeFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">switchAudioplayer</span><span class="p">);</span>
      
    <span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttonOriId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttongroupId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;radiobutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39; Original&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Tag&#39;</span><span class="p">,</span> <span class="s">&#39;ori&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">]);</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttonModId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">buttongroupId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;radiobutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39; Modified&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Tag&#39;</span><span class="p">,</span> <span class="s">&#39;mod&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">]);</span>
    
    <span class="n">playIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;play.png&#39;</span><span class="p">]);</span>
    
    <span class="n">yPos</span> <span class="p">=</span> <span class="n">subPanelHeight</span><span class="p">;</span>
        
    <span class="n">buttonPlayPauseId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;pushbutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Play/pause audio&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">playIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">margin</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">yPos</span><span class="p">]),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">playPauseAudioplayer</span><span class="p">);</span>

    <span class="n">stopIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;stop.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonStopId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;pushbutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Stop audio&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">stopIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">margin</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">yPos</span><span class="p">]),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">stopAudioplayer</span><span class="p">);</span>
    
    <span class="n">loopIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;loop.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonLoopId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Loop audio&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">loopIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">margin</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">yPos</span><span class="p">]),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">loopAudioplayer</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Min&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Max&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">switchAudioplayer</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">selected</span><span class="p">=</span><span class="n">get</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;SelectedObject&#39;</span><span class="p">),</span><span class="s">&#39;Tag&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">playPauseAudioplayer</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span> <span class="n">isplaying</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">)</span>
      <span class="n">player</span><span class="p">.</span><span class="n">forceStop</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
      <span class="n">pause</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">);</span>
    <span class="k">elseif</span> <span class="n">isplaying</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">)</span>
      <span class="n">player</span><span class="p">.</span><span class="n">forceStop</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
      <span class="n">pause</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">player</span><span class="p">.</span><span class="n">forceStop</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
      <span class="k">switch</span> <span class="n">player</span><span class="p">.</span><span class="n">selected</span>
        <span class="k">case</span> <span class="s">&#39;ori&#39;</span>
          <span class="n">play</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
        <span class="k">case</span> <span class="s">&#39;mod&#39;</span>
          <span class="n">play</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>


<span class="k">  function</span><span class="w"> </span><span class="nf">stopAudioplayer</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">forceStop</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
    <span class="n">stop</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">);</span>
    <span class="n">stop</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">);</span>
    <span class="n">player</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">playerStartFcn</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
        <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="s">&#39;Visible&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">playerStopFcnOri</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
        <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="s">&#39;Visible&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
      <span class="k">end</span>
    <span class="k">end</span>   
    
    <span class="n">player</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="s">&#39;CurrentSample&#39;</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="n">player</span><span class="p">.</span><span class="n">loop</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">player</span><span class="p">.</span><span class="n">forceStop</span>
      <span class="n">pause</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span> <span class="c">%!!! needed to avoid java error</span>
      <span class="n">play</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">ori</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">playerStopFcnMod</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
        <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="s">&#39;Visible&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
      <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="n">player</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="s">&#39;CurrentSample&#39;</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="n">player</span><span class="p">.</span><span class="n">loop</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="n">player</span><span class="p">.</span><span class="n">forceStop</span>
      <span class="n">pause</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span> <span class="c">%!!! needed to avoid java error</span>
      <span class="n">play</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">loopAudioplayer</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">loop</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">updatePlayPosition</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% pos = convIndToAxesX((get(objId, &#39;CurrentSample&#39;)-1) / frame.def.hop);</span>
    <span class="n">hop</span> <span class="p">=</span> <span class="nb">numel</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">ori</span><span class="p">)</span><span class="o">/</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">pos</span> <span class="p">=</span> <span class="n">convIndToAxesX</span><span class="p">((</span><span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;CurrentSample&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">hop</span><span class="p">);</span>
    
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">visu</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">visible</span>
        <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">positionPlotId</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">pos</span> <span class="n">pos</span><span class="p">]);</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">updatePlayerMod</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span> <span class="p">=</span> <span class="n">audioplayer</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="n">sig</span><span class="p">.</span><span class="n">sampFreq</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="s">&#39;StartFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">playerStartFcn</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="s">&#39;StopFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">playerStopFcnMod</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="nb">mod</span><span class="p">,</span> <span class="s">&#39;TimerFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">updatePlayPosition</span><span class="p">);</span>
  <span class="k">end</span>

<span class="c">% ____________________ SELECTION TOOLS FUNCTIONS __________________________</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawSelectionTool</span><span class="p">(</span>uipanelId<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">subSize</span> <span class="p">=</span> <span class="n">subpanelSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    
    <span class="n">processingToolPanelId</span> <span class="p">=</span> <span class="n">uipanel</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="s">&#39;Apply&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subSize</span><span class="p">]);</span>
    
    <span class="c">% draw processing tools subpanel</span>
    <span class="n">drawProcessingTool</span><span class="p">(</span><span class="n">processingToolPanelId</span><span class="p">);</span>
    
    <span class="n">heightLayerPanel</span> <span class="p">=</span> <span class="mi">115</span><span class="p">;</span>
    
    <span class="n">layerPanelId</span> <span class="p">=</span> <span class="n">uipanel</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="s">&#39;Layers&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">subSize</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">subSize</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">heightLayerPanel</span><span class="p">]);</span>
    
    <span class="c">% draw layer panel</span>
    <span class="n">drawLayerPanel</span><span class="p">(</span><span class="n">layerPanelId</span><span class="p">);</span>
    
    <span class="n">buttongroupId</span> <span class="p">=</span> <span class="n">uibuttongroup</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="s">&#39;Mode&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">subSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">heightLayerPanel</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">subSize</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;SelectionChangeFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">switchSelMode</span><span class="p">);</span>
    
    <span class="n">unionIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;union.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonUnionId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span><span class="n">buttongroupId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Union&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">unionIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Tag&#39;</span><span class="p">,</span> <span class="s">&#39;union&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">));</span>
    
    <span class="n">intersectionIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;intersection.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonInterId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span><span class="n">buttongroupId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Intersection&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">intersectionIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Tag&#39;</span><span class="p">,</span> <span class="s">&#39;intersection&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">));</span>
    
    <span class="n">differenceIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;difference.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonDiffId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span><span class="n">buttongroupId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Set difference&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">differenceIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Tag&#39;</span><span class="p">,</span> <span class="s">&#39;difference&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">));</span>
    
    <span class="c">% reserved space to draw parameters of the tools</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">toolPanelId</span> <span class="p">=</span> <span class="n">uipanel</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="s">&#39;Tools&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">subSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">heightLayerPanel</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="c">...</span>
        <span class="n">subSize</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="c">...</span>
        <span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span> <span class="o">+</span> <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span> <span class="o">+</span> <span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span> <span class="o">+</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="o">+</span><span class="mi">2</span><span class="p">]);</span>
    
      
      
    
    <span class="n">freeHandIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;freehand.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonFreehandId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">toolPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;HandleVisibility&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Free-hand selection&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">freeHandIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Min&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Max&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">]),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeTool</span><span class="p">,</span> <span class="s">&#39;freehand&#39;</span><span class="p">});</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">buttonId</span> <span class="p">=</span> <span class="n">buttonFreehandId</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;freehand&#39;</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="k">function</span> <span class="p">=</span> <span class="p">@</span><span class="n">selecFreehand</span><span class="p">;</span>
    
    <span class="n">levelIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;magicwand.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonLevelId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">toolPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;HandleVisibility&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Magic wand (Level selection)&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">levelIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Min&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Max&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">]),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeTool</span><span class="p">,</span> <span class="s">&#39;level&#39;</span><span class="p">});</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">buttonId</span> <span class="p">=</span> <span class="n">buttonLevelId</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;level&#39;</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="k">function</span> <span class="p">=</span> <span class="p">@</span><span class="n">selecLevel</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">param</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Tolerance&#39;</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">param</span><span class="p">.</span><span class="n">val</span> <span class="p">=</span> <span class="s">&#39;10&#39;</span><span class="p">;</span> <span class="c">% value of the tolerance in dB</span>
    
    
    <span class="n">freeHandIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;subbandsel.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonSubbandId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">toolPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;HandleVisibility&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Subband selection&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">freeHandIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Min&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Max&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">]),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeTool</span><span class="p">,</span> <span class="s">&#39;subband&#39;</span><span class="p">});</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">buttonId</span> <span class="p">=</span> <span class="n">buttonSubbandId</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;subband&#39;</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="k">function</span> <span class="p">=</span> <span class="p">@</span><span class="n">selecSubband</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeTool</span><span class="p">(</span>objId, eventData, toolName<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span> <span class="n">getMatlabVersion</span> <span class="o">&lt;</span> <span class="mf">7.3</span>
      <span class="c">% As we cannot force automatic update of rectangle in overview when</span>
      <span class="c">% zooming and paning, we will at least force it when we change tool</span>
      <span class="n">updateExploreRect</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">zoom</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
    <span class="n">pan</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>    
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">)</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">buttonId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
    <span class="k">end</span>
    
    <span class="n">toolNameList</span> <span class="p">=</span> <span class="p">{</span><span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">name</span><span class="p">};</span> <span class="c">% cell array listing the tool names</span>
    <span class="n">curInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">toolName</span><span class="p">,</span> <span class="n">toolNameList</span><span class="p">));</span>
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">curInd</span><span class="p">).</span><span class="n">buttonId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">curTool</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">curInd</span><span class="p">).</span><span class="n">name</span><span class="p">;</span>    
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">curInd</span><span class="p">).</span><span class="k">function</span><span class="p">(</span><span class="n">curInd</span><span class="p">);</span>
    <span class="n">drawToolParam</span><span class="p">(</span><span class="n">curInd</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawToolParam</span><span class="p">(</span>toolInd<span class="p">)</span><span class="w">    </span>
<span class="w">    </span>
<span class="w">    </span><span class="n">child</span> <span class="p">=</span> <span class="n">findobj</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">toolPanelId</span><span class="p">);</span>
    <span class="n">child</span> <span class="p">=</span> <span class="n">setdiff</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">toolPanelId</span><span class="p">);</span>
    <span class="n">delete</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>    
    
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">toolInd</span><span class="p">).</span><span class="n">param</span><span class="p">)</span>
      <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
        <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">toolPanelId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">toolInd</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">name</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="c">...</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">ind</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="p">),</span><span class="c">...</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">])</span> <span class="p">;</span>
      <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
        <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">toolPanelId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;edit&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">toolInd</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">val</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span><span class="p">,</span><span class="c">...</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">ind</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="p">),</span><span class="c">...</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">editWidth</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">],</span><span class="c">...</span>
        <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeToolParam</span><span class="p">,</span> <span class="n">toolInd</span><span class="p">,</span> <span class="n">ind</span><span class="p">});</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeToolParam</span><span class="p">(</span>objId, eventData, toolInd, paramInd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">toolInd</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="n">paramInd</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">selecFreehand</span><span class="p">(</span>toolInd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% toolInd is not used but needed as I pass a parameter to this </span>
    <span class="c">% function !!! precise this</span>

    <span class="n">figId</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">;</span>
    <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">axesId</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">;</span>
    <span class="n">imageId</span> <span class="p">=</span> <span class="n">findobj</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="s">&#39;Image&#39;</span><span class="p">);</span>
    
    <span class="n">set</span><span class="p">(</span><span class="n">imageId</span><span class="p">,</span> <span class="s">&#39;ButtonDownFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">selecFreeHandButtonDown</span><span class="p">);</span>
    
    <span class="n">poly</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">poly</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">[];</span>

    
    <span class="n">init</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span> <span class="c">% boolean to know if we are drawing the first point or not</span>
    
    <span class="n">lineId</span> <span class="p">=</span> <span class="p">[];</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">selecFreeHandButtonDown</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;SelectionType&#39;</span><span class="p">),</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">init</span>
          <span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
          <span class="c">%disp(sprintf(&#39;[%d,%d]\n&#39;,point(1,1),point(1,2)));</span>
          <span class="n">poly</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>
          <span class="n">poly</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)];</span>
          <span class="n">poly</span><span class="p">.</span><span class="n">hole</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
          <span class="n">lineId</span> <span class="p">=</span> <span class="n">line</span><span class="p">(</span><span class="c">...</span>
            <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">poly</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">poly</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;LineWidth&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">lineWidth</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;Color&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">color</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;Marker&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">marker</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">markerSize</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;LineStyle&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">lineStyle</span><span class="p">);</span>
          <span class="n">init</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
          <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonDownFcn&#39;</span><span class="p">,@</span><span class="n">selecFreeHandButtonDown</span><span class="p">);</span>
          <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,@</span><span class="n">selecFreeHandMotionDown</span><span class="p">);</span>
          <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,@</span><span class="n">selecFreeHandButtonUp</span><span class="p">);</span>
        <span class="k">else</span>
          <span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
          <span class="c">%disp(sprintf(&#39;[%d,%d]\n&#39;,point(1,1),point(1,2)));</span>
          <span class="n">poly</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="n">poly</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>
          <span class="n">poly</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="n">poly</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)];</span>
          <span class="n">set</span><span class="p">(</span><span class="n">lineId</span><span class="p">,</span> <span class="s">&#39;XData&#39;</span><span class="p">,</span><span class="n">poly</span><span class="p">.</span><span class="n">x</span> <span class="p">,</span> <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">poly</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
          <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,@</span><span class="n">selecFreeHandMotionDown</span><span class="p">);</span>
          <span class="n">drawnow</span><span class="p">;</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>

<span class="k">    function</span><span class="w"> </span><span class="nf">selecFreeHandMotionDown</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      <span class="c">% disp(sprintf(&#39;[%d,%d]\n&#39;,point(1,1),point(1,2)));</span>
      <span class="n">poly</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="n">poly</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>
      <span class="n">poly</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="n">poly</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)];</span>
      <span class="n">set</span><span class="p">(</span><span class="n">lineId</span><span class="p">,</span> <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">poly</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">poly</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
      <span class="n">drawnow</span><span class="p">;</span>
    <span class="k">end</span>

<span class="k">    function</span><span class="w"> </span><span class="nf">selecFreeHandMotionUp</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      <span class="n">xData</span> <span class="p">=</span> <span class="p">[</span><span class="n">poly</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>
      <span class="n">yData</span> <span class="p">=</span> <span class="p">[</span><span class="n">poly</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)];</span>
      <span class="n">set</span><span class="p">(</span><span class="n">lineId</span><span class="p">,</span> <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">xData</span><span class="p">,</span> <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">yData</span><span class="p">);</span>
      <span class="n">drawnow</span><span class="p">;</span>
    <span class="k">end</span>

<span class="k">    function</span><span class="w"> </span><span class="nf">selecFreeHandButtonUp</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">switch</span> <span class="n">get</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;SelectionType&#39;</span><span class="p">)</span>
        <span class="k">case</span> <span class="s">&#39;normal&#39;</span>
          <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,@</span><span class="n">selecFreeHandMotionUp</span><span class="p">);</span>
        <span class="k">case</span> <span class="p">{</span><span class="s">&#39;open&#39;</span><span class="p">,</span> <span class="s">&#39;alt&#39;</span><span class="p">}</span>
          <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
          <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonDownFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
          <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
          <span class="n">init</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
          
          <span class="n">delete</span><span class="p">(</span><span class="n">lineId</span><span class="p">);</span>
          
          <span class="c">% !!! we could simplify the polygon here to have fastest</span>
          <span class="c">% computation </span>
          
          <span class="n">combineSel</span><span class="p">(</span><span class="n">poly</span><span class="p">);</span>
          <span class="n">drawCurSel</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">selecLevel</span><span class="p">(</span>toolInd<span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">imageId</span> <span class="p">=</span> <span class="n">findobj</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="s">&#39;Image&#39;</span><span class="p">);</span>
    
    <span class="n">set</span><span class="p">(</span><span class="n">imageId</span><span class="p">,</span> <span class="s">&#39;ButtonDownFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">selecLevelButtonDown</span><span class="p">);</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">selecLevelButtonDown</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w">      </span>
<span class="w">      </span><span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>

      <span class="n">indTime</span> <span class="p">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">convAxesToIndX</span><span class="p">(</span><span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)));</span>
      <span class="n">indFreq</span> <span class="p">=</span> <span class="nb">ceil</span><span class="p">(</span><span class="n">convAxesToIndY</span><span class="p">(</span><span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)));</span>
      <span class="c">%disp(sprintf(&#39;%i, %i&#39;,point(1,2),indFreq));</span>

      <span class="c">% !!! sometime log of 0, do something here</span>
      <span class="c">%spec = 20*log10(abs(coeff.ori(1:nbPlottedFreq,:))+eps);</span>

      <span class="n">refLevel</span> <span class="p">=</span> <span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">(</span><span class="n">indFreq</span><span class="p">,</span> <span class="n">indTime</span><span class="p">);</span>

      <span class="n">levelTol</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="n">toolInd</span><span class="p">).</span><span class="n">param</span><span class="p">.</span><span class="n">val</span><span class="p">);</span>
      <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">levelTol</span><span class="p">)</span> <span class="o">||</span> <span class="n">levelTol</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="n">errordlg</span><span class="p">([</span><span class="s">&#39;Tolerance parameter for magic wand is invalid, &#39;</span><span class="c">...</span>
          <span class="s">&#39;it must be a positive number in dB&#39;</span><span class="p">]);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="k">end</span>
      
      <span class="n">lowLevel</span> <span class="p">=</span> <span class="n">refLevel</span> <span class="o">-</span> <span class="n">levelTol</span><span class="p">;</span>
      <span class="n">highLevel</span> <span class="p">=</span> <span class="n">refLevel</span> <span class="o">+</span> <span class="n">levelTol</span><span class="p">;</span>

      <span class="n">mask</span> <span class="p">=</span> <span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span> <span class="o">&gt;</span><span class="p">=</span> <span class="n">lowLevel</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span> <span class="o">&lt;</span><span class="p">=</span> <span class="n">highLevel</span><span class="p">);</span>
      <span class="n">mask</span> <span class="p">=</span> <span class="n">bwselect</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">indTime</span><span class="p">,</span> <span class="n">indFreq</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

      <span class="n">poly</span> <span class="p">=</span> <span class="n">mask2poly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">indTime</span><span class="p">,</span> <span class="n">indFreq</span><span class="p">);</span>
      
      <span class="c">% !!! see if we simplify the selection or not</span>
      
      <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span> <span class="p">=</span> <span class="n">convIndToAxesX</span><span class="p">(</span><span class="nb">floor</span><span class="p">(</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span><span class="p">));</span>
        <span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span> <span class="p">=</span> <span class="n">convIndToAxesY</span><span class="p">(</span><span class="nb">floor</span><span class="p">(</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span><span class="p">));</span>
      <span class="k">end</span>

      <span class="n">combineSel</span><span class="p">(</span><span class="n">poly</span><span class="p">);</span>
      <span class="n">drawCurSel</span><span class="p">;</span>
    <span class="k">end</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">selecSubband</span><span class="p">(</span>toolInd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">oldShowSymb</span> <span class="p">=</span> <span class="p">[];</span>


    <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">imageId</span> <span class="p">=</span> <span class="n">findobj</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="s">&#39;Image&#39;</span><span class="p">);</span>
    <span class="n">figId</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">;</span>
    
    <span class="n">set</span><span class="p">(</span><span class="n">imageId</span><span class="p">,</span> <span class="s">&#39;ButtonDownFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">selecSubbandButtonDown</span><span class="p">);</span>
    
    <span class="n">selectedInFreq</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
    <span class="n">startInFreq</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">    function</span><span class="w"> </span><span class="nf">selecSubbandButtonDown</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">oldShowSymb</span> <span class="p">=</span>  <span class="n">gui</span><span class="p">.</span><span class="n">showSymb</span><span class="p">;</span>
      <span class="n">gui</span><span class="p">.</span><span class="n">showSymb</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
      <span class="n">handleSymb</span><span class="p">();</span>
      <span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      <span class="n">startInFreq</span> <span class="p">=</span> <span class="nb">ceil</span><span class="p">(</span><span class="n">convAxesToIndY</span><span class="p">(</span><span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)));</span>
      <span class="n">selecSubbandMotionDown</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="n">eventData</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span> <span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">selecSubbandMotionDown</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,@</span><span class="n">selecSubbandButtonUp</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">selecSubbandMotionDown</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      <span class="n">indFreq</span> <span class="p">=</span> <span class="nb">ceil</span><span class="p">(</span><span class="n">convAxesToIndY</span><span class="p">(</span><span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)));</span>
       <span class="k">if</span><span class="p">(</span><span class="n">indFreq</span><span class="o">&gt;</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="n">indFreq</span><span class="o">&lt;</span><span class="mi">1</span> <span class="p">)</span>
         <span class="k">return</span><span class="p">;</span>
      <span class="k">end</span>

      <span class="n">selDif</span> <span class="p">=</span> <span class="n">indFreq</span> <span class="o">-</span> <span class="n">startInFreq</span><span class="p">;</span>
      <span class="k">if</span> <span class="n">selDif</span><span class="o">&gt;</span><span class="mi">0</span>
         <span class="n">range</span> <span class="p">=</span> <span class="n">startInFreq</span><span class="p">:</span><span class="n">indFreq</span><span class="p">;</span>
      <span class="k">else</span>
         <span class="n">range</span> <span class="p">=</span> <span class="n">indFreq</span><span class="p">:</span><span class="n">startInFreq</span><span class="p">;</span>
         <span class="n">range</span> <span class="p">=</span> <span class="n">range</span><span class="p">(</span><span class="k">end</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">end</span>
      <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">range</span><span class="p">)</span> <span class="o">||</span> <span class="n">all</span><span class="p">(</span><span class="n">selectedInFreq</span><span class="p">(</span><span class="n">range</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
      <span class="k">end</span>
      

         <span class="n">poly</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="mi">1</span><span class="p">];</span>
         <span class="n">poly</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">;</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">;</span><span class="n">range</span><span class="p">(</span><span class="k">end</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">;</span><span class="n">range</span><span class="p">(</span><span class="k">end</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">];</span>
         <span class="n">poly</span><span class="p">.</span><span class="n">hole</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
      
         <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
           <span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span> <span class="p">=</span> <span class="n">convIndToAxesX</span><span class="p">(</span><span class="nb">floor</span><span class="p">(</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span><span class="p">));</span>
           <span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span> <span class="p">=</span> <span class="n">convIndToAxesY</span><span class="p">(</span><span class="nb">floor</span><span class="p">(</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span><span class="p">));</span>
         <span class="k">end</span>

      <span class="n">combineSel</span><span class="p">(</span><span class="n">poly</span><span class="p">);</span>
      <span class="n">drawCurSel</span><span class="p">;</span>
      <span class="n">selectedInFreq</span><span class="p">(</span><span class="n">range</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">selecSubbandButtonUp</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="n">gui</span><span class="p">.</span><span class="n">showSymb</span> <span class="p">=</span> <span class="n">oldShowSymb</span><span class="p">;</span>
       <span class="n">handleSymb</span><span class="p">();</span>
       <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
       <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
       <span class="n">selectedInFreq</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
    <span class="k">end</span>
    
    <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
    <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>

  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>[poly] <span class="p">=</span><span class="w"> </span><span class="nf">mask2poly</span><span class="p">(</span>mask, indTime, indFreq<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% Convert region mask to region of interest (ROI) polygon</span>
    <span class="c">% !!! I&#39;m not shure that this algorithm works in every case</span>

    <span class="n">maskRef</span> <span class="p">=</span> <span class="n">mask</span><span class="p">;</span>
    <span class="n">mask</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">mask</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">maskRef</span><span class="p">;</span>

    <span class="p">[</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">]</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">mask</span><span class="p">);</span>

    <span class="c">% position of segments on the edge for first dimension</span>
    <span class="n">seg1</span> <span class="p">=</span> <span class="n">sparse</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span> 
    <span class="c">% position of segments on the edge for second dimension</span>
    <span class="n">seg2</span> <span class="p">=</span> <span class="n">sparse</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="nb">size</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

    <span class="k">for</span> <span class="n">n</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">ind1</span><span class="p">)</span>
      <span class="k">if</span> <span class="o">~</span><span class="n">mask</span><span class="p">(</span><span class="n">ind1</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ind2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end</span>
      <span class="k">if</span> <span class="o">~</span><span class="n">mask</span><span class="p">(</span><span class="n">ind1</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end</span>
      <span class="k">if</span> <span class="o">~</span><span class="n">mask</span><span class="p">(</span><span class="n">ind1</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ind2</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">seg2</span><span class="p">(</span><span class="n">ind1</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ind2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end</span>
      <span class="k">if</span> <span class="o">~</span><span class="n">mask</span><span class="p">(</span><span class="n">ind1</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ind2</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">seg2</span><span class="p">(</span><span class="n">ind1</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ind2</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">ind</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="k">while</span> <span class="n">nnz</span><span class="p">(</span><span class="n">seg1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span>
      <span class="n">curve</span> <span class="p">=</span> <span class="n">chainSeg</span><span class="p">;</span>
      <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
        <span class="n">ind</span> <span class="p">=</span> <span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span> <span class="p">=</span> <span class="n">curve</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
        <span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span> <span class="p">=</span> <span class="n">curve</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">hole</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
    
    <span class="n">poly</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">hole</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span>curve <span class="p">=</span><span class="w"> </span><span class="nf">chainSeg</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="c">% chaining of segments</span>

      <span class="c">% choose one start segment</span>
      <span class="p">[</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">]</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">seg1</span><span class="p">);</span>
      <span class="n">ind1</span> <span class="p">=</span> <span class="n">ind1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">ind2</span> <span class="p">=</span> <span class="n">ind2</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">curve</span> <span class="p">=</span> <span class="p">[</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">;</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>

      <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="c">% pos is a variable to remember in which direction we are</span>
      <span class="c">% progressing</span>
      <span class="c">% [1 1] if we&#39;re going in a growing index number</span>
      <span class="c">% [-1 0] otherwise</span>
      <span class="n">pos</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>

      <span class="c">% precise if the last added segment comes from seg1 or seg2</span>
      <span class="n">last1</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span> 

      <span class="k">while</span> <span class="n">true</span>
        <span class="k">if</span> <span class="n">last1</span>
          <span class="c">% the last segment was from dimension 1</span>
          <span class="k">if</span> <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">ind2</span> <span class="p">=</span> <span class="n">ind2</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">curve</span> <span class="p">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">;</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">)];</span>
          <span class="k">elseif</span> <span class="n">seg2</span><span class="p">(</span><span class="n">ind1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind2</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">ind1</span> <span class="p">=</span> <span class="n">ind1</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">ind2</span> <span class="p">=</span> <span class="n">ind2</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="n">pos</span> <span class="p">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
            <span class="n">seg2</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">curve</span> <span class="p">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">;</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">];</span>
            <span class="n">last1</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
          <span class="k">elseif</span> <span class="n">seg2</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">ind2</span> <span class="p">=</span> <span class="n">ind2</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="n">pos</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
            <span class="n">seg2</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">curve</span> <span class="p">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">;</span> <span class="n">ind1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">];</span>
            <span class="n">last1</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">end</span>
        <span class="k">else</span>
          <span class="c">% the last segment was from dimension 2</span>
          <span class="k">if</span> <span class="n">seg2</span><span class="p">(</span><span class="n">ind1</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ind2</span><span class="p">)</span>
            <span class="n">ind1</span> <span class="p">=</span> <span class="n">ind1</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">seg2</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">curve</span> <span class="p">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">;</span> <span class="n">ind1</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">ind2</span><span class="p">];</span>
          <span class="k">elseif</span> <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">ind2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ind1</span> <span class="p">=</span> <span class="n">ind1</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="n">ind2</span> <span class="p">=</span> <span class="n">ind2</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">pos</span> <span class="p">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
            <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">curve</span> <span class="p">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">;</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">];</span>
            <span class="n">last1</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
          <span class="k">elseif</span> <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">ind2</span><span class="p">)</span>
            <span class="n">ind1</span> <span class="p">=</span> <span class="n">ind1</span><span class="o">+</span><span class="n">pos</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="n">pos</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
            <span class="n">seg1</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">curve</span> <span class="p">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">;</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">last1</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
          <span class="k">else</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
      
      <span class="n">curve</span> <span class="p">=</span> <span class="n">curve</span><span class="o">-</span><span class="mf">1.5</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="nb">size</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
        <span class="c">% the first segment couldn&#39;t be linked to some other segment,</span>
        <span class="c">% there is no polygon</span>
        <span class="n">curve</span> <span class="p">=</span> <span class="p">[];</span>
      <span class="k">end</span>
      
    <span class="k">end</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">combineSel</span><span class="p">(</span>poly<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
      <span class="c">% there is already a selection that should be combined with the new</span>
      <span class="c">% one</span>
      
      <span class="k">switch</span> <span class="n">sel</span><span class="p">.</span><span class="n">mode</span>
        <span class="k">case</span> <span class="s">&#39;union&#39;</span>
          <span class="n">newPoly</span> <span class="p">=</span> <span class="n">PolygonClip</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
        <span class="k">case</span> <span class="s">&#39;intersection&#39;</span>
          <span class="n">newPoly</span> <span class="p">=</span> <span class="n">PolygonClip</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">case</span> <span class="s">&#39;difference&#39;</span>
          <span class="n">newPoly</span> <span class="p">=</span> <span class="n">PolygonClip</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">,</span> <span class="n">poly</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">end</span>
      
      <span class="c">% we must remove the selection plot before replacing the selection</span>
      <span class="c">% data</span>
      <span class="n">delCurPoly</span><span class="p">;</span>
      <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span> <span class="p">=</span> <span class="n">newPoly</span><span class="p">;</span>   
    <span class="k">else</span>
      <span class="c">% the selection was empty</span>
      <span class="k">if</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">mode</span><span class="p">,</span> <span class="s">&#39;union&#39;</span><span class="p">)</span>
        <span class="n">updateUndoData</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span> <span class="p">=</span> <span class="n">poly</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">delCurPoly</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">updateUndoData</span><span class="p">;</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">delete</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">id</span><span class="p">);</span>
      <span class="k">end</span>
      <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">delAllPoly</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">updateUndoData</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">indLay</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">)</span>
      <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
          <span class="n">delete</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">id</span><span class="p">);</span>
        <span class="k">end</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span> <span class="p">=</span> <span class="p">[];</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">delSel() % delete graphical selection </span><span class="p">(</span>but keep the polygons<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span> <span class="n">indLay</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">)</span>
      <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
          <span class="n">delete</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">id</span><span class="p">);</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">resetSel</span><span class="p">()</span><span class="w"> </span><span class="c">% erase sel and put it to default value</span>
    <span class="n">sel</span> <span class="p">=</span> <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">gui</span><span class="p">,</span> <span class="s">&#39;layListId&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">ishandle</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layListId</span><span class="p">)</span>
        <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">);</span>
        <span class="n">drawLayParam</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">);</span>
        <span class="n">updateLayerList</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawCurSel</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">handleSymb</span><span class="p">;</span>
    <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">hold</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">id</span> <span class="p">=</span> <span class="n">line</span><span class="p">(</span><span class="c">...</span>
          <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span><span class="p">;</span><span class="c">...</span>
            <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span><span class="c">...</span>
          <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span><span class="p">;</span><span class="c">...</span>
            <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span><span class="c">...</span>
          <span class="s">&#39;LineWidth&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">lineWidth</span><span class="p">,</span><span class="c">...</span>
          <span class="s">&#39;Color&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">color</span><span class="p">,</span><span class="c">...</span>
          <span class="s">&#39;Marker&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">marker</span><span class="p">,</span><span class="c">...</span>
          <span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">markerSize</span><span class="p">,</span><span class="c">...</span>
          <span class="s">&#39;LineStyle&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">lineStyle</span><span class="p">,</span><span class="c">...</span>
          <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">);</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">hold</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawAllSel</span><span class="p">()</span><span class="w"></span>
<span class="w">     </span>
<span class="w">    </span><span class="n">handleSymb</span><span class="p">;</span>
    <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">hold</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">indLay</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">)</span>
      <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
          <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">id</span> <span class="p">=</span> <span class="n">line</span><span class="p">(</span><span class="c">...</span>
            <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span><span class="p">;</span><span class="c">...</span>
              <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span><span class="c">...</span>
            <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span><span class="p">;</span><span class="c">...</span>
              <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">poly</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span><span class="c">...</span>
            <span class="s">&#39;LineWidth&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">lineWidth</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;Color&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">color</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;Marker&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">marker</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">markerSize</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;LineStyle&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">indLay</span><span class="p">).</span><span class="n">lineStyle</span><span class="p">,</span><span class="c">...</span>
            <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">);</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">hold</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">handleSymb</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">delete</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">symbImageId</span><span class="p">);</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">symbImageId</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="n">gui</span><span class="p">.</span><span class="n">showSymb</span>
      <span class="n">showSymb</span><span class="p">();</span>
      <span class="c">%gui.showSymb = false;</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">showSymb</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="c">% plot symbol of the multiplier</span>
    <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">axesId</span> <span class="p">=</span> <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">;</span>
    <span class="n">hold</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
    
    <span class="n">symb</span> <span class="p">=</span> <span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span><span class="p">).</span><span class="n">val</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isempty</span><span class="p">(</span><span class="n">symb</span><span class="p">))</span>
       <span class="n">absSymb</span> <span class="p">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">convSelToSymb</span><span class="p">());</span>
    <span class="k">else</span>
<span class="c">%        if export.limitXaxesRes</span>
<span class="c">%         absSymb=interp1(linspace(0,1,size(symb,2)),abs(symb).&#39;,linspace(0,1,export.xLim),&#39;nearest&#39;);</span>
<span class="c">%         absSymb=absSymb.&#39;;</span>
<span class="c">%        else</span>
         <span class="n">absSymb</span> <span class="p">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">symb</span><span class="p">);</span> 
<span class="c">%       end</span>
    <span class="k">end</span>

     <span class="k">if</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span><span class="p">).</span><span class="n">invert</span><span class="p">)</span>
       <span class="n">absSymb</span> <span class="p">=</span> <span class="n">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">absSymb</span><span class="p">(:))])</span><span class="o">-</span><span class="n">absSymb</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="c">% Symbol is represented using transparency, with two different</span>
    <span class="c">% colors for absolute values of the symbol in [0,1] and for values &gt; 1. </span>
    <span class="c">% Transparency is total for absolute value of 1, and opacity</span>
    <span class="c">% grows when going away from 1</span>
    
    <span class="c">% !!! these colors should be set as variables that the user can set</span>
    <span class="n">color1</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">];</span> <span class="c">% black</span>
    <span class="n">color2</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">];</span> <span class="c">% white</span>
    
    <span class="c">% !!! I should probably use a dB scale for transparency</span>
    
    <span class="n">nbTime</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="c">% construct the image with white for value &gt; 1 and black in other parts</span>
   
    <span class="n">tempIm</span> <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">color1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">]),</span> <span class="p">[</span><span class="n">nbPlottedFreq</span> <span class="n">nbTime</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="p">[</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">]</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">absSymb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nbPlottedFreq</span><span class="p">,</span> <span class="p">:)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">ind1</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">ind3</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">tempIm</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">ind</span> <span class="p">=</span> <span class="nb">sub2ind</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">tempIm</span><span class="p">),</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">,</span> <span class="n">ind3</span> <span class="o">*</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">ind1</span><span class="p">)));</span>
        <span class="n">tempIm</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="p">=</span> <span class="n">color2</span><span class="p">(</span><span class="n">ind3</span><span class="p">);</span>
      <span class="k">end</span>
    <span class="k">end</span>

    
    <span class="c">% construct transparency data</span>
    
    <span class="c">% initialisation using formula valid for values in [0, 1]</span>
    <span class="n">tempAlpha</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">absSymb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nbPlottedFreq</span><span class="p">,</span> <span class="p">:));</span>
    
    <span class="c">% correction for values &gt; 1 % !!! I don&#39;t really know what to use here</span>
    <span class="n">tempAlpha</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="n">absSymb</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">);</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">symbImageId</span> <span class="p">=</span> <span class="n">image</span><span class="p">(</span><span class="c">...</span>
      <span class="n">convIndToAxesX</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">nbTime</span><span class="p">]),</span><span class="c">...</span>
      <span class="n">convIndToAxesY</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nbPlottedFreq</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]),</span><span class="c">...</span>
      <span class="n">tempIm</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;alphaData&#39;</span><span class="p">,</span><span class="n">gui</span><span class="p">.</span><span class="n">symbOpacity</span> <span class="o">*</span> <span class="n">tempAlpha</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">axesId</span><span class="p">);</span>
    <span class="n">hold</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
    <span class="c">% restore the current tool</span>
    <span class="n">changeTool</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">gui</span><span class="p">.</span><span class="n">curTool</span><span class="p">);</span>
  <span class="k">end</span>
<span class="k">  </span>
<span class="k">  function</span><span class="w"> </span><span class="nf">switchSelMode</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">mode</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;SelectedObject&#39;</span><span class="p">),</span><span class="s">&#39;Tag&#39;</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawProcessingTool</span><span class="p">(</span>uipanelId<span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="c">% creation of apply button</span>
  <span class="n">applyIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;apply.png&#39;</span><span class="p">]);</span>
  
  <span class="n">applyId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
    <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
    <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;pushbutton&#39;</span><span class="p">,</span><span class="c">...</span>
    <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
    <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Apply multiplier&#39;</span><span class="p">,</span><span class="c">...</span>
    <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">applyIcon</span><span class="p">,</span><span class="c">...</span>
    <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
    <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">),</span><span class="c">...</span>
    <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">applySel</span><span class="p">);</span>  
  <span class="k">end</span>


<span class="c">% __________________________ LAYERS FUNCTIONS _____________________________</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawLayerPanel</span><span class="p">(</span>uipanelId<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">layUicontextmenu</span> <span class="p">=</span> <span class="n">uicontextmenu</span><span class="p">;</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Line color&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">changeSelLayColor</span><span class="p">);</span>
    
    <span class="n">layStyleMenuId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Line style&#39;</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layStyleMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Solid&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayStyle</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layStyleMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Dashed&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayStyle</span><span class="p">,</span> <span class="s">&#39;--&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layStyleMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Dot&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayStyle</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layStyleMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Dash-dot&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayStyle</span><span class="p">,</span> <span class="s">&#39;-.&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layStyleMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;None&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayStyle</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">});</span>
    
    <span class="n">layWidthMenuId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Line width&#39;</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">1</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;2.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">2</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;3.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">3</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;4.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">4</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;5.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">5</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;6.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">6</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;7.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">7</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;8.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">8</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;9.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">9</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layWidthMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;10.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayWidth</span><span class="p">,</span> <span class="mi">10</span><span class="p">});</span>

    <span class="n">layMarkerMenuId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Marker&#39;</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;None&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">});</span>    
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Square&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;square&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Diamond&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;diamond&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;^&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;^&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;v&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;v&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Pentagram&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;pentagram&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Hexagram&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarker</span><span class="p">,</span> <span class="s">&#39;hexagram&#39;</span><span class="p">});</span>
    
    
    <span class="n">layMarkerSizeMenuId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Marker Size&#39;</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;2.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">2</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;3.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">3</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;4.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">4</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;5.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">5</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;6.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">6</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;7.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">7</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;8.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">8</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;9.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">9</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layMarkerSizeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;10.0&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayMarkerSize</span><span class="p">,</span> <span class="mi">10</span><span class="p">});</span>
    
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Edit label&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">changeSelLayLabel</span><span class="p">);</span>
    
    
    <span class="n">layTypeMenuId</span> <span class="p">=</span> <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Layer type&#39;</span><span class="p">);</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layTypeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Constant gain&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayConvType</span><span class="p">,</span> <span class="s">&#39;constGain&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layTypeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Gain with smoothed border&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayConvType</span><span class="p">,</span> <span class="s">&#39;smoothBorder&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layTypeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Hole filling&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayConvType</span><span class="p">,</span> <span class="s">&#39;fill&#39;</span><span class="p">});</span>
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layTypeMenuId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Hole filling with noise phase&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeSelLayConvType</span><span class="p">,</span> <span class="s">&#39;fillNoise&#39;</span><span class="p">});</span>
    
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Invert layer&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">invertSelLay</span><span class="p">);</span>
    
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Duplicate layer&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">duplicateSelLay</span><span class="p">);</span>
    
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Clear layer&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">clearSelLay</span><span class="p">);</span>
    
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Delete layer&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">delSelLay</span><span class="p">);</span>
    
    <span class="n">uimenu</span><span class="p">(</span><span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Label&#39;</span><span class="p">,</span> <span class="s">&#39;Add new layer&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">addSelLay</span><span class="p">);</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">layListId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;HandleVisibility&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;listbox&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Fontsize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;UIContextMenu&#39;</span><span class="p">,</span> <span class="n">layUicontextmenu</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">changeSelLay</span><span class="p">);</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">layPanelId</span> <span class="p">=</span> <span class="n">uipanelId</span><span class="p">;</span> 
    <span class="n">updateLayerList</span><span class="p">;</span>
    <span class="n">changeSelLay</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">updateLayerList</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">layCell</span> <span class="p">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="s">&#39;lay&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">)</span>
        <span class="n">layCell</span><span class="p">{</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">label</span><span class="p">;</span>
      <span class="k">end</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layListId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">layCell</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">  </span>
<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelLayColor</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">color</span> <span class="p">=</span> <span class="n">uisetcolor</span><span class="p">;</span>
    <span class="n">delSel</span><span class="p">;</span>
    <span class="n">drawAllSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelLayStyle</span><span class="p">(</span>objId, eventData, lineStyle<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">lineStyle</span> <span class="p">=</span> <span class="n">lineStyle</span><span class="p">;</span>
    <span class="n">delSel</span><span class="p">;</span>
    <span class="n">drawAllSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelLayWidth</span><span class="p">(</span>objId, eventData, lineWidth<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">lineWidth</span> <span class="p">=</span> <span class="n">lineWidth</span><span class="p">;</span>
    <span class="n">delSel</span><span class="p">;</span>
    <span class="n">drawAllSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelLayMarker</span><span class="p">(</span>objId, eventData, marker<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">marker</span> <span class="p">=</span> <span class="n">marker</span><span class="p">;</span>
    <span class="n">delSel</span><span class="p">;</span>
    <span class="n">drawAllSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelLayMarkerSize</span><span class="p">(</span>objId, eventData, markerSize<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">markerSize</span> <span class="p">=</span> <span class="n">markerSize</span><span class="p">;</span>
    <span class="n">delSel</span><span class="p">;</span>
    <span class="n">drawAllSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelLayLabel</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">newLabel</span> <span class="p">=</span> <span class="n">inputdlg</span><span class="p">(</span><span class="s">&#39;New label for the current selection layer&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Change layer label&#39;</span><span class="p">);</span>
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">label</span> <span class="p">=</span> <span class="n">newLabel</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
    <span class="n">updateLayerList</span><span class="p">;</span>    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelLayConvType</span><span class="p">(</span>objId, eventData, convType<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">delSel</span><span class="p">;</span>
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">convType</span> <span class="p">=</span> <span class="n">convType</span><span class="p">;</span>    
    
    <span class="c">% !!! see if I put the default value somewhere</span>
    <span class="c">% and if I keep a memory of the preceeding values</span>
    
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span> <span class="p">=</span> <span class="p">[];</span>
    
    <span class="k">switch</span> <span class="n">convType</span>
      <span class="k">case</span> <span class="s">&#39;constGain&#39;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Gain&#39;</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">case</span> <span class="s">&#39;smoothBorder&#39;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Gain&#39;</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Border&#39;</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="mi">10</span><span class="p">;</span>
      <span class="k">case</span> <span class="s">&#39;fill&#39;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Width&#39;</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Height&#39;</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>
      <span class="k">case</span> <span class="s">&#39;fillNoise&#39;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Width&#39;</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Height &#39;</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">changeSelLay</span><span class="p">;</span>
    <span class="n">drawAllSel</span><span class="p">;</span>    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">invertSelLay</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w">      </span>
<span class="w">       </span>
<span class="w">      </span><span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span> <span class="p">=</span> <span class="n">fullSigPoly</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="c">% compute difference between a polygon around the whole signal and </span>
        <span class="c">% the current selection to inverse current selection</span>
        <span class="n">newPoly</span> <span class="p">=</span> <span class="n">PolygonClip</span><span class="p">(</span><span class="n">fullSigPoly</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">delCurPoly</span><span class="p">;</span>
        <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span> <span class="p">=</span> <span class="n">newPoly</span><span class="p">;</span>
      <span class="k">end</span>
      
      <span class="n">drawCurSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>poly <span class="p">=</span><span class="w"> </span><span class="nf">fullSigPoly</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="c">% compute a polygon corresponding to the whole signal</span>
    <span class="n">temp</span> <span class="p">=</span> <span class="n">convIndToAxesX</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
    <span class="n">temp</span> <span class="p">=</span> <span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">tempX</span> <span class="p">=</span> <span class="n">convIndToAxesX</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]);</span>
    <span class="n">tempX</span> <span class="p">=</span> <span class="p">[</span><span class="n">tempX</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp</span><span class="p">,</span> <span class="n">tempX</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp</span><span class="p">];</span> 
    <span class="n">temp</span> <span class="p">=</span> <span class="n">convIndToAxesY</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
    <span class="n">temp</span> <span class="p">=</span> <span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">tempY</span> <span class="p">=</span> <span class="n">convIndToAxesY</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">coeff</span><span class="p">.</span><span class="n">oriC</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]);</span>
    <span class="n">tempY</span> <span class="p">=</span> <span class="p">[</span><span class="n">tempY</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp</span><span class="p">,</span> <span class="n">tempY</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">temp</span><span class="p">];</span> 
    <span class="n">poly</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="n">tempX</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">tempX</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">tempX</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">tempX</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span>
    <span class="n">poly</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="n">tempY</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">tempY</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">tempY</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">tempY</span><span class="p">(</span><span class="mi">2</span><span class="p">)];</span>
    <span class="n">poly</span><span class="p">.</span><span class="n">hole</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">duplicateSelLay</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">);</span>
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">label</span> <span class="p">=</span> <span class="p">[</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">label</span> <span class="s">&#39; copy&#39;</span><span class="p">];</span>
    <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">poly</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">)</span>
      <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">poly</span><span class="p">.</span><span class="n">id</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="k">end</span>
    <span class="n">updateLayerList</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">clearSelLay</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w">    </span>
<span class="w">    </span><span class="n">delSel</span><span class="p">;</span>
    <span class="n">updateUndoData</span><span class="p">;</span>
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">).</span><span class="n">poly</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">drawAllSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">delSelLay</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% check that we leave at least one layer</span>
    <span class="k">if</span> <span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
      <span class="n">warndlg</span><span class="p">(</span><span class="s">&#39;The selection must contain at least one layer&#39;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    
    <span class="n">delSel</span><span class="p">;</span>
    <span class="n">updateUndoData</span><span class="p">;</span>
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span> <span class="p">=</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">([</span><span class="mi">1</span><span class="p">:</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="o">-</span><span class="mi">1</span> <span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">]);</span>
    <span class="n">updateLayerList</span><span class="p">;</span>
    <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">changeSelLay</span><span class="p">;</span>
    <span class="n">drawAllSel</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">addSelLay</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">default</span><span class="p">.</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">;</span>
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">label</span> <span class="p">=</span> <span class="s">&#39;New layer&#39;</span><span class="p">;</span>
    <span class="n">updateLayerList</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelLay</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">);</span>
    <span class="n">drawLayParam</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">curLay</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawLayParam</span><span class="p">(</span>layInd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span> <span class="o">~</span><span class="n">isfield</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="s">&#39;lay&#39;</span><span class="p">)</span>
       <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">child</span> <span class="p">=</span> <span class="n">findobj</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">layPanelId</span><span class="p">);</span>
    <span class="n">child</span> <span class="p">=</span> <span class="n">setdiff</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">layPanelId</span><span class="p">);</span>
    <span class="n">delete</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">layInd</span><span class="p">).</span><span class="n">param</span><span class="p">)</span>
      <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
        <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">layPanelId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">layInd</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">name</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="c">...</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">ind</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="p">),</span><span class="c">...</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">])</span> <span class="p">;</span>
      <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
        <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">layPanelId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;edit&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">num2str</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">layInd</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">val</span><span class="p">),</span><span class="c">...</span>
        <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span><span class="p">,</span><span class="c">...</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">ind</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="p">),</span><span class="c">...</span>
          <span class="n">gui</span><span class="p">.</span><span class="n">editWidth</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">],</span><span class="c">...</span>
        <span class="s">&#39;Callback&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeLayParam</span><span class="p">,</span> <span class="n">layInd</span><span class="p">,</span> <span class="n">ind</span><span class="p">});</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeLayParam</span><span class="p">(</span>objId, eventData, layInd, paramInd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">handleSymb</span><span class="p">;</span>
    <span class="n">temp</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">));</span>
    <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
      <span class="n">errordlg</span><span class="p">([</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">layInd</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="n">paramInd</span><span class="p">).</span><span class="n">name</span><span class="c">...</span>
        <span class="s">&#39; parameter is invalid&#39;</span><span class="p">]);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">num2str</span><span class="p">(</span><span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">layInd</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="n">paramInd</span><span class="p">).</span><span class="n">val</span><span class="p">));</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">sel</span><span class="p">.</span><span class="n">lay</span><span class="p">(</span><span class="n">layInd</span><span class="p">).</span><span class="n">param</span><span class="p">(</span><span class="n">paramInd</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeOpacity</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">temp</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">));</span>
    <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">||</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="n">errordlg</span><span class="p">([</span><span class="s">&#39;Opacity parameter is invalid, it must be a number &#39;</span><span class="c">...</span>
        <span class="s">&#39;between 0 (transparent) and 1 (opaque)&#39;</span><span class="p">]);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">num2str</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">symbOpacity</span><span class="p">));</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">symbOpacity</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="n">handleSymb</span><span class="p">();</span>
  <span class="k">end</span>

<span class="c">% __________________ VISUALIZATION TOOLS FUNCTIONS ________________________</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawVisualizationTool</span><span class="p">(</span>uipanelId<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">subPanelHeight</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span> <span class="o">+</span><span class="c">...</span>
      <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span> <span class="o">+</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
   
    <span class="n">visPanelPos</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">uipanelId</span><span class="p">,</span><span class="s">&#39;Position&#39;</span><span class="p">);</span>
  
    <span class="n">symbolPanelHeight</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">subPanelHeight</span><span class="p">;</span>

     <span class="n">currPos</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">symbolPanelId</span> <span class="p">=</span> <span class="n">uipanel</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="s">&#39;Symbol&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">currPos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span><span class="o">-</span><span class="mi">4</span> <span class="p">,</span> <span class="n">symbolPanelHeight</span><span class="p">]);</span>
    <span class="n">currPos</span> <span class="p">=</span> <span class="n">currPos</span> <span class="o">+</span> <span class="n">symbolPanelHeight</span><span class="p">;</span>
    
     <span class="n">gui</span><span class="p">.</span><span class="n">symbListId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;HandleVisibility&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;listbox&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Fontsize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">vertDist</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">gui</span><span class="p">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">changeSelSymb</span><span class="p">);</span>
    

    <span class="c">% draw layer panel</span>
    <span class="c">% drawLayerPanel(symbolPanelId);</span>
   
    <span class="n">showSymbolIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;showsymbol.png&#39;</span><span class="p">]);</span>
    <span class="n">symbId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">symbolPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Show multiplier symbol&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">showSymbolIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">clicSymb</span><span class="p">);</span>

    <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">symbolPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;Text&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;Opacity&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">changeOpacity</span><span class="p">);</span>
    
    <span class="n">opacityId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">symbolPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;edit&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">num2str</span><span class="p">(</span><span class="n">default</span><span class="p">.</span><span class="n">opacity</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">editWidth</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">changeOpacity</span><span class="p">);</span>
   
   
   
    
    <span class="n">colormapPanelId</span> <span class="p">=</span> <span class="n">uipanel</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="s">&#39;Colormap&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">currPos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">panelWidth</span><span class="o">-</span><span class="mi">4</span> <span class="p">,</span> <span class="n">subPanelHeight</span><span class="p">]);</span>
     <span class="n">currPos</span> <span class="p">=</span> <span class="n">currPos</span> <span class="o">+</span> <span class="n">subPanelHeight</span><span class="p">;</span>
    
    <span class="n">colormapIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;colormap.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonColormapId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">colormapPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;pushbutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Edit colormap&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">colormapIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">editColormap</span><span class="p">);</span>
    
    <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">colormapPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;Text&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;Dynamic&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">changeOpacity</span><span class="p">);</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">editDynamicId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">colormapPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;edit&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">num2str</span><span class="p">(</span><span class="n">default</span><span class="p">.</span><span class="n">dynamic</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">textWidth</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">gui</span><span class="p">.</span><span class="n">buttonHeight</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">editWidth</span><span class="p">,</span><span class="c">...</span>
        <span class="n">gui</span><span class="p">.</span><span class="n">textHeight</span><span class="p">],</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,@</span><span class="n">changeDynamic</span><span class="p">);</span>
    
    <span class="n">zoomPanelId</span> <span class="p">=</span> <span class="n">uipanel</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">uipanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Title&#39;</span><span class="p">,</span> <span class="s">&#39;Zoom&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TitlePosition&#39;</span><span class="p">,</span> <span class="s">&#39;centertop&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;FontSize&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">fontSize</span><span class="p">,</span> <span class="c">...</span>
      <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;pixels&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">currPos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">subpanelSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)]);</span>
    
    <span class="n">zoomInIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;zoomin.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonZoomInId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">zoomPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Zoom in&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">zoomInIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Min&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Max&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeTool</span><span class="p">,</span> <span class="s">&#39;zoomIn&#39;</span><span class="p">});</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">buttonId</span> <span class="p">=</span> <span class="n">buttonZoomInId</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">name</span><span class="p">=</span> <span class="s">&#39;zoomIn&#39;</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="k">function</span> <span class="p">=</span> <span class="p">@</span><span class="n">switchZoomIn</span><span class="p">;</span>
    
    <span class="n">zoomOutIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;zoomout.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonZoomOutId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">zoomPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Zoom out&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">zoomOutIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Min&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Max&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeTool</span><span class="p">,</span> <span class="s">&#39;zoomOut&#39;</span><span class="p">});</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">buttonId</span> <span class="p">=</span> <span class="n">buttonZoomOutId</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;zoomOut&#39;</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="k">function</span> <span class="p">=</span> <span class="p">@</span><span class="n">switchZoomOut</span><span class="p">;</span>

    <span class="n">panIcon</span> <span class="p">=</span> <span class="n">imread</span><span class="p">([</span><span class="n">iconpath</span><span class="p">,</span><span class="s">&#39;pan.png&#39;</span><span class="p">]);</span>
    
    <span class="n">buttonPanId</span> <span class="p">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">zoomPanelId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Style&#39;</span><span class="p">,</span> <span class="s">&#39;togglebutton&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;TooltipString&#39;</span><span class="p">,</span> <span class="s">&#39;Pan&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;CData&#39;</span><span class="p">,</span> <span class="n">panIcon</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Min&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Max&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;BackgroundColor&#39;</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">buttonBackgroundColor</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">buttonPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gui</span><span class="p">.</span><span class="n">marginSub</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;CallBack&#39;</span><span class="p">,</span> <span class="p">{@</span><span class="n">changeTool</span><span class="p">,</span> <span class="s">&#39;pan&#39;</span><span class="p">});</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">buttonId</span> <span class="p">=</span> <span class="n">buttonPanId</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;pan&#39;</span><span class="p">;</span>
    <span class="n">gui</span><span class="p">.</span><span class="n">tool</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="k">function</span> <span class="p">=</span> <span class="p">@</span><span class="n">switchPan</span><span class="p">;</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">clicSymb</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">button_state</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span><span class="s">&#39;Value&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">button_state</span> <span class="o">==</span> <span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span><span class="s">&#39;Max&#39;</span><span class="p">)</span>
       <span class="n">delSel</span><span class="p">;</span>
       <span class="n">gui</span><span class="p">.</span><span class="n">showSymb</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
       <span class="n">drawAllSel</span><span class="p">;</span>
    <span class="k">elseif</span> <span class="n">button_state</span> <span class="o">==</span> <span class="n">get</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span><span class="s">&#39;Min&#39;</span><span class="p">)</span>
       <span class="n">delSel</span><span class="p">;</span>
       <span class="n">gui</span><span class="p">.</span><span class="n">showSymb</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
       <span class="n">drawAllSel</span><span class="p">;</span>
    <span class="k">end</span> 

  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">switchZoomIn</span><span class="p">(</span>toolInd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% toolInd is not used but needed as I pass a parameter to this </span>
    <span class="c">% function !!! precise this</span>
    <span class="k">if</span> <span class="n">getMatlabVersion</span> <span class="o">&gt;</span><span class="p">=</span> <span class="mf">7.3</span>
      <span class="n">zoomId</span> <span class="p">=</span> <span class="n">zoom</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">zoomId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Direction&#39;</span><span class="p">,</span> <span class="s">&#39;in&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;ActionPostCallback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">updateExploreRect</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">zoom</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
      <span class="c">% !!! this is undocumented in version 7.2 but it works, do something</span>
      <span class="c">% more general</span>
      <span class="n">zoom</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;Direction&#39;</span><span class="p">,</span> <span class="s">&#39;in&#39;</span><span class="p">);</span> 
      <span class="c">% !!! problem: we miss something here to force update rectangle in </span>
      <span class="c">% overview after a zoom</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">switchZoomOut</span><span class="p">(</span>toolInd<span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="c">% toolInd is not used but needed as I pass a parameter to this function</span>
    <span class="c">% !!! precise this</span>
    <span class="k">if</span> <span class="n">getMatlabVersion</span> <span class="o">&gt;</span><span class="p">=</span> <span class="mf">7.3</span>
      <span class="n">zoomId</span> <span class="p">=</span> <span class="n">zoom</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">zoomId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Direction&#39;</span><span class="p">,</span> <span class="s">&#39;out&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;ActionPostCallback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">updateExploreRect</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">zoom</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
      <span class="c">% !!! this is undocumented in version 7.2 but it works, do something</span>
      <span class="c">% more general</span>
      <span class="n">zoom</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;Direction&#39;</span><span class="p">,</span> <span class="s">&#39;out&#39;</span><span class="p">);</span>
      <span class="c">% !!! problem: we miss something here to force update rectangle in </span>
      <span class="c">% overview after a zoom</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">    </span>
<span class="k">  function</span><span class="w"> </span><span class="nf">switchPan</span><span class="p">(</span>toolInd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% toolInd is not used but needed as I pass a parameter to this function</span>
    <span class="c">% !!! precise this</span>

    <span class="k">if</span> <span class="n">getMatlabVersion</span> <span class="o">&gt;</span><span class="p">=</span> <span class="mf">7.3</span>
      <span class="n">panId</span> <span class="p">=</span> <span class="n">pan</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">panId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;Enable&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;ActionPostCallback&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">updateExploreRect</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">pan</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">);</span>
      <span class="c">% !!! problem: we miss something here to force update rectangle in </span>
      <span class="c">% overview after a pan</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span>[res] <span class="p">=</span><span class="w"> </span><span class="nf">updateExploreRect</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">exploreSetRect</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;XLim&#39;</span><span class="p">),</span><span class="c">...</span>
      <span class="n">get</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;YLim&#39;</span><span class="p">));</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">editColormap</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">colormapeditor</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeDynamic</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">temp</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">editDynamicId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">));</span>
    <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">||</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">0</span>
      <span class="n">errordlg</span><span class="p">([</span><span class="s">&#39;Dynamic parameter is invalid, it must be a positive &#39;</span><span class="c">...</span>
        <span class="s">&#39;number in dB&#39;</span><span class="p">]);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">editDynamicId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">num2str</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">dynamic</span><span class="p">));</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">dynamic</span> <span class="p">=</span> <span class="n">temp</span><span class="p">;</span>
    <span class="n">updateVisu</span><span class="p">(</span><span class="n">false</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">exploreOverview</span><span class="p">(</span>axesId<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">axLim</span> <span class="p">=</span> <span class="n">axis</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">);</span>
    
    <span class="n">xLim</span> <span class="p">=</span> <span class="n">axLim</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">yLim</span> <span class="p">=</span> <span class="n">axLim</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">);</span>
    
    <span class="n">indXData</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">indYData</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">exploreRect</span><span class="p">.</span><span class="n">patchId</span> <span class="p">=</span> <span class="n">patch</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">axesId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">xLim</span><span class="p">(</span><span class="n">indXData</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">yLim</span><span class="p">(</span><span class="n">indYData</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;FaceColor&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;LineWidth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;EdgeColor&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span><span class="c">... % !!! put the color and width as variables</span>
      <span class="s">&#39;ButtonDownFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">explorePatchButtonDown</span><span class="p">);</span>
    
    <span class="n">gui</span><span class="p">.</span><span class="n">exploreRect</span><span class="p">.</span><span class="n">lineId</span> <span class="p">=</span> <span class="n">line</span><span class="p">(</span><span class="c">...</span>
      <span class="s">&#39;Parent&#39;</span><span class="p">,</span> <span class="n">axesId</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">xLim</span><span class="p">(</span><span class="n">indXData</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">yLim</span><span class="p">(</span><span class="n">indYData</span><span class="p">),</span><span class="c">...</span>
      <span class="s">&#39;LineStyle&#39;</span><span class="p">,</span> <span class="s">&#39;None&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;LineWidth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;Color&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span><span class="c">... % !!! put the color  and width as variables</span>
      <span class="s">&#39;Marker&#39;</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span><span class="c">...</span>
      <span class="s">&#39;ButtonDownFcn&#39;</span><span class="p">,</span> <span class="p">@</span><span class="n">exploreLineButtonDown</span><span class="p">);</span>
    
    <span class="n">patchId</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">exploreRect</span><span class="p">.</span><span class="n">patchId</span><span class="p">;</span>
    <span class="n">lineId</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">exploreRect</span><span class="p">.</span><span class="n">lineId</span><span class="p">;</span>
    <span class="n">figId</span> <span class="p">=</span> <span class="n">gui</span><span class="p">.</span><span class="n">mainFigId</span><span class="p">;</span>
    <span class="n">initPoint</span> <span class="p">=</span> <span class="p">[];</span>

    <span class="n">indX</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">indY</span> <span class="p">=</span> <span class="p">[];</span>
    
    <span class="n">exploreAxesXLim</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">exploreAxesYLim</span> <span class="p">=</span> <span class="p">[];</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">exploreLineButtonDown</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="c">% the coordinate that should be modified depends on the selected </span>
      <span class="c">% corner</span>
      <span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      
      <span class="n">xData</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">lineId</span><span class="p">,</span> <span class="s">&#39;XData&#39;</span><span class="p">);</span>
      <span class="n">yData</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">lineId</span><span class="p">,</span> <span class="s">&#39;YData&#39;</span><span class="p">);</span>
      <span class="n">xLim</span> <span class="p">=</span> <span class="n">xData</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">);</span>
      <span class="n">yLim</span> <span class="p">=</span> <span class="n">yData</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">);</span>
      
      <span class="p">[</span><span class="n">mi</span><span class="p">,</span> <span class="n">indX</span><span class="p">]</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">xLim</span> <span class="o">-</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)));</span>
      <span class="p">[</span><span class="n">mi</span><span class="p">,</span> <span class="n">indY</span><span class="p">]</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">yLim</span> <span class="o">-</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)));</span>
      
      <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,@</span><span class="n">exploreMotionLine</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,@</span><span class="n">exploreButtonUp</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">exploreMotionLine</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      <span class="n">xLim</span><span class="p">(</span><span class="n">indX</span><span class="p">)</span> <span class="p">=</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">yLim</span><span class="p">(</span><span class="n">indY</span><span class="p">)</span> <span class="p">=</span> <span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
      
      <span class="c">% reorder the values</span>
      <span class="n">xLimSort</span> <span class="p">=</span> <span class="n">sort</span><span class="p">(</span><span class="n">xLim</span><span class="p">);</span>
      <span class="n">yLimSort</span> <span class="p">=</span> <span class="n">sort</span><span class="p">(</span><span class="n">yLim</span><span class="p">);</span>
      
      <span class="n">set</span><span class="p">(</span><span class="n">patchId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">xLimSort</span><span class="p">(</span><span class="n">indXData</span><span class="p">),</span><span class="c">...</span>
        <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">yLimSort</span><span class="p">(</span><span class="n">indYData</span><span class="p">));</span>
      <span class="n">set</span><span class="p">(</span><span class="n">lineId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">xLimSort</span><span class="p">(</span><span class="n">indXData</span><span class="p">),</span><span class="c">...</span>
        <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">yLimSort</span><span class="p">(</span><span class="n">indYData</span><span class="p">));</span>
      <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">axis</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="p">[</span><span class="n">xLimSort</span><span class="p">,</span> <span class="n">yLimSort</span><span class="p">]);</span>
      <span class="c">% !!! this plot can be removed if it&#39;s to heavy</span>
      <span class="n">drawnow</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">explorePatchButtonDown</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">initPoint</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      <span class="n">exploreAxesXLim</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;XLim&#39;</span><span class="p">);</span>
      <span class="n">exploreAxesYLim</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span> <span class="s">&#39;YLim&#39;</span><span class="p">);</span>
      <span class="n">xData</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">patchId</span><span class="p">,</span> <span class="s">&#39;XData&#39;</span><span class="p">);</span>
      <span class="n">yData</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">patchId</span><span class="p">,</span> <span class="s">&#39;YData&#39;</span><span class="p">);</span>
      <span class="n">xLim</span> <span class="p">=</span> <span class="n">xData</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">);</span>
      <span class="n">yLim</span> <span class="p">=</span> <span class="n">yData</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,@</span><span class="n">exploreMotionPatch</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,@</span><span class="n">exploreButtonUp</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">exploreMotionPatch</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">point</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">axesId</span><span class="p">,</span><span class="s">&#39;CurrentPoint&#39;</span><span class="p">);</span>
      <span class="n">newXLim</span> <span class="p">=</span> <span class="n">xLim</span> <span class="o">+</span> <span class="p">(</span><span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">initPoint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
      <span class="n">newYLim</span> <span class="p">=</span> <span class="n">yLim</span> <span class="o">+</span> <span class="p">(</span><span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">initPoint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">));</span>
      
      <span class="k">if</span> <span class="o">~</span><span class="p">(</span><span class="n">newXLim</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">exploreAxesXLim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">||</span><span class="c">...</span>
          <span class="n">newXLim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">exploreAxesXLim</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">||</span><span class="c">...</span>
          <span class="n">newYLim</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">exploreAxesYLim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">||</span><span class="c">...</span>
          <span class="n">newYLim</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">exploreAxesYLim</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">set</span><span class="p">(</span><span class="n">patchId</span><span class="p">,</span><span class="c">...</span>
          <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">newXLim</span><span class="p">(</span><span class="n">indXData</span><span class="p">),</span><span class="c">...</span>
          <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">newYLim</span><span class="p">(</span><span class="n">indYData</span><span class="p">));</span>
        <span class="n">set</span><span class="p">(</span><span class="n">lineId</span><span class="p">,</span><span class="c">...</span>
          <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">newXLim</span><span class="p">(</span><span class="n">indXData</span><span class="p">),</span><span class="c">...</span>
          <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">newYLim</span><span class="p">(</span><span class="n">indYData</span><span class="p">));</span>
        <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">axis</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="p">[</span><span class="n">newXLim</span><span class="p">;</span> <span class="n">newYLim</span><span class="p">]);</span>
        <span class="c">% !!! this plot can be removed if it&#39;s to heavy</span>
        <span class="n">drawnow</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">    </span>
<span class="k">    function</span><span class="w"> </span><span class="nf">exploreButtonUp</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonMotionFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
      <span class="n">set</span><span class="p">(</span><span class="n">figId</span><span class="p">,</span><span class="s">&#39;WindowButtonUpFcn&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
      <span class="n">xData</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">patchId</span><span class="p">,</span> <span class="s">&#39;XData&#39;</span><span class="p">);</span>
      <span class="n">yData</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">patchId</span><span class="p">,</span> <span class="s">&#39;YData&#39;</span><span class="p">);</span>
      <span class="n">oriInd</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#39;originalMain&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">visu</span><span class="p">.</span><span class="n">label</span><span class="p">}),</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">axis</span><span class="p">(</span><span class="n">visu</span><span class="p">(</span><span class="n">oriInd</span><span class="p">).</span><span class="n">axesId</span><span class="p">,</span> <span class="p">[</span><span class="n">xData</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">);</span> <span class="n">yData</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">)]);</span>      
    <span class="k">end</span>
    
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">exploreSetRect</span><span class="p">(</span>xLim, yLim<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">indXData</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">indYData</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
    <span class="k">if</span> <span class="n">ishandle</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">exploreRect</span><span class="p">.</span><span class="n">patchId</span><span class="p">)</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">exploreRect</span><span class="p">.</span><span class="n">patchId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">xLim</span><span class="p">(</span><span class="n">indXData</span><span class="p">),</span><span class="c">...</span>
        <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">yLim</span><span class="p">(</span><span class="n">indYData</span><span class="p">));</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">ishandle</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">exploreRect</span><span class="p">.</span><span class="n">lineId</span><span class="p">)</span>
      <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">exploreRect</span><span class="p">.</span><span class="n">lineId</span><span class="p">,</span><span class="c">...</span>
        <span class="s">&#39;XData&#39;</span><span class="p">,</span> <span class="n">xLim</span><span class="p">(</span><span class="n">indXData</span><span class="p">),</span><span class="c">...</span>
        <span class="s">&#39;YData&#39;</span><span class="p">,</span> <span class="n">yLim</span><span class="p">(</span><span class="n">indYData</span><span class="p">));</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">changeSelSymb</span><span class="p">(</span>objId, eventData<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">symbListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">);</span>
    <span class="n">handleSymb</span><span class="p">();</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">resetSymbol</span><span class="p">()</span><span class="w"> </span><span class="c">% erase sel and put it to default value</span>
    <span class="n">symbol</span> <span class="p">=</span> <span class="n">default</span><span class="p">.</span><span class="n">symbol</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">gui</span><span class="p">,</span> <span class="s">&#39;symbListId&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">ishandle</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">symbListId</span><span class="p">)</span>
        <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">symbListId</span><span class="p">,</span> <span class="s">&#39;Value&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span><span class="p">);</span>
        <span class="n">drawSymbolParam</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">curSymb</span><span class="p">);</span>
        <span class="n">updateSymbolList</span><span class="p">;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">updateSymbolList</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">symCell</span> <span class="p">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="n">isfield</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
       <span class="k">for</span> <span class="n">ind</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
         <span class="n">symCell</span><span class="p">{</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">ind</span><span class="p">).</span><span class="n">name</span><span class="p">;</span>
       <span class="k">end</span>
       <span class="n">set</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="n">symbListId</span><span class="p">,</span> <span class="s">&#39;String&#39;</span><span class="p">,</span> <span class="n">symCell</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">drawSymbolParam</span><span class="p">(</span>symbInd<span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="c">% nothing to do yet</span>
  <span class="k">end</span>

<span class="k">  function</span><span class="w"> </span><span class="nf">addSymbolListItem</span><span class="p">(</span>symb<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">val</span> <span class="p">=</span> <span class="n">symb</span><span class="p">;</span>
    <span class="n">symbol</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="k">end</span><span class="p">).</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;Imported&#39;</span><span class="p">;</span>
    <span class="n">updateSymbolList</span><span class="p">();</span>
  <span class="k">end</span>


<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="c">%%%%%%%%%% HELPER FUNCTIONS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>





<span class="k">end</span>
</pre></div>


        <div class="include" file="../../include/footer.html"></div>
    </div>
</div>
<!-- These two have to be here to dynamically load the included parts -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.5/js/bootstrap-select.min.js"></script>
<script src="../../js/ltfat.js" type="text/javascript"></script>
<script src="../include/lookup.js" type="text/javascript"></script>
<script src="../include/jumplist.js" type="text/javascript"></script>
</body>
</html>

